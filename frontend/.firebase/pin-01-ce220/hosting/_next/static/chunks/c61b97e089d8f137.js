(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31342,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"BailoutToCSR",{enumerable:!0,get:function(){return i}});let r=e.r(19551);function i({reason:e,children:t}){if("u"<typeof window)throw Object.defineProperty(new r.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},65562,(e,t,n)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"encodeURIPath",{enumerable:!0,get:function(){return r}})},29106,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"PreloadChunks",{enumerable:!0,get:function(){return l}});let r=e.r(48277),i=e.r(69941),s=e.r(26628),a=e.r(65562),o=e.r(26159);function l({moduleIds:e}){if("u">typeof window)return null;let t=s.workAsyncStorage.getStore();if(void 0===t)return null;let n=[];if(t.reactLoadableManifest&&e){let r=t.reactLoadableManifest;for(let t of e){if(!r[t])continue;let e=r[t].files;n.push(...e)}}if(0===n.length)return null;let l=(0,o.getDeploymentIdQueryOrEmptyString)();return(0,r.jsx)(r.Fragment,{children:n.map(e=>{let n=`${t.assetPrefix}/_next/${(0,a.encodeURIPath)(e)}${l}`;return e.endsWith(".css")?(0,r.jsx)("link",{precedence:"dynamic",href:n,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,i.preload)(n,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69656,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return u}});let r=e.r(48277),i=e.r(30668),s=e.r(31342),a=e.r(29106);function o(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},u=function(e){let t={...l,...e},n=(0,i.lazy)(()=>t.loader().then(o)),u=t.loading;function h(e){let o=u?(0,r.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,h=l?i.Suspense:i.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:["u"<typeof window?(0,r.jsx)(a.PreloadChunks,{moduleIds:t.modules}):null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(s.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(h,{...l?{fallback:o}:{},children:c})}return h.displayName="LoadableComponent",h}},62870,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return i}});let r=e.r(35856)._(e.r(69656));function i(e,t){let n={};"function"==typeof e&&(n.loader=e);let i={...n,...t};return(0,r.default)({...i,modules:i.loadableGenerated?.modules})}("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},31330,(e,t,n)=>{"use strict";function r({widthInt:e,heightInt:t,blurWidth:n,blurHeight:r,blurDataURL:i,objectFit:s}){let a=n?40*n:e,o=r?40*r:t,l=a&&o?`viewBox='0 0 ${a} ${o}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${l}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${l?"none":"contain"===s?"xMidYMid":"cover"===s?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${i}'/%3E%3C/svg%3E`}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getImageBlurSvg",{enumerable:!0,get:function(){return r}})},4558,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={VALID_LOADERS:function(){return s},imageConfigDefault:function(){return a}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=["default","imgix","cloudinary","akamai","custom"],a={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,maximumResponseBody:5e7,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},60033,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getImgProps",{enumerable:!0,get:function(){return u}}),e.r(86051);let r=e.r(26159),i=e.r(31330),s=e.r(4558),a=["-moz-initial","fill","none","scale-down",void 0];function o(e){return void 0!==e.default}function l(e){return void 0===e?e:"number"==typeof e?Number.isFinite(e)?e:NaN:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function u({src:e,sizes:t,unoptimized:n=!1,priority:u=!1,preload:h=!1,loading:c,className:d,quality:f,width:p,height:m,fill:g=!1,style:y,overrideSrc:v,onLoad:w,onLoadingComplete:b,placeholder:x="empty",blurDataURL:E,fetchPriority:S,decoding:T="async",layout:I,objectFit:_,objectPosition:C,lazyBoundary:A,lazyRoot:D,...k},P){var M;let N,R,O,{imgConf:L,showAltText:V,blurComplete:F,defaultLoader:B}=P,j=L||s.imageConfigDefault;if("allSizes"in j)N=j;else{let e=[...j.deviceSizes,...j.imageSizes].sort((e,t)=>e-t),t=j.deviceSizes.sort((e,t)=>e-t),n=j.qualities?.sort((e,t)=>e-t);N={...j,allSizes:e,deviceSizes:t,qualities:n}}if(void 0===B)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let U=k.loader||B;delete k.loader,delete k.srcSet;let q="__next_img_default"in U;if(q){if("custom"===N.loader)throw Object.defineProperty(Error(`Image with src "${e}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let e=U;U=t=>{let{config:n,...r}=t;return e(r)}}if(I){"fill"===I&&(g=!0);let e={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[I];e&&(y={...y,...e});let n={responsive:"100vw",fill:"100vw"}[I];n&&!t&&(t=n)}let z="",$=l(p),G=l(m);if((M=e)&&"object"==typeof M&&(o(M)||void 0!==M.src)){let t=o(e)?e.default:e;if(!t.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!t.height||!t.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(R=t.blurWidth,O=t.blurHeight,E=E||t.blurDataURL,z=t.src,!g)if($||G){if($&&!G){let e=$/t.width;G=Math.round(t.height*e)}else if(!$&&G){let e=G/t.height;$=Math.round(t.width*e)}}else $=t.width,G=t.height}let K=!u&&!h&&("lazy"===c||void 0===c);(!(e="string"==typeof e?e:z)||e.startsWith("data:")||e.startsWith("blob:"))&&(n=!0,K=!1),N.unoptimized&&(n=!0),q&&!N.dangerouslyAllowSVG&&e.split("?",1)[0].endsWith(".svg")&&(n=!0);let H=l(f),W=Object.assign(g?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:_,objectPosition:C}:{},V?{}:{color:"transparent"},y),Q=F||"empty"===x?null:"blur"===x?`url("data:image/svg+xml;charset=utf-8,${(0,i.getImageBlurSvg)({widthInt:$,heightInt:G,blurWidth:R,blurHeight:O,blurDataURL:E||"",objectFit:W.objectFit})}")`:`url("${x}")`,Y=a.includes(W.objectFit)?"fill"===W.objectFit?"100% 100%":"cover":W.objectFit,X=Q?{backgroundSize:Y,backgroundPosition:W.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:Q}:{},J=function({config:e,src:t,unoptimized:n,width:i,quality:s,sizes:a,loader:o}){if(n){let e=(0,r.getDeploymentId)();if(t.startsWith("/")&&!t.startsWith("//")&&e){let n=t.includes("?")?"&":"?";t=`${t}${n}dpl=${e}`}return{src:t,srcSet:void 0,sizes:void 0}}let{widths:l,kind:u}=function({deviceSizes:e,allSizes:t},n,r){if(r){let n=/(^|\s)(1?\d?\d)vw/g,i=[];for(let e;e=n.exec(r);)i.push(parseInt(e[2]));if(i.length){let n=.01*Math.min(...i);return{widths:t.filter(t=>t>=e[0]*n),kind:"w"}}return{widths:t,kind:"w"}}return"number"!=typeof n?{widths:e,kind:"w"}:{widths:[...new Set([n,2*n].map(e=>t.find(t=>t>=e)||t[t.length-1]))],kind:"x"}}(e,i,a),h=l.length-1;return{sizes:a||"w"!==u?a:"100vw",srcSet:l.map((n,r)=>`${o({config:e,src:t,quality:s,width:n})} ${"w"===u?n:r+1}${u}`).join(", "),src:o({config:e,src:t,quality:s,width:l[h]})}}({config:N,src:e,unoptimized:n,width:$,quality:H,sizes:t,loader:U}),Z=K?"lazy":c;return{props:{...k,loading:Z,fetchPriority:S,width:$,height:G,decoding:T,className:d,style:{...W,...X},sizes:J.sizes,srcSet:J.srcSet,src:v||J.src},meta:{unoptimized:n,preload:h||u,placeholder:x,fill:g}}}},98096,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return o}});let r=e.r(30668),i="u"<typeof window,s=i?()=>{}:r.useLayoutEffect,a=i?()=>{}:r.useEffect;function o(e){let{headManager:t,reduceComponentsToState:n}=e;function o(){if(t&&t.mountedInstances){let e=r.Children.toArray(Array.from(t.mountedInstances).filter(Boolean));t.updateHead(n(e))}}return i&&(t?.mountedInstances?.add(e.children),o()),s(()=>(t?.mountedInstances?.add(e.children),()=>{t?.mountedInstances?.delete(e.children)})),s(()=>(t&&(t._pendingUpdate=o),()=>{t&&(t._pendingUpdate=o)})),a(()=>(t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null),()=>{t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null)})),null}},8706,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={default:function(){return m},defaultHead:function(){return c}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(35856),a=e.r(61909),o=e.r(48277),l=a._(e.r(30668)),u=s._(e.r(98096)),h=e.r(98084);function c(){return[(0,o.jsx)("meta",{charSet:"utf-8"},"charset"),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function d(e,t){return"string"==typeof t||"number"==typeof t?e:t.type===l.default.Fragment?e.concat(l.default.Children.toArray(t.props.children).reduce((e,t)=>"string"==typeof t||"number"==typeof t?e:e.concat(t),[])):e.concat(t)}e.r(86051);let f=["name","httpEquiv","charSet","itemProp"];function p(e){let t,n,r,i;return e.reduce(d,[]).reverse().concat(c().reverse()).filter((t=new Set,n=new Set,r=new Set,i={},e=>{let s=!0,a=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){a=!0;let n=e.key.slice(e.key.indexOf("$")+1);t.has(n)?s=!1:t.add(n)}switch(e.type){case"title":case"base":n.has(e.type)?s=!1:n.add(e.type);break;case"meta":for(let t=0,n=f.length;t<n;t++){let n=f[t];if(e.props.hasOwnProperty(n))if("charSet"===n)r.has(n)?s=!1:r.add(n);else{let t=e.props[n],r=i[n]||new Set;("name"!==n||!a)&&r.has(t)?s=!1:(r.add(t),i[n]=r)}}}return s})).reverse().map((e,t)=>{let n=e.key||t;return l.default.cloneElement(e,{key:n})})}let m=function({children:e}){let t=(0,l.useContext)(h.HeadManagerContext);return(0,o.jsx)(u.default,{reduceComponentsToState:p,headManager:t,children:e})};("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},9586,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ImageConfigContext",{enumerable:!0,get:function(){return s}});let r=e.r(35856)._(e.r(30668)),i=e.r(4558),s=r.default.createContext(i.imageConfigDefault)},34832,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"RouterContext",{enumerable:!0,get:function(){return r}});let r=e.r(35856)._(e.r(30668)).default.createContext(null)},44606,(e,t,n)=>{"use strict";function r(e,t){let n=e||75;return t?.qualities?.length?t.qualities.reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e,0):n}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"findClosestQuality",{enumerable:!0,get:function(){return r}})},23979,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return a}});let r=e.r(44606),i=e.r(26159);function s({config:e,src:t,width:n,quality:s}){if(t.startsWith("/")&&t.includes("?")&&e.localPatterns?.length===1&&"**"===e.localPatterns[0].pathname&&""===e.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${t}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let a=(0,r.findClosestQuality)(s,e),o=(0,i.getDeploymentId)();return`${e.path}?url=${encodeURIComponent(t)}&w=${n}&q=${a}${t.startsWith("/")&&o?`&dpl=${o}`:""}`}s.__next_img_default=!0;let a=s},40067,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"useMergedRef",{enumerable:!0,get:function(){return i}});let r=e.r(30668);function i(e,t){let n=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=n.current;e&&(n.current=null,e());let t=i.current;t&&(i.current=null,t())}else e&&(n.current=s(e,r)),t&&(i.current=s(t,r))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let n=e(t);return"function"==typeof n?n:()=>e(null)}}("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},3417,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Image",{enumerable:!0,get:function(){return b}});let r=e.r(35856),i=e.r(61909),s=e.r(48277),a=i._(e.r(30668)),o=r._(e.r(69941)),l=r._(e.r(8706)),u=e.r(60033),h=e.r(4558),c=e.r(9586);e.r(86051);let d=e.r(34832),f=r._(e.r(23979)),p=e.r(40067),m={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function g(e,t,n,r,i,s,a){let o=e?.src;e&&e["data-loaded-src"]!==o&&(e["data-loaded-src"]=o,("decode"in e?e.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(e.parentElement&&e.isConnected){if("empty"!==t&&i(!0),n?.current){let t=new Event("load");Object.defineProperty(t,"target",{writable:!1,value:e});let r=!1,i=!1;n.current({...t,nativeEvent:t,currentTarget:e,target:e,isDefaultPrevented:()=>r,isPropagationStopped:()=>i,persist:()=>{},preventDefault:()=>{r=!0,t.preventDefault()},stopPropagation:()=>{i=!0,t.stopPropagation()}})}r?.current&&r.current(e)}}))}function y(e){return a.use?{fetchPriority:e}:{fetchpriority:e}}"u"<typeof window&&(globalThis.__NEXT_IMAGE_IMPORTED=!0);let v=(0,a.forwardRef)(({src:e,srcSet:t,sizes:n,height:r,width:i,decoding:o,className:l,style:u,fetchPriority:h,placeholder:c,loading:d,unoptimized:f,fill:m,onLoadRef:v,onLoadingCompleteRef:w,setBlurComplete:b,setShowAltText:x,sizesInput:E,onLoad:S,onError:T,...I},_)=>{let C=(0,a.useCallback)(e=>{e&&(T&&(e.src=e.src),e.complete&&g(e,c,v,w,b,f,E))},[e,c,v,w,b,T,f,E]),A=(0,p.useMergedRef)(_,C);return(0,s.jsx)("img",{...I,...y(h),loading:d,width:i,height:r,decoding:o,"data-nimg":m?"fill":"1",className:l,style:u,sizes:n,srcSet:t,src:e,ref:A,onLoad:e=>{g(e.currentTarget,c,v,w,b,f,E)},onError:e=>{x(!0),"empty"!==c&&b(!0),T&&T(e)}})});function w({isAppRouter:e,imgAttributes:t}){let n={as:"image",imageSrcSet:t.srcSet,imageSizes:t.sizes,crossOrigin:t.crossOrigin,referrerPolicy:t.referrerPolicy,...y(t.fetchPriority)};return e&&o.default.preload?(o.default.preload(t.src,n),null):(0,s.jsx)(l.default,{children:(0,s.jsx)("link",{rel:"preload",href:t.srcSet?void 0:t.src,...n},"__nimg-"+t.src+t.srcSet+t.sizes)})}let b=(0,a.forwardRef)((e,t)=>{let n=(0,a.useContext)(d.RouterContext),r=(0,a.useContext)(c.ImageConfigContext),i=(0,a.useMemo)(()=>{let e=m||r||h.imageConfigDefault,t=[...e.deviceSizes,...e.imageSizes].sort((e,t)=>e-t),n=e.deviceSizes.sort((e,t)=>e-t),i=e.qualities?.sort((e,t)=>e-t);return{...e,allSizes:t,deviceSizes:n,qualities:i,localPatterns:"u"<typeof window?r?.localPatterns:e.localPatterns}},[r]),{onLoad:o,onLoadingComplete:l}=e,p=(0,a.useRef)(o);(0,a.useEffect)(()=>{p.current=o},[o]);let g=(0,a.useRef)(l);(0,a.useEffect)(()=>{g.current=l},[l]);let[y,b]=(0,a.useState)(!1),[x,E]=(0,a.useState)(!1),{props:S,meta:T}=(0,u.getImgProps)(e,{defaultLoader:f.default,imgConf:i,blurComplete:y,showAltText:x});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v,{...S,unoptimized:T.unoptimized,placeholder:T.placeholder,fill:T.fill,onLoadRef:p,onLoadingCompleteRef:g,setBlurComplete:b,setShowAltText:E,sizesInput:e.sizes,ref:t}),T.preload?(0,s.jsx)(w,{isAppRouter:!n,imgAttributes:S}):null]})});("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},44449,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={default:function(){return h},getImageProps:function(){return u}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(35856),a=e.r(60033),o=e.r(3417),l=s._(e.r(23979));function u(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let h=o.Image},42588,(e,t,n)=>{t.exports=e.r(44449)},78113,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[h++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(function(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=a(s),u=l.write(r,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,n);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return I(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return C(e).length;default:if(i)return r?-1:I(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=k[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return v(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,a=n,0===s&&a===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),h=e.slice(t,n),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)};function v(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return p}function w(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function x(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function E(e,t,n,r,s){return t*=1,n>>>=0,s||x(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function S(e,t,n,r,s){return t*=1,n>>>=0,s||x(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,A(I(e,this.length-i),this,i,s);case"ascii":return a=t,o=n,A(_(e),this,a,o);case"latin1":case"binary":return function(e,t,n,r){return A(_(t),e,n,r)}(this,e,t,n);case"base64":return l=t,u=n,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,A(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return E(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return E(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return S(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return S(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function I(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function _(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function C(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var k=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=p,a/=256,u-=8);e[n+f-p]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},a=!0;try{r[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="/ROOT/frontend/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},48985,e=>{"use strict";let t,n,r,i,s,a;var o,l,u,h,c,d,f,p,m,g,y,v,w,b,x,E,S,T=e.i(48277),I=e.i(30668),_=e.i(62870),C=e.i(44354),A=e.i(42588);let D=()=>(0,T.jsxs)("div",{style:{position:"fixed",top:"calc(var(--tg-content-safe-area-inset-top, 0px) + 5%)",left:"calc(var(--tg-content-safe-area-inset-left, 0px) + 5%)",display:"flex",alignItems:"center",gap:"12px",width:"fit-content",height:"60px",zIndex:1e3,pointerEvents:"none"},children:[(0,T.jsx)(A.default,{src:"/touch.svg",alt:"Touch",width:32,height:32}),(0,T.jsx)("span",{style:{fontSize:"13px",lineHeight:"1",color:"#000"},children:"Коснись карты и создай Pin"})]});function k({onLocation:e}){return(0,I.useEffect)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e([t.coords.longitude,t.coords.latitude])},e=>{console.error("Ошибка получения геолокации:",e)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):console.error("Geolocation not supported")},[e]),null}let P=({mapRef:e})=>(0,T.jsx)("button",{onClick:()=>{e.current&&e.current.getMap().flyTo({zoom:1,essential:!0,duration:1e3})},style:{position:"fixed",top:"calc(var(--tg-content-safe-area-inset-top, 0px) + 7%)",right:"calc(var(--tg-content-safe-area-inset-right, 0px) + 5%)",width:60,height:60,borderRadius:14,border:"1px solid rgba(240,240,240,0.08)",background:"rgba(240,240,240,0.35)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(px)",padding:0,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:20,boxShadow:"0 8px 24px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.05)",color:"#fff"},title:"Zoom2",children:(0,T.jsx)(A.default,{src:"/zoom2.svg",alt:"zoom2",style:{width:"90%",height:"90%"}})}),M=({mapRef:e,minPitch:t=0,maxPitch:n=60})=>{let[r,i]=(0,I.useState)(t);return(0,T.jsxs)("div",{style:{position:"fixed",right:"5%",top:"50%",transform:"translateY(-50%)",zIndex:5,display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[(0,T.jsx)("input",{type:"range",min:t,max:n,value:r,onChange:t=>{let n=Number(t.target.value);i(n),e.current&&e.current.getMap().easeTo({pitch:n,duration:300})},style:{writingMode:"vertical-rl",WebkitAppearance:"slider-vertical",width:12,height:220,borderRadius:4,background:"rgba(255,255,255,0.2)",accentColor:"#000",cursor:"pointer"}}),(0,T.jsxs)("span",{style:{color:"#fff",fontSize:14},children:[Math.round(r),"°"]})]})},N=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],R=new Set(N),O=(e,t,n)=>n>t?t:n<e?e:n,L={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},V={...L,transform:e=>O(0,1,e)},F={...L,default:1},B=e=>Math.round(1e5*e)/1e5,j=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,U=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,q=(e,t)=>n=>!!("string"==typeof n&&U.test(n)&&n.startsWith(e)||t&&null!=n&&Object.prototype.hasOwnProperty.call(n,t)),z=(e,t,n)=>r=>{if("string"!=typeof r)return r;let[i,s,a,o]=r.match(j);return{[e]:parseFloat(i),[t]:parseFloat(s),[n]:parseFloat(a),alpha:void 0!==o?parseFloat(o):1}},$={...L,transform:e=>Math.round(O(0,255,e))},G={test:q("rgb","red"),parse:z("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+$.transform(e)+", "+$.transform(t)+", "+$.transform(n)+", "+B(V.transform(r))+")"},K={test:q("#"),parse:function(e){let t="",n="",r="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:G.transform},H=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),W=H("deg"),Q=H("%"),Y=H("px"),X=H("vh"),J=H("vw"),Z={...Q,parse:e=>Q.parse(e)/100,transform:e=>Q.transform(100*e)},ee={test:q("hsl","hue"),parse:z("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:r=1})=>"hsla("+Math.round(e)+", "+Q.transform(B(t))+", "+Q.transform(B(n))+", "+B(V.transform(r))+")"},et={test:e=>G.test(e)||K.test(e)||ee.test(e),parse:e=>G.test(e)?G.parse(e):ee.test(e)?ee.parse(e):K.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?G.transform(e):ee.transform(e),getAnimatableNone:e=>{let t=et.parse(e);return t.alpha=0,et.transform(t)}},en=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,er="number",ei="color",es=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ea(e){let t=e.toString(),n=[],r={color:[],number:[],var:[]},i=[],s=0,a=t.replace(es,e=>(et.test(e)?(r.color.push(s),i.push(ei),n.push(et.parse(e))):e.startsWith("var(")?(r.var.push(s),i.push("var"),n.push(e)):(r.number.push(s),i.push(er),n.push(parseFloat(e))),++s,"${}")).split("${}");return{values:n,split:a,indexes:r,types:i}}function eo(e){return ea(e).values}function el(e){let{split:t,types:n}=ea(e),r=t.length;return e=>{let i="";for(let s=0;s<r;s++)if(i+=t[s],void 0!==e[s]){let t=n[s];t===er?i+=B(e[s]):t===ei?i+=et.transform(e[s]):i+=e[s]}return i}}let eu=e=>"number"==typeof e?0:et.test(e)?et.getAnimatableNone(e):e,eh={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(j)?.length||0)+(e.match(en)?.length||0)>0},parse:eo,createTransformer:el,getAnimatableNone:function(e){let t=eo(e);return el(e)(t.map(eu))}},ec=new Set(["brightness","contrast","saturate","opacity"]);function ed(e){let[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;let[r]=n.match(j)||[];if(!r)return e;let i=n.replace(r,""),s=+!!ec.has(t);return r!==n&&(s*=100),t+"("+s+i+")"}let ef=/\b([a-z-]*)\(.*?\)/gu,ep={...eh,getAnimatableNone:e=>{let t=e.match(ef);return t?t.map(ed).join(" "):e}},em={...L,transform:Math.round},eg={borderWidth:Y,borderTopWidth:Y,borderRightWidth:Y,borderBottomWidth:Y,borderLeftWidth:Y,borderRadius:Y,borderTopLeftRadius:Y,borderTopRightRadius:Y,borderBottomRightRadius:Y,borderBottomLeftRadius:Y,width:Y,maxWidth:Y,height:Y,maxHeight:Y,top:Y,right:Y,bottom:Y,left:Y,inset:Y,insetBlock:Y,insetBlockStart:Y,insetBlockEnd:Y,insetInline:Y,insetInlineStart:Y,insetInlineEnd:Y,padding:Y,paddingTop:Y,paddingRight:Y,paddingBottom:Y,paddingLeft:Y,paddingBlock:Y,paddingBlockStart:Y,paddingBlockEnd:Y,paddingInline:Y,paddingInlineStart:Y,paddingInlineEnd:Y,margin:Y,marginTop:Y,marginRight:Y,marginBottom:Y,marginLeft:Y,marginBlock:Y,marginBlockStart:Y,marginBlockEnd:Y,marginInline:Y,marginInlineStart:Y,marginInlineEnd:Y,fontSize:Y,backgroundPositionX:Y,backgroundPositionY:Y,rotate:W,rotateX:W,rotateY:W,rotateZ:W,scale:F,scaleX:F,scaleY:F,scaleZ:F,skew:W,skewX:W,skewY:W,distance:Y,translateX:Y,translateY:Y,translateZ:Y,x:Y,y:Y,z:Y,perspective:Y,transformPerspective:Y,opacity:V,originX:Z,originY:Z,originZ:Y,zIndex:em,fillOpacity:V,strokeOpacity:V,numOctaves:em},ey={...eg,color:et,backgroundColor:et,outlineColor:et,fill:et,stroke:et,borderColor:et,borderTopColor:et,borderRightColor:et,borderBottomColor:et,borderLeftColor:et,filter:ep,WebkitFilter:ep},ev=e=>ey[e],ew=()=>({translate:0,scale:1,origin:0,originPoint:0}),eb=()=>({x:ew(),y:ew()}),ex=()=>({min:0,max:0}),eE=()=>({x:ex(),y:ex()}),eS=e=>!!(e&&e.getVelocity),eT=new Set(["width","height","top","left","right","bottom",...N]),eI=e=>t=>t.test(e),e_=[L,Y,Q,W,J,X,{test:e=>"auto"===e,parse:e=>e}],eC=e=>e_.find(eI(e));var eA=e.i(39057);let eD=()=>{},ek=()=>{};eA.default;let eP=e=>t=>"string"==typeof t&&t.startsWith(e),eM=eP("--"),eN=eP("var(--"),eR=e=>!!eN(e)&&eO.test(e.split("/*")[0].trim()),eO=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function eL(e){return"string"==typeof e&&e.split("/*")[0].includes("var(--")}let eV=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u,eF=e=>180*e/Math.PI,eB=e=>eU(eF(Math.atan2(e[1],e[0]))),ej={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:eB,rotateZ:eB,skewX:e=>eF(Math.atan(e[1])),skewY:e=>eF(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},eU=e=>((e%=360)<0&&(e+=360),e),eq=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),ez=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),e$={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:eq,scaleY:ez,scale:e=>(eq(e)+ez(e))/2,rotateX:e=>eU(eF(Math.atan2(e[6],e[5]))),rotateY:e=>eU(eF(Math.atan2(-e[2],e[0]))),rotateZ:eB,rotate:eB,skewX:e=>eF(Math.atan(e[4])),skewY:e=>eF(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function eG(e){return+!!e.includes("scale")}function eK(e,t){let n,r;if(!e||"none"===e)return eG(t);let i=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);if(i)n=e$,r=i;else{let t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=ej,r=t}if(!r)return eG(t);let s=n[t],a=r[1].split(",").map(eH);return"function"==typeof s?s(a):a[s]}function eH(e){return parseFloat(e.trim())}let eW=e=>e===L||e===Y,eQ=new Set(["x","y","z"]),eY=N.filter(e=>!eQ.has(e)),eX={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>eK(t,"x"),y:(e,{transform:t})=>eK(t,"y")};eX.translateX=eX.x,eX.translateY=eX.y;let eJ=e=>e,eZ={},e0=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function e1(e,t){let n=!1,r=!0,i={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,a=e0.reduce((e,n)=>(e[n]=function(e,t){let n=new Set,r=new Set,i=!1,s=!1,a=new WeakSet,o={delta:0,timestamp:0,isProcessing:!1},l=0;function u(t){a.has(t)&&(h.schedule(t),e()),l++,t(o)}let h={schedule:(e,t=!1,s=!1)=>{let o=s&&i?n:r;return t&&a.add(e),o.has(e)||o.add(e),e},cancel:e=>{r.delete(e),a.delete(e)},process:e=>{if(o=e,i){s=!0;return}i=!0,[n,r]=[r,n],n.forEach(u),t,l=0,n.clear(),i=!1,s&&(s=!1,h.process(e))}};return h}(s,t?n:void 0),e),{}),{setup:o,read:l,resolveKeyframes:u,preUpdate:h,update:c,preRender:d,render:f,postRender:p}=a,m=()=>{let s=eZ.useManualTiming?i.timestamp:performance.now();n=!1,eZ.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(s-i.timestamp,40),1)),i.timestamp=s,i.isProcessing=!0,o.process(i),l.process(i),u.process(i),h.process(i),c.process(i),d.process(i),f.process(i),p.process(i),i.isProcessing=!1,n&&t&&(r=!1,e(m))};return{schedule:e0.reduce((t,s)=>{let o=a[s];return t[s]=(t,s=!1,a=!1)=>(!n&&(n=!0,r=!0,i.isProcessing||e(m)),o.schedule(t,s,a)),t},{}),cancel:e=>{for(let t=0;t<e0.length;t++)a[e0[t]].cancel(e)},state:i,steps:a}}let{schedule:e2,cancel:e3,state:e5,steps:e6}=e1("u">typeof requestAnimationFrame?requestAnimationFrame:eJ,!0),e4=new Set,e8=!1,e9=!1,e7=!1;function te(){if(e9){let e=Array.from(e4).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{let t,r=(t=[],eY.forEach(n=>{let r=e.getValue(n);void 0!==r&&(t.push([n,r.get()]),r.set(+!!n.startsWith("scale")))}),t);r.length&&(n.set(e,r),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();let t=n.get(e);t&&t.forEach(([t,n])=>{e.getValue(t)?.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}e9=!1,e8=!1,e4.forEach(e=>e.complete(e7)),e4.clear()}function tt(){e4.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(e9=!0)})}class tn{constructor(e,t,n,r,i,s=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=i,this.isAsync=s}scheduleResolve(){this.state="scheduled",this.isAsync?(e4.add(this),e8||(e8=!0,e2.read(tt),e2.resolveKeyframes(te))):(this.readKeyframes(),this.complete())}readKeyframes(){let{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(null===e[0]){let i=r?.get(),s=e[e.length-1];if(void 0!==i)e[0]=i;else if(n&&t){let r=n.readValue(t,s);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=s),r&&void 0===i&&r.set(e[0])}for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),e4.delete(this)}cancel(){"scheduled"===this.state&&(e4.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}function tr(e,t){let n=ev(e);return n!==ep&&(n=eh),n.getAnimatableNone?n.getAnimatableNone(t):void 0}let ti=new Set(["auto","none","0"]);class ts extends tn{constructor(e,t,n,r,i){super(e,t,n,r,i,!0)}readKeyframes(){let{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let n=0;n<e.length;n++){let r=e[n];if("string"==typeof r&&eR(r=r.trim())){let i=function e(t,n,r=1){ek(r<=4,`Max CSS variable fallback depth detected in property "${t}". This may indicate a circular fallback dependency.`,"max-css-var-depth");let[i,s]=function(e){let t=eV.exec(e);if(!t)return[,];let[,n,r,i]=t;return[`--${n??r}`,i]}(t);if(!i)return;let a=window.getComputedStyle(n).getPropertyValue(i);if(a){let e=a.trim();return/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e)?parseFloat(e):e}return eR(s)?e(s,n,r+1):s}(r,t.current);void 0!==i&&(e[n]=i),n===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!eT.has(n)||2!==e.length)return;let[r,i]=e,s=eC(r),a=eC(i);if(eL(r)!==eL(i)&&eX[n]){this.needsMeasurement=!0;return}if(s!==a)if(eW(s)&&eW(a))for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n&&(e[t]=parseFloat(n))}else eX[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){let{unresolvedKeyframes:e,name:t}=this,n=[];for(let t=0;t<e.length;t++)(null===e[t]||function(e){if("number"==typeof e)return 0===e;if(null===e)return!0;return"none"===e||"0"===e||/^0[^.\s]+$/u.test(e)}(e[t]))&&n.push(t);n.length&&function(e,t,n){let r,i=0;for(;i<e.length&&!r;){let t=e[i];"string"==typeof t&&!ti.has(t)&&ea(t).values.length&&(r=e[i]),i++}if(r&&n)for(let i of t)e[i]=tr(n,r)}(e,n,t)}measureInitialState(){let{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=eX[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;let r=t[t.length-1];void 0!==r&&e.getValue(n,r).jump(r,!1)}measureEndState(){let{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;let r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);let i=n.length-1,s=n[i];n[i]=eX[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==s&&void 0===this.finalKeyframe&&(this.finalKeyframe=s),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,n])=>{e.getValue(t).set(n)}),this.resolveNoneKeyframes()}}function ta(e,t){-1===e.indexOf(t)&&e.push(t)}function to(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}class tl{constructor(){this.subscriptions=[]}add(e){return ta(this.subscriptions,e),()=>to(this.subscriptions,e)}notify(e,t,n){let r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){let r=this.subscriptions[i];r&&r(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}let{schedule:tu}=e1(queueMicrotask,!1);function th(){t=void 0}let tc={now:()=>(void 0===t&&tc.set(e5.isProcessing||eZ.useManualTiming?e5.timestamp:performance.now()),t),set:e=>{t=e,queueMicrotask(th)}};class td{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{let t=tc.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(let e of this.dependents)e.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=tc.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=!isNaN(parseFloat(this.current)))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new tl);let n=this.events[e].add(t);return"change"===e?()=>{n(),e2.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(let e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return s&&s.push(this),this.current}getPrevious(){return this.prev}getVelocity(){var e;let t=tc.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||t-this.updatedAt>30)return 0;let n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return e=parseFloat(this.current)-parseFloat(this.prevFrameValue),n?1e3/n*e:0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function tf(e,t){return new td(e,t)}let tp=[...e_,et,eh],tm={current:null},tg={current:!1},ty="u">typeof window,tv=new WeakMap;function tw(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function tb(e){return"string"==typeof e||Array.isArray(e)}let tx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],tE=["initial",...tx];function tS(e){return tw(e.animate)||tE.some(t=>tb(e[t]))}function tT(e){return!!(tS(e)||e.variants)}function tI(e){let t=[{},{}];return e?.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function t_(e,t,n,r){if("function"==typeof t){let[i,s]=tI(r);t=t(void 0!==n?n:e.custom,i,s)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){let[i,s]=tI(r);t=t(void 0!==n?n:e.custom,i,s)}return t}let tC=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],tA={};class tD{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:i,visualState:s},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=tn,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{let e=tc.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,e2.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=s;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=tS(t),this.isVariantNode=tT(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const e in h){const t=h[e];void 0!==o[e]&&eS(t)&&t.set(o[e])}}mount(e){this.current=e,tv.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),"never"===this.reducedMotionConfig?this.shouldReduceMotion=!1:"always"===this.reducedMotionConfig?this.shouldReduceMotion=!0:(tg.current||function(){if(tg.current=!0,ty)if(window.matchMedia){let e=window.matchMedia("(prefers-reduced-motion)"),t=()=>tm.current=e.matches;e.addEventListener("change",t),t()}else tm.current=!1}(),this.shouldReduceMotion=tm.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){for(let e in this.projection&&this.projection.unmount(),e3(this.notifyUpdate),e3(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this),this.events)this.events[e].clear();for(let e in this.features){let t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){let n;this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();let r=R.has(e);r&&this.onBindTransform&&this.onBindTransform();let i=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&e2.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});"u">typeof window&&window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in tA){let t=tA[e];if(!t)continue;let{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){let t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):eE()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let t=0;t<tC.length;t++){let n=tC[t];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);let r=e["on"+n];r&&(this.propEventSubscriptions[n]=this.on(n,r))}this.prevMotionValues=function(e,t,n){for(let r in t){let i=t[r],s=n[r];if(eS(i))e.addValue(r,i);else if(eS(s))e.addValue(r,tf(i,{owner:e}));else if(s!==i)if(e.hasValue(r)){let t=e.getValue(r);!0===t.liveStyle?t.jump(i):t.hasAnimated||t.set(i)}else{let t=e.getStaticValue(r);e.addValue(r,tf(void 0!==t?t:i,{owner:e}))}}for(let r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){let t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){let n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);let t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=tf(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];if(null!=n){let r,i;if("string"==typeof n&&(r=n,/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r)||(i=n,/^0[^.\s]+$/u.test(i))))n=parseFloat(n);else{let r;r=n,!tp.find(eI(r))&&eh.test(t)&&(n=tr(e,t))}this.setBaseTarget(e,eS(n)?n.get():n)}return eS(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){let t,{initial:n}=this.props;if("string"==typeof n||"object"==typeof n){let r=t_(this.props,n,this.presenceContext?.custom);r&&(t=r[e])}if(n&&void 0!==t)return t;let r=this.getBaseTargetFromProps(this.props,e);return void 0===r||eS(r)?void 0!==this.initialValues[e]&&void 0===t?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new tl),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){tu.render(this.render)}}class tk extends tD{constructor(){super(...arguments),this.KeyframeResolver=ts}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){let n=e.style;return n?n[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);let{children:e}=this.props;eS(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function tP(e){return e.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}let tM=(e,t)=>t&&"number"==typeof e?t.transform(e):e,tN={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tR=N.length;function tO(e,t,n){let{style:r,vars:i,transformOrigin:s}=e,a=!1,o=!1;for(let e in t){let n=t[e];if(R.has(e)){a=!0;continue}if(eM(e)){i[e]=n;continue}{let t=tM(n,eg[e]);e.startsWith("origin")?(o=!0,s[e]=t):r[e]=t}}if(!t.transform&&(a||n?r.transform=function(e,t,n){let r="",i=!0;for(let s=0;s<tR;s++){let a=N[s],o=e[a];if(void 0===o)continue;let l=!0;if("number"==typeof o)l=o===+!!a.startsWith("scale");else{let e=parseFloat(o);l=a.startsWith("scale")?1===e:0===e}if(!l||n){let e=tM(o,eg[a]);if(!l){i=!1;let t=tN[a]||a;r+=`${t}(${e}) `}n&&(t[a]=e)}}return r=r.trim(),n?r=n(t,i?"":r):i&&(r="none"),r}(t,e.transform,n):r.transform&&(r.transform="none")),o){let{originX:e="50%",originY:t="50%",originZ:n=0}=s;r.transformOrigin=`${e} ${t} ${n}`}}let tL={offset:"stroke-dashoffset",array:"stroke-dasharray"},tV={offset:"strokeDashoffset",array:"strokeDasharray"},tF=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function tB(e,{attrX:t,attrY:n,attrScale:r,pathLength:i,pathSpacing:s=1,pathOffset:a=0,...o},l,u,h){if(tO(e,o,u),l){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};let{attrs:c,style:d}=e;for(let e of(c.transform&&(d.transform=c.transform,delete c.transform),(d.transform||c.transformOrigin)&&(d.transformOrigin=c.transformOrigin??"50% 50%",delete c.transformOrigin),d.transform&&(d.transformBox=h?.transformBox??"fill-box",delete c.transformBox),tF))void 0!==c[e]&&(d[e]=c[e],delete c[e]);void 0!==t&&(c.x=t),void 0!==n&&(c.y=n),void 0!==r&&(c.scale=r),void 0!==i&&function(e,t,n=1,r=0,i=!0){e.pathLength=1;let s=i?tL:tV;e[s.offset]=`${-r}`,e[s.array]=`${t} ${n}`}(c,i,s,a,!1)}let tj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),tU=e=>"string"==typeof e&&"svg"===e.toLowerCase();function tq(e,{style:t,vars:n},r,i){let s,a=e.style;for(s in t)a[s]=t[s];for(s in i?.applyProjectionStyles(a,r),n)a.setProperty(s,n[s])}function tz(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}let t$={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e)if(!Y.test(e))return e;else e=parseFloat(e);let n=tz(e,t.target.x),r=tz(e,t.target.y);return`${n}% ${r}%`}},tG=(e,t,n)=>e+(t-e)*n,tK={borderRadius:{...t$,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:t$,borderTopRightRadius:t$,borderBottomLeftRadius:t$,borderBottomRightRadius:t$,boxShadow:{correct:(e,{treeScale:t,projectionDelta:n})=>{let r=eh.parse(e);if(r.length>5)return e;let i=eh.createTransformer(e),s=+("number"!=typeof r[0]),a=n.x.scale*t.x,o=n.y.scale*t.y;r[0+s]/=a,r[1+s]/=o;let l=tG(a,o,.5);return"number"==typeof r[2+s]&&(r[2+s]/=l),"number"==typeof r[3+s]&&(r[3+s]/=l),i(r)}}};function tH(e,{layout:t,layoutId:n}){return R.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!tK[e]||"opacity"===e)}function tW(e,t,n){let r=e.style,i=t?.style,s={};if(!r)return s;for(let t in r)(eS(r[t])||i&&eS(i[t])||tH(t,e)||n?.getValue(t)?.liveStyle!==void 0)&&(s[t]=r[t]);return s}function tQ(e,t,n){let r=tW(e,t,n);for(let n in e)(eS(e[n])||eS(t[n]))&&(r[-1!==N.indexOf(n)?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n]=e[n]);return r}class tY extends tk{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=eE}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(R.has(t)){let e=ev(t);return e&&e.default||0}return t=tj.has(t)?t:tP(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return tQ(e,t,n)}build(e,t,n){tB(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){for(let n in tq(e,t,void 0,r),t.attrs)e.setAttribute(tj.has(n)?n:tP(n),t.attrs[n])}mount(e){this.isSVGTag=tU(e.tagName),super.mount(e)}}function tX({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function tJ(e){return void 0===e||1===e}function tZ({scale:e,scaleX:t,scaleY:n}){return!tJ(e)||!tJ(t)||!tJ(n)}function t0(e){return tZ(e)||t1(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function t1(e){var t,n;return(t=e.x)&&"0%"!==t||(n=e.y)&&"0%"!==n}function t2(e,t,n,r,i){return void 0!==i&&(e=r+i*(e-r)),r+n*(e-r)+t}function t3(e,t=0,n=1,r,i){e.min=t2(e.min,t,n,r,i),e.max=t2(e.max,t,n,r,i)}function t5(e,{x:t,y:n}){t3(e.x,t.translate,t.scale,t.originPoint),t3(e.y,n.translate,n.scale,n.originPoint)}function t6(e,t){e.min=e.min+t,e.max=e.max+t}function t4(e,t,n,r,i=.5){let s=tG(e.min,e.max,i);t3(e,t,n,s,r)}function t8(e,t){t4(e.x,t.x,t.scaleX,t.scale,t.originX),t4(e.y,t.y,t.scaleY,t.scale,t.originY)}function t9(e,t){return tX(function(e,t){if(!t)return e;let n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),t))}class t7 extends tk{constructor(){super(...arguments),this.type="html",this.renderInstance=tq}readValueFromInstance(e,t){if(R.has(t))return this.projection?.isProjecting?eG(t):((e,t)=>{let{transform:n="none"}=getComputedStyle(e);return eK(n,t)})(e,t);{let n=window.getComputedStyle(e),r=(eM(t)?n.getPropertyValue(t):n[t])||0;return"string"==typeof r?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return t9(e,t)}build(e,t,n){tO(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return tW(e,t,n)}}let ne=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function nt(e){if("string"!=typeof e||e.includes("-"));else if(ne.indexOf(e)>-1||/[A-Z]/u.test(e))return!0;return!1}let nn=(0,I.createContext)({}),nr=(0,I.createContext)({strict:!1}),ni=(0,I.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),ns=(0,I.createContext)({});function na(e){return Array.isArray(e)?e.join(" "):e}let no=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function nl(e,t,n){for(let r in t)eS(t[r])||tH(r,n)||(e[r]=t[r])}let nu=()=>({...no(),attrs:{}}),nh=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nc(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||nh.has(e)}let nd=e=>!nc(e);try{o=(()=>{let e=Error("Cannot find module '@emotion/is-prop-valid'");throw e.code="MODULE_NOT_FOUND",e})().default,"function"==typeof o&&(nd=e=>e.startsWith("on")?!nc(e):o(e))}catch{}function nf(e){return eS(e)?e.get():e}let np=(0,I.createContext)(null);function nm(e){let t=(0,I.useRef)(null);return null===t.current&&(t.current=e()),t.current}let ng=e=>(t,n)=>{let r=(0,I.useContext)(ns),i=(0,I.useContext)(np),s=()=>(function({scrapeMotionValuesFromProps:e,createRenderState:t},n,r,i){return{latestValues:function(e,t,n,r){let i={},s=r(e,{});for(let e in s)i[e]=nf(s[e]);let{initial:a,animate:o}=e,l=tS(e),u=tT(e);t&&u&&!l&&!1!==e.inherit&&(void 0===a&&(a=t.initial),void 0===o&&(o=t.animate));let h=!!n&&!1===n.initial,c=(h=h||!1===a)?o:a;if(c&&"boolean"!=typeof c&&!tw(c)){let t=Array.isArray(c)?c:[c];for(let n=0;n<t.length;n++){let r=t_(e,t[n]);if(r){let{transitionEnd:e,transition:t,...n}=r;for(let e in n){let t=n[e];if(Array.isArray(t)){let e=h?t.length-1:0;t=t[e]}null!==t&&(i[e]=t)}for(let t in e)i[t]=e[t]}}}return i}(n,r,i,e),renderState:t()}})(e,t,r,i);return n?s():nm(s)},ny=ng({scrapeMotionValuesFromProps:tW,createRenderState:no}),nv=ng({scrapeMotionValuesFromProps:tQ,createRenderState:nu}),nw="u">typeof window,nb={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},nx=!1;function nE(){return!function(){if(nx)return;let e={};for(let t in nb)e[t]={isEnabled:e=>nb[t].some(t=>!!e[t])};tA=e,nx=!0}(),tA}let nS=Symbol.for("motionComponentSymbol"),nT="data-"+tP("framerAppearId"),nI=(0,I.createContext)({});function n_(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}let nC=nw?I.useLayoutEffect:I.useEffect;function nA(e,{forwardMotionProps:t=!1,type:n}={},r,i){r&&function(e){let t=nE();for(let n in e)t[n]={...t[n],...e[n]};tA=t}(r);let s=n?"svg"===n:nt(e),a=s?nv:ny;function o(n,r){var o;let l,u,h,c={...(0,I.useContext)(ni),...n,layoutId:function({layoutId:e}){let t=(0,I.useContext)(nn).id;return t&&void 0!==e?t+"-"+e:e}(n)},{isStatic:d}=c,f=function(e){let{initial:t,animate:n}=function(e,t){if(tS(e)){let{initial:t,animate:n}=e;return{initial:!1===t||tb(t)?t:void 0,animate:tb(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,I.useContext)(ns));return(0,I.useMemo)(()=>({initial:t,animate:n}),[na(t),na(n)])}(n),p=a(n,d);if(!d&&nw){(0,I.useContext)(nr).strict;let t=function(e){let{drag:t,layout:n}=nE();if(!t&&!n)return{};let r={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(c);l=t.MeasureLayout,f.visualElement=function(e,t,n,r,i,s){let{visualElement:a}=(0,I.useContext)(ns),o=(0,I.useContext)(nr),l=(0,I.useContext)(np),u=(0,I.useContext)(ni).reducedMotion,h=(0,I.useRef)(null),c=(0,I.useRef)(!1);r=r||o.renderer,!h.current&&r&&(h.current=r(e,{visualState:t,parent:a,props:n,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:u,isSVG:s}),c.current&&h.current&&(h.current.manuallyAnimateOnMount=!0));let d=h.current,f=(0,I.useContext)(nI);d&&!d.projection&&i&&("html"===d.type||"svg"===d.type)&&function(e,t,n,r){let{layoutId:i,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:u,layoutCrossfade:h}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:function e(t){if(t)return!1!==t.options.allowProjection?t.projection:e(t.parent)}(e.parent)),e.projection.setOptions({layoutId:i,layout:s,alwaysMeasureLayout:!!a||o&&n_(o),visualElement:e,animationType:"string"==typeof s?s:"both",initialPromotionConfig:r,crossfade:h,layoutScroll:l,layoutRoot:u})}(h.current,n,i,f);let p=(0,I.useRef)(!1);(0,I.useInsertionEffect)(()=>{d&&p.current&&d.update(n,l)});let m=n[nT],g=(0,I.useRef)(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return nC(()=>{c.current=!0,d&&(p.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),g.current&&d.animationState&&d.animationState.animateChanges())}),(0,I.useEffect)(()=>{d&&(!g.current&&d.animationState&&d.animationState.animateChanges(),g.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),g.current=!1),d.enteringChildren=void 0)}),d}(e,p,c,i,t.ProjectionNode,s)}return(0,T.jsxs)(ns.Provider,{value:f,children:[l&&f.visualElement?(0,T.jsx)(l,{visualElement:f.visualElement,...c}):null,function(e,t,n,{latestValues:r},i,s=!1,a){let o=(a??nt(e)?function(e,t,n,r){let i=(0,I.useMemo)(()=>{let n=nu();return tB(n,t,tU(r),e.transformTemplate,e.style),{...n.attrs,style:{...n.style}}},[t]);if(e.style){let t={};nl(t,e.style,e),i.style={...t,...i.style}}return i}:function(e,t){let n,r,i={},s=(n=e.style||{},nl(r={},n,e),Object.assign(r,function({transformTemplate:e},t){return(0,I.useMemo)(()=>{let n=no();return tO(n,t,e),Object.assign({},n.vars,n.style)},[t])}(e,t)),r);return e.drag&&!1!==e.dragListener&&(i.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=!0===e.drag?"none":`pan-${"x"===e.drag?"y":"x"}`),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=s,i})(t,r,i,e),l=function(e,t,n){let r={};for(let i in e)("values"!==i||"object"!=typeof e.values)&&(nd(i)||!0===n&&nc(i)||!t&&!nc(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}(t,"string"==typeof e,s),u=e!==I.Fragment?{...l,...o,ref:n}:{},{children:h}=t,c=(0,I.useMemo)(()=>eS(h)?h.get():h,[h]);return(0,I.createElement)(e,{...u,children:c})}(e,n,(o=f.visualElement,u=(0,I.useRef)(r),(0,I.useInsertionEffect)(()=>{u.current=r}),h=(0,I.useRef)(null),(0,I.useCallback)(e=>{e&&p.onMount?.(e),o&&(e?o.mount(e):o.unmount());let t=u.current;if("function"==typeof t)if(e){let n=t(e);"function"==typeof n&&(h.current=n)}else h.current?(h.current(),h.current=null):t(e);else t&&(t.current=e)},[o])),p,d,t,s)]})}o.displayName=`motion.${"string"==typeof e?e:`create(${e.displayName??e.name??""})`}`;let l=(0,I.forwardRef)(o);return l[nS]=e,l}class nD{constructor(e){this.isMounted=!1,this.node=e}update(){}}function nk(e,t,n){let r=e.getProps();return t_(r,t,void 0!==n?n:r.custom,e)}function nP(e,t){return e?.[t]??e?.default??e}let nM=e=>Array.isArray(e);function nN(e,t){let n=e.getValue("willChange");if(eS(n)&&n.add)return n.add(t);if(!n&&eZ.WillChange){let n=new eZ.WillChange("auto");e.addValue("willChange",n),n.add(t)}}let nR=e=>1e3*e,nO=(e,t)=>n=>t(e(n)),nL=(...e)=>e.reduce(nO),nV={layout:0,mainThread:0,waapi:0};function nF(e,t,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function nB(e,t){return n=>n>0?t:e}let nj=(e,t,n)=>{let r=e*e,i=n*(t*t-r)+r;return i<0?0:Math.sqrt(i)},nU=[K,G,ee];function nq(e){let t=nU.find(t=>t.test(e));if(eD(!!t,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!t)return!1;let n=t.parse(e);return t===ee&&(n=function({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,n/=100;let i=0,s=0,a=0;if(t/=100){let r=n<.5?n*(1+t):n+t-n*t,o=2*n-r;i=nF(o,r,e+1/3),s=nF(o,r,e),a=nF(o,r,e-1/3)}else i=s=a=n;return{red:Math.round(255*i),green:Math.round(255*s),blue:Math.round(255*a),alpha:r}}(n)),n}let nz=(e,t)=>{let n=nq(e),r=nq(t);if(!n||!r)return nB(e,t);let i={...n};return e=>(i.red=nj(n.red,r.red,e),i.green=nj(n.green,r.green,e),i.blue=nj(n.blue,r.blue,e),i.alpha=tG(n.alpha,r.alpha,e),G.transform(i))},n$=new Set(["none","hidden"]);function nG(e,t){return n=>tG(e,t,n)}function nK(e){return"number"==typeof e?nG:"string"==typeof e?eR(e)?nB:et.test(e)?nz:nQ:Array.isArray(e)?nH:"object"==typeof e?et.test(e)?nz:nW:nB}function nH(e,t){let n=[...e],r=n.length,i=e.map((e,n)=>nK(e)(e,t[n]));return e=>{for(let t=0;t<r;t++)n[t]=i[t](e);return n}}function nW(e,t){let n={...e,...t},r={};for(let i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=nK(e[i])(e[i],t[i]));return e=>{for(let t in r)n[t]=r[t](e);return n}}let nQ=(e,t)=>{let n=eh.createTransformer(t),r=ea(e),i=ea(t);if(!(r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length))return eD(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),nB(e,t);if(n$.has(e)&&!i.values.length||n$.has(t)&&!r.values.length)return n$.has(e)?n=>n<=0?e:t:n=>n>=1?t:e;return nL(nH(function(e,t){let n=[],r={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){let s=t.types[i],a=e.indexes[s][r[s]],o=e.values[a]??0;n[i]=o,r[s]++}return n}(r,i),i.values),n)};function nY(e,t,n){return"number"==typeof e&&"number"==typeof t&&"number"==typeof n?tG(e,t,n):nK(e)(e,t)}let nX=e=>{let t=({timestamp:t})=>e(t);return{start:(e=!0)=>e2.update(t,e),stop:()=>e3(t),now:()=>e5.isProcessing?e5.timestamp:tc.now()}},nJ=(e,t,n=10)=>{let r="",i=Math.max(Math.round(t/n),2);for(let t=0;t<i;t++)r+=Math.round(1e4*e(t/(i-1)))/1e4+", ";return`linear(${r.substring(0,r.length-2)})`};function nZ(e){let t=0,n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}function n0(e,t,n){var r,i;let s=Math.max(t-5,0);return r=n-e(s),(i=t-s)?1e3/i*r:0}let n1=.01,n2=2,n3=.005,n5=.5;function n6(e,t){return e*Math.sqrt(1-t*t)}let n4=["duration","bounce"],n8=["stiffness","damping","mass"];function n9(e,t){return t.some(t=>void 0!==e[t])}function n7(e=.3,t=.3){let n,r="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e,{restSpeed:i,restDelta:s}=r,a=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],l={done:!1,value:a},{stiffness:u,damping:h,mass:c,duration:d,velocity:f,isResolvedFromDuration:p}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!n9(e,n8)&&n9(e,n4))if(e.visualDuration){let n=2*Math.PI/(1.2*e.visualDuration),r=n*n,i=2*O(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:1,stiffness:r,damping:i}}else{let n=function({duration:e=800,bounce:t=.3,velocity:n=0,mass:r=1}){let i,s;eD(e<=nR(10),"Spring duration must be 10 seconds or less","spring-duration-limit");let a=1-t;a=O(.05,1,a),e=O(.01,10,e/1e3),a<1?(i=t=>{let r=t*a,i=r*e;return .001-(r-n)/n6(t,a)*Math.exp(-i)},s=t=>{let r=t*a*e,s=Math.pow(a,2)*Math.pow(t,2)*e,o=Math.exp(-r),l=n6(Math.pow(t,2),a);return(r*n+n-s)*o*(-i(t)+.001>0?-1:1)/l}):(i=t=>-.001+Math.exp(-t*e)*((t-n)*e+1),s=t=>e*e*(n-t)*Math.exp(-t*e));let o=function(e,t,n){let r=n;for(let n=1;n<12;n++)r-=e(r)/t(r);return r}(i,s,5/e);if(e=nR(e),isNaN(o))return{stiffness:100,damping:10,duration:e};{let t=Math.pow(o,2)*r;return{stiffness:t,damping:2*a*Math.sqrt(r*t),duration:e}}}(e);(t={...t,...n,mass:1}).isResolvedFromDuration=!0}return t}({...r,velocity:-((r.velocity||0)/1e3)}),m=f||0,g=h/(2*Math.sqrt(u*c)),y=o-a,v=Math.sqrt(u/c)/1e3,w=5>Math.abs(y);if(i||(i=w?n1:n2),s||(s=w?n3:n5),g<1){let e=n6(v,g);n=t=>o-Math.exp(-g*v*t)*((m+g*v*y)/e*Math.sin(e*t)+y*Math.cos(e*t))}else if(1===g)n=e=>o-Math.exp(-v*e)*(y+(m+v*y)*e);else{let e=v*Math.sqrt(g*g-1);n=t=>{let n=Math.exp(-g*v*t),r=Math.min(e*t,300);return o-n*((m+g*v*y)*Math.sinh(r)+e*y*Math.cosh(r))/e}}let b={calculatedDuration:p&&d||null,next:e=>{let t=n(e);if(p)l.done=e>=d;else{let r=0===e?m:0;g<1&&(r=0===e?nR(m):n0(n,e,t));let a=Math.abs(o-t)<=s;l.done=Math.abs(r)<=i&&a}return l.value=l.done?o:t,l},toString:()=>{let e=Math.min(nZ(b),2e4),t=nJ(t=>b.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return b}function re({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:u=.5,restSpeed:h}){let c,d,f=e[0],p={done:!1,value:f},m=n*t,g=f+m,y=void 0===a?g:a(g);y!==g&&(m=y-f);let v=e=>-m*Math.exp(-e/r),w=e=>y+v(e),b=e=>{let t=v(e),n=w(e);p.done=Math.abs(t)<=u,p.value=p.done?y:n},x=e=>{let t;if(t=p.value,void 0!==o&&t<o||void 0!==l&&t>l){var n;c=e,d=n7({keyframes:[p.value,(n=p.value,void 0===o?l:void 0===l||Math.abs(o-n)<Math.abs(l-n)?o:l)],velocity:n0(w,e,p.value),damping:i,stiffness:s,restDelta:u,restSpeed:h})}};return x(0),{calculatedDuration:null,next:e=>{let t=!1;return(d||void 0!==c||(t=!0,b(e),x(e)),void 0!==c&&e>=c)?d.next(e-c):(t||b(e),p)}}}n7.applyToOptions=e=>{let t=function(e,t=100,n){let r=n({...e,keyframes:[0,t]}),i=Math.min(nZ(r),2e4);return{type:"keyframes",ease:e=>r.next(i*e).value/t,duration:i/1e3}}(e,100,n7);return e.ease=t.ease,e.duration=nR(t.duration),e.type="keyframes",e};let rt=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function rn(e,t,n,r){return e===t&&n===r?eJ:i=>0===i||1===i?i:rt(function(e,t,n,r,i){let s,a,o=0;do(s=rt(a=t+(n-t)/2,r,i)-e)>0?n=a:t=a;while(Math.abs(s)>1e-7&&++o<12)return a}(i,0,1,e,n),t,r)}let rr=rn(.42,0,1,1),ri=rn(0,0,.58,1),rs=rn(.42,0,.58,1),ra=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ro=e=>t=>1-e(1-t),rl=rn(.33,1.53,.69,.99),ru=ro(rl),rh=ra(ru),rc=e=>(e*=2)<1?.5*ru(e):.5*(2-Math.pow(2,-10*(e-1))),rd=e=>1-Math.sin(Math.acos(e)),rf=ro(rd),rp=ra(rd),rm=e=>Array.isArray(e)&&"number"==typeof e[0],rg={linear:eJ,easeIn:rr,easeInOut:rs,easeOut:ri,circIn:rd,circInOut:rp,circOut:rf,backIn:ru,backInOut:rh,backOut:rl,anticipate:rc},ry=e=>{if(rm(e)){ek(4===e.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");let[t,n,r,i]=e;return rn(t,n,r,i)}return"string"==typeof e?(ek(void 0!==rg[e],`Invalid easing type '${e}'`,"invalid-easing-type"),rg[e]):e},rv=(e,t,n)=>{let r=t-e;return 0===r?1:(n-e)/r};function rw({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){var i;let s,a=Array.isArray(r)&&"number"!=typeof r[0]?r.map(ry):ry(r),o={done:!1,value:t[0]},l=function(e,t,{clamp:n=!0,ease:r,mixer:i}={}){let s=e.length;if(ek(s===t.length,"Both input and output ranges must be the same length","range-length"),1===s)return()=>t[0];if(2===s&&t[0]===t[1])return()=>t[1];let a=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());let o=function(e,t,n){let r=[],i=n||eZ.mix||nY,s=e.length-1;for(let n=0;n<s;n++){let s=i(e[n],e[n+1]);t&&(s=nL(Array.isArray(t)?t[n]||eJ:t,s)),r.push(s)}return r}(t,r,i),l=o.length,u=n=>{if(a&&n<e[0])return t[0];let r=0;if(l>1)for(;r<e.length-2&&!(n<e[r+1]);r++);let i=rv(e[r],e[r+1],n);return o[r](i)};return n?t=>u(O(e[0],e[s-1],t)):u}((i=n&&n.length===t.length?n:(!function(e,t){let n=e[e.length-1];for(let r=1;r<=t;r++){let i=rv(0,t,r);e.push(tG(n,1,i))}}(s=[0],t.length-1),s),i.map(t=>t*e)),t,{ease:Array.isArray(a)?a:t.map(()=>a||rs).splice(0,t.length-1)});return{calculatedDuration:e,next:t=>(o.value=l(t),o.done=t>=e,o)}}let rb=e=>null!==e;function rx(e,{repeat:t,repeatType:n="loop"},r,i=1){let s=e.filter(rb),a=i<0||t&&"loop"!==n&&t%2==1?0:s.length-1;return a&&void 0!==r?r:s[a]}let rE={decay:re,inertia:re,tween:rw,keyframes:rw,spring:n7};function rS(e){"string"==typeof e.type&&(e.type=rE[e.type])}class rT{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}let rI=e=>e/100;class r_ extends rT{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{let{motionValue:e}=this.options;e&&e.updatedAt!==tc.now()&&this.tick(tc.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},nV.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){let{options:e}=this;rS(e);let{type:t=rw,repeat:n=0,repeatDelay:r=0,repeatType:i,velocity:s=0}=e,{keyframes:a}=e,o=t||rw;o!==rw&&"number"!=typeof a[0]&&(this.mixKeyframes=nL(rI,nY(a[0],a[1])),a=[0,100]);let l=o({...e,keyframes:a});"mirror"===i&&(this.mirroredGenerator=o({...e,keyframes:[...a].reverse(),velocity:-s})),null===l.calculatedDuration&&(l.calculatedDuration=nZ(l));let{calculatedDuration:u}=l;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=l}updateTime(e){let t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){let{generator:n,totalDuration:r,mixKeyframes:i,mirroredGenerator:s,resolvedDuration:a,calculatedDuration:o}=this;if(null===this.startTime)return n.next(0);let{delay:l=0,keyframes:u,repeat:h,repeatType:c,repeatDelay:d,type:f,onUpdate:p,finalKeyframe:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);let g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=r);let v=this.currentTime,w=n;if(h){let e=Math.min(this.currentTime,r)/a,t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,(t=Math.min(t,h+1))%2&&("reverse"===c?(n=1-n,d&&(n-=d/a)):"mirror"===c&&(w=s)),v=O(0,1,n)*a}let b=y?{done:!1,value:u[0]}:w.next(v);i&&(b.value=i(b.value));let{done:x}=b;y||null===o||(x=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);let E=null===this.holdTime&&("finished"===this.state||"running"===this.state&&x);return E&&f!==re&&(b.value=rx(u,this.options,m,this.speed)),p&&p(b.value),E&&this.finish(),b}then(e,t){return this.finished.then(e,t)}get duration(){return this.calculatedDuration/1e3}get iterationDuration(){let{delay:e=0}=this.options||{};return this.duration+e/1e3}get time(){return this.currentTime/1e3}set time(e){e=nR(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(tc.now());let t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=this.currentTime/1e3)}play(){if(this.isStopped)return;let{driver:e=nX,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();let n=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=n):null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(tc.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,nV.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function rC(e){let t;return()=>(void 0===t&&(t=e()),t)}let rA=rC(()=>void 0!==window.ScrollTimeline),rD={},rk=(i=rC(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),()=>rD.linearEasing??i()),rP=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,rM={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:rP([0,.65,.55,1]),circOut:rP([.55,0,1,.45]),backIn:rP([.31,.01,.66,-.59]),backOut:rP([.33,1.53,.69,.99])};function rN(e){return"function"==typeof e&&"applyToOptions"in e}class rR extends rT{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:i,allowFlatten:s=!1,finalKeyframe:a,onComplete:o}=e;this.isPseudoElement=!!i,this.allowFlatten=s,this.options=e,ek("string"!=typeof e.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");const l=function({type:e,...t}){return rN(e)&&rk()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=function(e,t,n,{delay:r=0,duration:i=300,repeat:s=0,repeatType:a="loop",ease:o="easeOut",times:l}={},u){let h={[t]:n};l&&(h.offset=l);let c=function e(t,n){if(t)return"function"==typeof t?rk()?nJ(t,n):"ease-out":rm(t)?rP(t):Array.isArray(t)?t.map(t=>e(t,n)||rM.easeOut):rM[t]}(o,i);Array.isArray(c)&&(h.easing=c);let d={delay:r,duration:i,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:s+1,direction:"reverse"===a?"alternate":"normal"};u&&(d.pseudoElement=u);let f=e.animate(h,d);return f}(t,n,r,l,i),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){let e=rx(r,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(e):n.startsWith("--")?t.style.setProperty(n,e):t.style[n]=e,this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;let{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){return Number(this.animation.effect?.getComputedTiming?.().duration||0)/1e3}get iterationDuration(){let{delay:e=0}=this.options||{};return this.duration+e/1e3}get time(){return(Number(this.animation.currentTime)||0)/1e3}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=nR(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return(this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&rA())?(this.animation.timeline=e,eJ):t(this)}}let rO={anticipate:rc,backInOut:rh,circInOut:rp};class rL extends rR{constructor(e){!function(e){"string"==typeof e.ease&&e.ease in rO&&(e.ease=rO[e.ease])}(e),rS(e),super(e),void 0!==e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){let{motionValue:t,onUpdate:n,onComplete:r,element:i,...s}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);let a=new r_({...s,autoplay:!1}),o=Math.max(10,tc.now()-this.startTime),l=O(0,10,o-10);t.setWithVelocity(a.sample(Math.max(0,o-l)).value,a.sample(o).value,l),a.stop()}}let rV=(e,t)=>"zIndex"!==t&&!!("number"==typeof e||Array.isArray(e)||"string"==typeof e&&(eh.test(e)||"0"===e)&&!e.startsWith("url("));function rF(e){e.duration=0,e.type="keyframes"}let rB=new Set(["opacity","clipPath","filter","transform"]),rj=rC(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class rU extends rT{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:s="loop",keyframes:a,name:o,motionValue:l,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=tc.now();const c={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:i,repeatType:s,name:o,motionValue:l,element:u,...h},d=u?.KeyframeResolver||tn;this.keyframeResolver=new d(a,(e,t,n)=>this.onKeyframesResolved(e,t,c,!n),o,l,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,n,r){this.keyframeResolver=void 0;let{name:i,type:s,velocity:a,delay:o,isHandoff:l,onUpdate:u}=n;this.resolvedAt=tc.now(),!function(e,t,n,r){let i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;let s=e[e.length-1],a=rV(i,t),o=rV(s,t);return eD(a===o,`You are trying to animate ${t} from "${i}" to "${s}". "${a?s:i}" is not an animatable value.`,"value-not-animatable"),!!a&&!!o&&(function(e){let t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||rN(n))&&r)}(e,i,s,a)&&((eZ.instantAnimations||!o)&&u?.(rx(e,n,t)),e[0]=e[e.length-1],rF(n),n.repeat=0);let h={startTime:r?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},c=!l&&function(e){let{motionValue:t,name:n,repeatDelay:r,repeatType:i,damping:s,type:a}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;let{onUpdate:o,transformTemplate:l}=t.owner.getProps();return rj()&&n&&rB.has(n)&&("transform"!==n||!l)&&!o&&!r&&"mirror"!==i&&0!==s&&"inertia"!==a}(h),d=h.motionValue?.owner?.current,f=c?new rL({...h,element:d}):new r_(h);f.finished.then(()=>{this.notifyFinished()}).catch(eJ),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),e7=!0,tt(),te(),e7=!1),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}let rq={type:"spring",stiffness:500,damping:25,restSpeed:10},rz={type:"keyframes",duration:.8},r$={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},rG=e=>null!==e,rK=(e,t,n,r={},i,s)=>a=>{let o=nP(r,e)||{},l=o.delay||r.delay||0,{elapsed:u=0}=r;u-=nR(l);let h={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-u,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:s?void 0:i};!function({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:u,...h}){return!!Object.keys(h).length}(o)&&Object.assign(h,((e,{keyframes:t})=>t.length>2?rz:R.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:rq:r$)(e,h)),h.duration&&(h.duration=nR(h.duration)),h.repeatDelay&&(h.repeatDelay=nR(h.repeatDelay)),void 0!==h.from&&(h.keyframes[0]=h.from);let c=!1;if(!1!==h.type&&(0!==h.duration||h.repeatDelay)||(rF(h),0===h.delay&&(c=!0)),(eZ.instantAnimations||eZ.skipAnimations)&&(c=!0,rF(h),h.delay=0),h.allowFlatten=!o.type&&!o.ease,c&&!s&&void 0!==t.get()){let e=function(e,{repeat:t,repeatType:n="loop"},r){let i=e.filter(rG),s=t&&"loop"!==n&&t%2==1?0:i.length-1;return i[s]}(h.keyframes,o);if(void 0!==e)return void e2.update(()=>{h.onUpdate(e),h.onComplete()})}return o.isSync?new r_(h):new rU(h)};function rH(e,t,{delay:n=0,transitionOverride:r,type:i}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:a,...o}=t,l=s?.reduceMotion;r&&(s=r);let u=[],h=i&&e.animationState&&e.animationState.getState()[i];for(let t in o){let r=e.getValue(t,e.latestValues[t]??null),i=o[t];if(void 0===i||h&&function({protectedKeys:e,needsAnimating:t},n){let r=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,r}(h,t))continue;let a={delay:n,...nP(s||{},t)},c=r.get();if(void 0!==c&&!r.isAnimating&&!Array.isArray(i)&&i===c&&!a.velocity)continue;let d=!1;if(window.MotionHandoffAnimation){let n=e.props[nT];if(n){let e=window.MotionHandoffAnimation(n,t,e2);null!==e&&(a.startTime=e,d=!0)}}nN(e,t);let f=l??e.shouldReduceMotion;r.start(rK(t,r,i,f&&eT.has(t)?{type:!1}:a,e,d));let p=r.animation;p&&u.push(p)}return a&&Promise.all(u).then(()=>{e2.update(()=>{a&&function(e,t){let{transitionEnd:n={},transition:r={},...i}=nk(e,t)||{};for(let t in i={...i,...n}){var s;let n=nM(s=i[t])?s[s.length-1]||0:s;e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,tf(n))}}(e,a)})}),u}function rW(e,t,n,r=0,i=1){let s=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),a=e.size,o=(a-1)*r;return"function"==typeof n?n(s,a):1===i?s*r:o-s*r}function rQ(e,t,n={}){let r=nk(e,t,"exit"===n.type?e.presenceContext?.custom:void 0),{transition:i=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);let s=r?()=>Promise.all(rH(e,r,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(r=0)=>{let{delayChildren:s=0,staggerChildren:a,staggerDirection:o}=i;return function(e,t,n=0,r=0,i=0,s=1,a){let o=[];for(let l of e.variantChildren)l.notify("AnimationStart",t),o.push(rQ(l,t,{...a,delay:n+("function"==typeof r?0:r)+rW(e.variantChildren,l,r,i,s)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(o)}(e,t,r,s,a,o,n)}:()=>Promise.resolve(),{when:o}=i;if(!o)return Promise.all([s(),a(n.delay)]);{let[e,t]="beforeChildren"===o?[s,a]:[a,s];return e().then(()=>t())}}let rY=tE.length;function rX(e,t){if(!Array.isArray(t))return!1;let n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}let rJ=[...tx].reverse(),rZ=tx.length;function r0(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function r1(){return{animate:r0(!0),whileInView:r0(),whileHover:r0(),whileTap:r0(),whileDrag:r0(),whileFocus:r0(),exit:r0()}}let r2=0;function r3(e){return[e("x"),e("y")]}let r5=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function r6(e){return r5.has(e.tagName)||!0===e.isContentEditable}function r4(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}let r8={x:!1,y:!1};function r9(e){return e.max-e.min}function r7(e,t,n,r=.5){e.origin=r,e.originPoint=tG(t.min,t.max,e.origin),e.scale=r9(n)/r9(t),e.translate=tG(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function ie(e,t,n,r){r7(e.x,t.x,n.x,r?r.originX:void 0),r7(e.y,t.y,n.y,r?r.originY:void 0)}function it(e,t,n){e.min=n.min+t.min,e.max=e.min+r9(t)}function ir(e,t,n){e.min=t.min-n.min,e.max=e.min+r9(t)}function ii(e,t,n){ir(e.x,t.x,n.x),ir(e.y,t.y,n.y)}let is=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function ia(e){return{point:{x:e.pageX,y:e.pageY}}}function io(e,t,n,r){return r4(e,t,e=>is(e)&&n(e,ia(e)),r)}let il=({current:e})=>e?e.ownerDocument.defaultView:null,iu=(e,t)=>Math.abs(e-t),ih=new Set(["auto","scroll"]);class ic{constructor(e,t,{transformPagePoint:n,contextWindow:r=window,dragSnapToOrigin:i=!1,distanceThreshold:s=3,element:a}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=e=>{this.handleScroll(e.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{var e,t;if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let n=im(this.lastMoveEventInfo,this.history),r=null!==this.startEvent,i=(e=n.offset,t={x:0,y:0},Math.sqrt(iu(e.x,t.x)**2+iu(e.y,t.y)**2)>=this.distanceThreshold);if(!r&&!i)return;let{point:s}=n,{timestamp:a}=e5;this.history.push({...s,timestamp:a});let{onStart:o,onMove:l}=this.handlers;r||(o&&o(this.lastMoveEvent,n),this.startEvent=this.lastMoveEvent),l&&l(this.lastMoveEvent,n)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=id(t,this.transformPagePoint),e2.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();let{onEnd:n,onSessionEnd:r,resumeAnimation:i}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&i&&i(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let s=im("pointercancel"===e.type?this.lastMoveEventInfo:id(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,s),r&&r(e,s)},!is(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=s,this.contextWindow=r||window;const o=id(ia(e),this.transformPagePoint),{point:l}=o,{timestamp:u}=e5;this.history=[{...l,timestamp:u}];const{onSessionStart:h}=t;h&&h(e,im(o,this.history)),this.removeListeners=nL(io(this.contextWindow,"pointermove",this.handlePointerMove),io(this.contextWindow,"pointerup",this.handlePointerUp),io(this.contextWindow,"pointercancel",this.handlePointerUp)),a&&this.startScrollTracking(a)}startScrollTracking(e){let t=e.parentElement;for(;t;){let e=getComputedStyle(t);(ih.has(e.overflowX)||ih.has(e.overflowY))&&this.scrollPositions.set(t,{x:t.scrollLeft,y:t.scrollTop}),t=t.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){let t=this.scrollPositions.get(e);if(!t)return;let n=e===window,r=n?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},i={x:r.x-t.x,y:r.y-t.y};(0!==i.x||0!==i.y)&&(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=i.x,this.lastMoveEventInfo.point.y+=i.y):this.history.length>0&&(this.history[0].x-=i.x,this.history[0].y-=i.y),this.scrollPositions.set(e,r),e2.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),e3(this.updatePoint)}}function id(e,t){return t?{point:t(e.point)}:e}function ip(e,t){return{x:e.x-t.x,y:e.y-t.y}}function im({point:e},t){return{point:e,delta:ip(e,ig(t)),offset:ip(e,t[0]),velocity:function(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null,i=ig(e);for(;n>=0&&(r=e[n],!(i.timestamp-r.timestamp>nR(.1)));)n--;if(!r)return{x:0,y:0};let s=(i.timestamp-r.timestamp)/1e3;if(0===s)return{x:0,y:0};let a={x:(i.x-r.x)/s,y:(i.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}(t,.1)}}function ig(e){return e[e.length-1]}function iy(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function iv(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}function iw(e,t,n){return{min:ib(e,t),max:ib(e,n)}}function ib(e,t){return"number"==typeof e?e:e[t]||0}let ix=new WeakMap;class iE{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=eE(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){let{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;let i=e=>{t?(this.stopAnimation(),this.snapToCursor(ia(e).point)):this.pauseAnimation()},s=(e,t)=>{this.stopAnimation();let{drag:n,dragPropagation:r,onDragStart:i}=this.getProps();if(n&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock=function(e){if("x"===e||"y"===e)if(r8[e])return null;else return r8[e]=!0,()=>{r8[e]=!1};return r8.x||r8.y?null:(r8.x=r8.y=!0,()=>{r8.x=r8.y=!1})}(n),!this.openDragLock))return;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),r3(e=>{let t=this.getAxisMotionValue(e).get()||0;if(Q.test(t)){let{projection:n}=this.visualElement;if(n&&n.layout){let r=n.layout.layoutBox[e];r&&(t=r9(r)*(parseFloat(t)/100))}}this.originPoint[e]=t}),i&&e2.postRender(()=>i(e,t)),nN(this.visualElement,"transform");let{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},a=(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;let{dragPropagation:n,dragDirectionLock:r,onDirectionLock:i,onDrag:s}=this.getProps();if(!n&&!this.openDragLock)return;let{offset:a}=t;if(r&&null===this.currentDirection){this.currentDirection=function(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}(a),null!==this.currentDirection&&i&&i(this.currentDirection);return}this.updateAxis("x",t.point,a),this.updateAxis("y",t.point,a),this.visualElement.render(),s&&s(e,t)},o=(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>r3(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new ic(e,{onSessionStart:i,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:n,contextWindow:il(this.visualElement),element:this.visualElement.current})}stop(e,t){let n=e||this.latestPointerEvent,r=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!r||!n)return;let{velocity:s}=r;this.startAnimation(s);let{onDragEnd:a}=this.getProps();a&&e2.postRender(()=>a(n,r))}cancel(){this.isDragging=!1;let{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();let{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,t,n){let{drag:r}=this.getProps();if(!n||!iS(e,r,this.currentDirection))return;let i=this.getAxisMotionValue(e),s=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(s=function(e,{min:t,max:n},r){return void 0!==t&&e<t?e=r?tG(t,e,r.min):Math.max(e,t):void 0!==n&&e>n&&(e=r?tG(n,e,r.max):Math.min(e,n)),e}(s,this.constraints[e],this.elastic[e])),i.set(s)}resolveConstraints(){let{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&n_(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=function(e,{top:t,left:n,bottom:r,right:i}){return{x:iy(e.x,n,i),y:iy(e.y,t,r)}}(n.layoutBox,e):this.constraints=!1,this.elastic=function(e=.35){return!1===e?e=0:!0===e&&(e=.35),{x:iw(e,"left","right"),y:iw(e,"top","bottom")}}(t),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&r3(e=>{var t,r;let i;!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=(t=n.layoutBox[e],r=this.constraints[e],i={},void 0!==r.min&&(i.min=r.min-t.min),void 0!==r.max&&(i.max=r.max-t.min),i))})}resolveRefConstraints(){var e;let{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!n_(t))return!1;let r=t.current;ek(null!==r,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");let{projection:i}=this.visualElement;if(!i||!i.layout)return!1;let s=function(e,t,n){let r=t9(e,n),{scroll:i}=t;return i&&(t6(r.x,i.offset.x),t6(r.y,i.offset.y)),r}(r,i.root,this.visualElement.getTransformPagePoint()),a=(e=i.layout.layoutBox,{x:iv(e.x,s.x),y:iv(e.y,s.y)});if(n){let e=n(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=tX(e))}return a}startAnimation(e){let{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),o=this.constraints||{};return Promise.all(r3(a=>{if(!iS(a,t,this.currentDirection))return;let l=o&&o[a]||{};s&&(l={min:0,max:0});let u={type:"inertia",velocity:n?e[a]:0,bounceStiffness:r?200:1e6,bounceDamping:r?40:1e7,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(a,u)})).then(a)}startAxisValueAnimation(e,t){let n=this.getAxisMotionValue(e);return nN(this.visualElement,e),n.start(rK(e,n,0,t,this.visualElement,!1))}stopAnimation(){r3(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){r3(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){let t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps();return n[t]||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){r3(t=>{let{drag:n}=this.getProps();if(!iS(t,n,this.currentDirection))return;let{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){let{min:n,max:s}=r.layout.layoutBox[t],a=i.get()||0;i.set(e[t]-tG(n,s,.5)+a)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;let{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!n_(t)||!n||!this.constraints)return;this.stopAnimation();let r={x:0,y:0};r3(e=>{let t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){var n,i;let s,a,o,l=t.get();r[e]=(n={min:l,max:l},i=this.constraints[e],s=.5,a=r9(n),(o=r9(i))>a?s=rv(i.min,i.max-a,n.min):a>o&&(s=rv(n.min,n.max-o,i.min)),O(0,1,s))}});let{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),r3(t=>{if(!iS(t,e,null))return;let n=this.getAxisMotionValue(t),{min:i,max:s}=this.constraints[t];n.set(tG(i,s,r[t]))})}addListeners(){if(!this.visualElement.current)return;ix.set(this.visualElement,this);let e=this.visualElement.current,t=io(e,"pointerdown",t=>{let{drag:n,dragListener:r=!0}=this.getProps(),i=t.target,s=i!==e&&r6(i);n&&r&&!s&&this.start(t)}),n=()=>{let{dragConstraints:e}=this.getProps();n_(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),e2.read(n);let s=r4(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(r3(t=>{let n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{s(),t(),i(),a&&a()}}getProps(){let e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:s=.35,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:s,dragMomentum:a}}}function iS(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}let iT=e=>(t,n)=>{e&&e2.postRender(()=>e(t,n))},iI={hasAnimatedSinceResize:!0,hasEverUpdated:!1};var i_=I;function iC(e=!0){let t=(0,I.useContext)(np);if(null===t)return[!0,null];let{isPresent:n,onExitComplete:r,register:i}=t,s=(0,I.useId)();(0,I.useEffect)(()=>{if(e)return i(s)},[e]);let a=(0,I.useCallback)(()=>e&&r&&r(s),[s,r,e]);return!n&&r?[!1,a]:[!0]}let iA=!1;class iD extends i_.Component{componentDidMount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),iA&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),iI.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){let{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,{projection:s}=n;return s&&(s.isPresent=i,e.layoutDependency!==t&&s.setOptions({...s.options,layoutDependency:t}),iA=!0,r||e.layoutDependency!==t||void 0===t||e.isPresent!==i?s.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?s.promote():s.relegate()||e2.postRender(()=>{let e=s.getStack();e&&e.members.length||this.safeToRemove()}))),null}componentDidUpdate(){let{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),tu.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;iA=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){let{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ik(e){let[t,n]=iC(),r=(0,i_.useContext)(nn);return(0,T.jsx)(iD,{...e,layoutGroup:r,switchLayoutGroup:(0,i_.useContext)(nI),isPresent:t,safeToRemove:n})}function iP(e){return"object"==typeof e&&null!==e}function iM(e){return iP(e)&&"ownerSVGElement"in e}let iN=["TopLeft","TopRight","BottomLeft","BottomRight"],iR=iN.length,iO=e=>"string"==typeof e?parseFloat(e):e,iL=e=>"number"==typeof e||Y.test(e);function iV(e,t){return void 0!==e[t]?e[t]:e.borderRadius}let iF=ij(0,.5,rf),iB=ij(.5,.95,eJ);function ij(e,t,n){return r=>r<e?0:r>t?1:n(rv(e,t,r))}function iU(e,t){e.min=t.min,e.max=t.max}function iq(e,t){iU(e.x,t.x),iU(e.y,t.y)}function iz(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function i$(e,t,n,r,i){return e-=t,e=r+1/n*(e-r),void 0!==i&&(e=r+1/i*(e-r)),e}function iG(e,t,[n,r,i],s,a){!function(e,t=0,n=1,r=.5,i,s=e,a=e){if(Q.test(t)&&(t=parseFloat(t),t=tG(a.min,a.max,t/100)-a.min),"number"!=typeof t)return;let o=tG(s.min,s.max,r);e===s&&(o-=t),e.min=i$(e.min,t,n,o,i),e.max=i$(e.max,t,n,o,i)}(e,t[n],t[r],t[i],t.scale,s,a)}let iK=["x","scaleX","originX"],iH=["y","scaleY","originY"];function iW(e,t,n,r){iG(e.x,t,iK,n?n.x:void 0,r?r.x:void 0),iG(e.y,t,iH,n?n.y:void 0,r?r.y:void 0)}function iQ(e){return 0===e.translate&&1===e.scale}function iY(e){return iQ(e.x)&&iQ(e.y)}function iX(e,t){return e.min===t.min&&e.max===t.max}function iJ(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function iZ(e,t){return iJ(e.x,t.x)&&iJ(e.y,t.y)}function i0(e){return r9(e.x)/r9(e.y)}function i1(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class i2{constructor(){this.members=[]}add(e){ta(this.members,e),e.scheduleRender()}remove(e){if(to(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){let e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){let t,n=this.members.findIndex(t=>e===t);if(0===n)return!1;for(let e=n;e>=0;e--){let n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,t){let n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender();let r=n.options.layoutDependency,i=e.options.layoutDependency;(void 0===r||void 0===i||r!==i)&&(e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0));let{crossfade:s}=e.options;!1===s&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{let{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}let i3=(e,t)=>e.depth-t.depth;class i5{constructor(){this.children=[],this.isDirty=!1}add(e){ta(this.children,e),this.isDirty=!0}remove(e){to(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(i3),this.isDirty=!1,this.children.forEach(e)}}let i6=["","X","Y","Z"],i4=0;function i8(e,t,n,r){let{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),r&&(r[e]=0))}function i9({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(e={},n=t?.()){this.id=i4++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(st),this.nodes.forEach(sl),this.nodes.forEach(su),this.nodes.forEach(sn)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new i5)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new tl),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){let n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;this.isSVG=iM(t)&&!(iM(t)&&"svg"===t.tagName),this.instance=t;let{layoutId:n,layout:r,visualElement:i}=this.options;if(i&&!i.current&&i.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||n)&&(this.isLayoutDirty=!0),e){let n,r=0,i=()=>this.root.updateBlockedByResize=!1;e2.read(()=>{r=window.innerWidth}),e(t,()=>{let e=window.innerWidth;if(e!==r){let t,s;r=e,this.root.updateBlockedByResize=!0,n&&n(),t=tc.now(),s=({timestamp:e})=>{let n=e-t;n>=250&&(e3(s),i(n-250))},e2.setup(s,!0),n=()=>e3(s),iI.hasAnimatedSinceResize&&(iI.hasAnimatedSinceResize=!1,this.nodes.forEach(so))}})}n&&this.root.registerSharedNode(n,this),!1!==this.options.animate&&i&&(n||r)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:n,layout:r})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}let s=this.options.transition||i.getDefaultTransition()||sm,{onLayoutAnimationStart:a,onLayoutAnimationComplete:o}=i.getProps(),l=!this.targetLayout||!iZ(this.targetLayout,r),u=!t&&n;if(this.options.layoutRoot||this.resumeFrom||u||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);let t={...nP(s,"layout"),onPlay:a,onComplete:o};(i.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,u)}else t||so(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);let e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),e3(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){!this.isUpdateBlocked()&&(this.isUpdating=!0,this.nodes&&this.nodes.forEach(sh),this.animationId++)}getTransformTemplate(){let{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&function e(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;let{visualElement:n}=t.options;if(!n)return;let r=n.props[nT];if(window.MotionHasOptimisedAnimation(r,"transform")){let{layout:e,layoutId:n}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",e2,!(e||n))}let{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&e(i)}(this),this.root.isUpdating||this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){let t=this.path[e];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}let{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;let r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(si);return}if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(ss);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(sa),this.nodes.forEach(i7),this.nodes.forEach(se)):this.nodes.forEach(ss),this.clearAllSnapshots();let e=tc.now();e5.delta=O(0,1e3/60,e-e5.timestamp),e5.timestamp=e,e5.isProcessing=!0,e6.update.process(e5),e6.preRender.process(e5),e6.render.process(e5),e5.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tu.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(sr),this.sharedNodes.forEach(sc)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,e2.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){e2.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||r9(this.snapshot.measuredBox.x)||r9(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++)this.path[e].updateScroll();let e=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=eE(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);let{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){let t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;let e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!iY(this.projectionDelta),n=this.getTransformTemplate(),r=n?n(this.latestValues,""):void 0,s=r!==this.prevTransformTemplateValue;e&&this.instance&&(t||t0(this.latestValues)||s)&&(i(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){var t;let n=this.measurePageBox(),r=this.removeElementScroll(n);return e&&(r=this.removeTransform(r)),sv((t=r).x),sv(t.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:r,latestValues:{},source:this.id}}measurePageBox(){let{visualElement:e}=this.options;if(!e)return eE();let t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(sb))){let{scroll:e}=this.root;e&&(t6(t.x,e.offset.x),t6(t.y,e.offset.y))}return t}removeElementScroll(e){let t=eE();if(iq(t,e),this.scroll?.wasRoot)return t;for(let n=0;n<this.path.length;n++){let r=this.path[n],{scroll:i,options:s}=r;r!==this.root&&i&&s.layoutScroll&&(i.wasRoot&&iq(t,e),t6(t.x,i.offset.x),t6(t.y,i.offset.y))}return t}applyTransform(e,t=!1){let n=eE();iq(n,e);for(let e=0;e<this.path.length;e++){let r=this.path[e];!t&&r.options.layoutScroll&&r.scroll&&r!==r.root&&t8(n,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),t0(r.latestValues)&&t8(n,r.latestValues)}return t0(this.latestValues)&&t8(n,this.latestValues),n}removeTransform(e){let t=eE();iq(t,e);for(let e=0;e<this.path.length;e++){let n=this.path[e];if(!n.instance||!t0(n.latestValues))continue;tZ(n.latestValues)&&n.updateSnapshot();let r=eE();iq(r,n.measurePageBox()),iW(t,n.latestValues,n.snapshot?n.snapshot.layoutBox:void 0,r)}return t0(this.latestValues)&&iW(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==e5.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){let t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);let n=!!this.resumingFrom||this!==t;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;let{layout:r,layoutId:i}=this.options;if(!this.layout||!(r||i))return;this.resolvedRelativeTargetAt=e5.timestamp;let s=this.getClosestProjectingParent();if(s&&this.linkedParentVersion!==s.layoutVersion&&!s.options.layoutRoot&&this.removeRelativeTarget(),this.targetDelta||this.relativeTarget||(s&&s.layout?this.createRelativeTarget(s,this.layout.layoutBox,s.layout.layoutBox):this.removeRelativeTarget()),this.relativeTarget||this.targetDelta){if(this.target||(this.target=eE(),this.targetWithTransforms=eE()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target){var a,o,l;this.forceRelativeParentToResolveTarget(),a=this.target,o=this.relativeTarget,l=this.relativeParent.target,it(a.x,o.x,l.x),it(a.y,o.y,l.y)}else this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):iq(this.target,this.layout.layoutBox),t5(this.target,this.targetDelta)):iq(this.target,this.layout.layoutBox);this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,s&&!!s.resumingFrom==!!this.resumingFrom&&!s.options.layoutScroll&&s.target&&1!==this.animationProgress?this.createRelativeTarget(s,this.target,s.target):this.relativeParent=this.relativeTarget=void 0)}}getClosestProjectingParent(){if(!(!this.parent||tZ(this.parent.latestValues)||t1(this.parent.latestValues)))if(this.parent.isProjecting())return this.parent;else return this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(e,t,n){this.relativeParent=e,this.linkedParentVersion=e.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=eE(),this.relativeTargetOrigin=eE(),ii(this.relativeTargetOrigin,t,n),iq(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){let e=this.getLead(),t=!!this.resumingFrom||this!==e,n=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(n=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===e5.timestamp&&(n=!1),n)return;let{layout:r,layoutId:i}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(r||i))return;iq(this.layoutCorrected,this.layout.layoutBox);let s=this.treeScale.x,a=this.treeScale.y;!function(e,t,n,r=!1){let i,s,a=n.length;if(a){t.x=t.y=1;for(let o=0;o<a;o++){s=(i=n[o]).projectionDelta;let{visualElement:a}=i.options;(!a||!a.props.style||"contents"!==a.props.style.display)&&(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&t8(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,t5(e,s)),r&&t0(i.latestValues)&&t8(e,i.latestValues))}t.x<1.0000000000001&&t.x>.999999999999&&(t.x=1),t.y<1.0000000000001&&t.y>.999999999999&&(t.y=1)}}(this.layoutCorrected,this.treeScale,this.path,t),e.layout&&!e.target&&(1!==this.treeScale.x||1!==this.treeScale.y)&&(e.target=e.layout.layoutBox,e.targetWithTransforms=eE());let{target:o}=e;if(!o){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}this.projectionDelta&&this.prevProjectionDelta?(iz(this.prevProjectionDelta.x,this.projectionDelta.x),iz(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ie(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===s&&this.treeScale.y===a&&i1(this.projectionDelta.x,this.prevProjectionDelta.x)&&i1(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){let e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=eb(),this.projectionDelta=eb(),this.projectionDeltaWithTransform=eb()}setAnimationOrigin(e,t=!1){let n,r=this.snapshot,i=r?r.latestValues:{},s={...this.latestValues},a=eb();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;let o=eE(),l=(r?r.source:void 0)!==(this.layout?this.layout.source:void 0),u=this.getStack(),h=!u||u.members.length<=1,c=!!(l&&!h&&!0===this.options.crossfade&&!this.path.some(sp));this.animationProgress=0,this.mixTargetDelta=t=>{let r=t/1e3;if(sd(a.x,e.x,r),sd(a.y,e.y,r),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout){var u,d,f,p,m,g;ii(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,p=this.relativeTargetOrigin,m=o,g=r,sf(f.x,p.x,m.x,g),sf(f.y,p.y,m.y,g),n&&(u=this.relativeTarget,d=n,iX(u.x,d.x)&&iX(u.y,d.y))&&(this.isProjectionDirty=!1),n||(n=eE()),iq(n,this.relativeTarget)}l&&(this.animationValues=s,function(e,t,n,r,i,s){i?(e.opacity=tG(0,n.opacity??1,iF(r)),e.opacityExit=tG(t.opacity??1,0,iB(r))):s&&(e.opacity=tG(t.opacity??1,n.opacity??1,r));for(let i=0;i<iR;i++){let s=`border${iN[i]}Radius`,a=iV(t,s),o=iV(n,s);(void 0!==a||void 0!==o)&&(a||(a=0),o||(o=0),0===a||0===o||iL(a)===iL(o)?(e[s]=Math.max(tG(iO(a),iO(o),r),0),(Q.test(o)||Q.test(a))&&(e[s]+="%")):e[s]=o)}(t.rotate||n.rotate)&&(e.rotate=tG(t.rotate||0,n.rotate||0,r))}(s,i,this.latestValues,r,c,h)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=r},this.mixTargetDelta(1e3*!!this.options.layoutRoot)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(e3(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=e2.update(()=>{var t,n,r;let i;iI.hasAnimatedSinceResize=!0,nV.layout++,this.motionValue||(this.motionValue=tf(0)),this.currentAnimation=(t=this.motionValue,n=[0,1e3],r={...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{nV.layout--},onComplete:()=>{nV.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}},(i=eS(t)?t:tf(t)).start(rK("",i,n,r)),i.animation),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);let e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){let e=this.getLead(),{targetWithTransforms:t,target:n,layout:r,latestValues:i}=e;if(t&&n&&r){if(this!==e&&this.layout&&r&&sw(this.options.animationType,this.layout.layoutBox,r.layoutBox)){n=this.target||eE();let t=r9(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;let r=r9(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+r}iq(t,n),t8(t,i),ie(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new i2),this.sharedNodes.get(e).add(t);let n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){let e=this.getStack();return!e||e.lead===this}getLead(){let{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){let{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){let{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){let r=this.getStack();r&&r.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){let e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){let{visualElement:e}=this.options;if(!e)return;let t=!1,{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;let r={};n.z&&i8("z",e,r,this.animationValues);for(let t=0;t<i6.length;t++)i8(`rotate${i6[t]}`,e,r,this.animationValues),i8(`skew${i6[t]}`,e,r,this.animationValues);for(let t in e.render(),r)e.setStaticValue(t,r[t]),this.animationValues&&(this.animationValues[t]=r[t]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible){e.visibility="hidden";return}let n=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=nf(t?.pointerEvents)||"",e.transform=n?n(this.latestValues,""):"none";return}let r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target){this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=nf(t?.pointerEvents)||""),this.hasProjected&&!t0(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1);return}e.visibility="";let i=r.animationValues||r.latestValues;this.applyTransformsToTarget();let s=function(e,t,n){let r="",i=e.x.translate/t.x,s=e.y.translate/t.y,a=n?.z||0;if((i||s||a)&&(r=`translate3d(${i}px, ${s}px, ${a}px) `),(1!==t.x||1!==t.y)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),n){let{transformPerspective:e,rotate:t,rotateX:i,rotateY:s,skewX:a,skewY:o}=n;e&&(r=`perspective(${e}px) ${r}`),t&&(r+=`rotate(${t}deg) `),i&&(r+=`rotateX(${i}deg) `),s&&(r+=`rotateY(${s}deg) `),a&&(r+=`skewX(${a}deg) `),o&&(r+=`skewY(${o}deg) `)}let o=e.x.scale*t.x,l=e.y.scale*t.y;return(1!==o||1!==l)&&(r+=`scale(${o}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,i);n&&(s=n(i,s)),e.transform=s;let{x:a,y:o}=this.projectionDelta;for(let t in e.transformOrigin=`${100*a.origin}% ${100*o.origin}% 0`,r.animationValues?e.opacity=r===this?i.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:i.opacityExit:e.opacity=r===this?void 0!==i.opacity?i.opacity:"":void 0!==i.opacityExit?i.opacityExit:0,tK){if(void 0===i[t])continue;let{correct:n,applyTo:a,isCSSVariable:o}=tK[t],l="none"===s?i[t]:n(i[t],r);if(a){let t=a.length;for(let n=0;n<t;n++)e[a[n]]=l}else o?this.options.visualElement.renderState.vars[t]=l:e[t]=l}this.options.layoutId&&(e.pointerEvents=r===this?nf(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(si),this.root.sharedNodes.clear()}}}function i7(e){e.updateLayout()}function se(e){let t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){let{layoutBox:n,measuredBox:r}=e.layout,{animationType:i}=e.options,s=t.source!==e.layout.source;"size"===i?r3(e=>{let r=s?t.measuredBox[e]:t.layoutBox[e],i=r9(r);r.min=n[e].min,r.max=r.min+i}):sw(i,t.layoutBox,n)&&r3(r=>{let i=s?t.measuredBox[r]:t.layoutBox[r],a=r9(n[r]);i.max=i.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+a)});let a=eb();ie(a,n,t.layoutBox);let o=eb();s?ie(o,e.applyTransform(r,!0),t.measuredBox):ie(o,n,t.layoutBox);let l=!iY(a),u=!1;if(!e.resumeFrom){let r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){let{snapshot:i,layout:s}=r;if(i&&s){let a=eE();ii(a,t.layoutBox,i.layoutBox);let o=eE();ii(o,n,s.layoutBox),iZ(a,o)||(u=!0),r.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=a,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:u})}else if(e.isLead()){let{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function st(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function sn(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function sr(e){e.clearSnapshot()}function si(e){e.clearMeasurements()}function ss(e){e.isLayoutDirty=!1}function sa(e){let{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function so(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function sl(e){e.resolveTargetDelta()}function su(e){e.calcProjection()}function sh(e){e.resetSkewAndRotation()}function sc(e){e.removeLeadSnapshot()}function sd(e,t,n){e.translate=tG(t.translate,0,n),e.scale=tG(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function sf(e,t,n,r){e.min=tG(t.min,n.min,r),e.max=tG(t.max,n.max,r)}function sp(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}let sm={duration:.45,ease:[.4,0,.1,1]},sg=e=>"u">typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),sy=sg("applewebkit/")&&!sg("chrome/")?Math.round:eJ;function sv(e){e.min=sy(e.min),e.max=sy(e.max)}function sw(e,t,n){return"position"===e||"preserve-aspect"===e&&!(.2>=Math.abs(i0(t)-i0(n)))}function sb(e){return e!==e.root&&e.scroll?.wasRoot}let sx=i9({attachResizeListener:(e,t)=>r4(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),sE={current:void 0},sS=i9({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!sE.current){let e=new sx({});e.mount(window),e.setOptions({layoutScroll:!0}),sE.current=e}return sE.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>"fixed"===window.getComputedStyle(e).position});function sT(e,t){let n=function(e,t,n){if(null==e)return[];if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document,n=(void 0)??t.querySelectorAll(e);return n?Array.from(n):[]}return Array.from(e).filter(e=>null!=e)}(e),r=new AbortController;return[n,{passive:!0,...t,signal:r.signal},()=>r.abort()]}function sI(e){return!("touch"===e.pointerType||r8.x||r8.y)}function s_(e,t,n){let{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===n);let i=r["onHover"+n];i&&e2.postRender(()=>i(t,ia(t)))}function sC(e){return iP(e)&&"offsetHeight"in e}let sA=(e,t)=>!!t&&(e===t||sA(e,t.parentElement)),sD=new WeakSet;function sk(e){return t=>{"Enter"===t.key&&e(t)}}function sP(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function sM(e){return is(e)&&!(r8.x||r8.y)}function sN(e,t,n){let{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===n);let i=r["onTap"+("End"===n?"":n)];i&&e2.postRender(()=>i(t,ia(t)))}let sR=new WeakMap,sO=new WeakMap,sL=e=>{let t=sR.get(e.target);t&&t(e)},sV=e=>{e.forEach(sL)},sF={some:0,all:1},sB=function(e,t){if("u"<typeof Proxy)return nA;let n=new Map,r=(n,r)=>nA(n,r,e,t);return new Proxy((e,t)=>r(e,t),{get:(i,s)=>"create"===s?r:(n.has(s)||n.set(s,nA(s,void 0,e,t)),n.get(s))})}({animation:{Feature:class extends nD{constructor(e){super(e),e.animationState||(e.animationState=function(e){let t=t=>Promise.all(t.map(({animation:t,options:n})=>(function(e,t,n={}){let r;if(e.notify("AnimationStart",t),Array.isArray(t))r=Promise.all(t.map(t=>rQ(e,t,n)));else if("string"==typeof t)r=rQ(e,t,n);else{let i="function"==typeof t?nk(e,t,n.custom):t;r=Promise.all(rH(e,i,n))}return r.then(()=>{e.notify("AnimationComplete",t)})})(e,t,n))),n=r1(),r=!0,i=t=>(n,r)=>{let i=nk(e,r,"exit"===t?e.presenceContext?.custom:void 0);if(i){let{transition:e,transitionEnd:t,...r}=i;n={...n,...r,...t}}return n};function s(s){let{props:a}=e,o=function e(t){if(!t)return;if(!t.isControllingVariants){let n=t.parent&&e(t.parent)||{};return void 0!==t.props.initial&&(n.initial=t.props.initial),n}let n={};for(let e=0;e<rY;e++){let r=tE[e],i=t.props[r];(tb(i)||!1===i)&&(n[r]=i)}return n}(e.parent)||{},l=[],u=new Set,h={},c=1/0;for(let t=0;t<rZ;t++){var d,f;let p=rJ[t],m=n[p],g=void 0!==a[p]?a[p]:o[p],y=tb(g),v=p===s?m.isActive:null;!1===v&&(c=t);let w=g===o[p]&&g!==a[p]&&y;if(w&&r&&e.manuallyAnimateOnMount&&(w=!1),m.protectedKeys={...h},!m.isActive&&null===v||!g&&!m.prevProp||tw(g)||"boolean"==typeof g)continue;let b=(d=m.prevProp,"string"==typeof(f=g)?f!==d:!!Array.isArray(f)&&!rX(f,d)),x=b||p===s&&m.isActive&&!w&&y||t>c&&y,E=!1,S=Array.isArray(g)?g:[g],T=S.reduce(i(p),{});!1===v&&(T={});let{prevResolvedValues:I={}}=m,_={...I,...T},C=t=>{x=!0,u.has(t)&&(E=!0,u.delete(t)),m.needsAnimating[t]=!0;let n=e.getValue(t);n&&(n.liveStyle=!1)};for(let e in _){let t=T[e],n=I[e];if(!h.hasOwnProperty(e))(nM(t)&&nM(n)?rX(t,n):t===n)?void 0!==t&&u.has(e)?C(e):m.protectedKeys[e]=!0:null!=t?C(e):u.add(e)}m.prevProp=g,m.prevResolvedValues=T,m.isActive&&(h={...h,...T}),r&&e.blockInitialAnimation&&(x=!1);let A=w&&b,D=!A||E;x&&D&&l.push(...S.map(t=>{let n={type:p};if("string"==typeof t&&r&&!A&&e.manuallyAnimateOnMount&&e.parent){let{parent:r}=e,i=nk(r,t);if(r.enteringChildren&&i){let{delayChildren:t}=i.transition||{};n.delay=rW(r.enteringChildren,e,t)}}return{animation:t,options:n}}))}if(u.size){let t={};if("boolean"!=typeof a.initial){let n=nk(e,Array.isArray(a.initial)?a.initial[0]:a.initial);n&&n.transition&&(t.transition=n.transition)}u.forEach(n=>{let r=e.getBaseTarget(n),i=e.getValue(n);i&&(i.liveStyle=!0),t[n]=r??null}),l.push({animation:t})}let p=!!l.length;return r&&(!1===a.initial||a.initial===a.animate)&&!e.manuallyAnimateOnMount&&(p=!1),r=!1,p?t(l):Promise.resolve()}return{animateChanges:s,setActive:function(t,r){if(n[t].isActive===r)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,r)),n[t].isActive=r;let i=s(t);for(let e in n)n[e].protectedKeys={};return i},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=r1()}}}(e))}updateAnimationControlsSubscription(){let{animate:e}=this.node.getProps();tw(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){let{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends nD{constructor(){super(...arguments),this.id=r2++}update(){if(!this.node.presenceContext)return;let{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;let r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){let{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}},inView:{Feature:class extends nD{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){var e;let t;this.unmount();let{viewport:n={}}=this.node.getProps(),{root:r,margin:i,amount:s="some",once:a}=n,o={root:r?r.current:void 0,rootMargin:i,threshold:"number"==typeof s?s:sF[s]},l=e=>{let{isIntersecting:t}=e;if(this.isInView===t||(this.isInView=t,a&&!t&&this.hasEnteredView))return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);let{onViewportEnter:n,onViewportLeave:r}=this.node.getProps(),i=t?n:r;i&&i(e)};return e=this.node.current,t=function({root:e,...t}){let n=e||document;sO.has(n)||sO.set(n,{});let r=sO.get(n),i=JSON.stringify(t);return r[i]||(r[i]=new IntersectionObserver(sV,{root:e,...t})),r[i]}(o),sR.set(e,l),t.observe(e),()=>{sR.delete(e),t.unobserve(e)}}mount(){this.startObserver()}update(){if("u"<typeof IntersectionObserver)return;let{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends nD{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){let[r,i,s]=sT(e,n),a=e=>{let r=e.currentTarget;if(!sM(e))return;sD.add(r);let s=t(r,e),a=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),sD.has(r)&&sD.delete(r),sM(e)&&"function"==typeof s&&s(e,{success:t})},o=e=>{a(e,r===window||r===document||n.useGlobalTarget||sA(r,e.target))},l=e=>{a(e,!1)};window.addEventListener("pointerup",o,i),window.addEventListener("pointercancel",l,i)};return r.forEach(e=>{(n.useGlobalTarget?window:e).addEventListener("pointerdown",a,i),sC(e)&&(e.addEventListener("focus",e=>((e,t)=>{let n=e.currentTarget;if(!n)return;let r=sk(()=>{if(sD.has(n))return;sP(n,"down");let e=sk(()=>{sP(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>sP(n,"cancel"),t)});n.addEventListener("keydown",r,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),t)})(e,i)),r6(e)||e.hasAttribute("tabindex")||(e.tabIndex=0))}),s}(e,(e,t)=>(sN(this.node,t,"Start"),(e,{success:t})=>sN(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends nD{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=nL(r4(this.node.current,"focus",()=>this.onFocus()),r4(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends nD{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){let[r,i,s]=sT(e,n),a=e=>{if(!sI(e))return;let{target:n}=e,r=t(n,e);if("function"!=typeof r||!n)return;let s=e=>{sI(e)&&(r(e),n.removeEventListener("pointerleave",s))};n.addEventListener("pointerleave",s,i)};return r.forEach(e=>{e.addEventListener("pointerenter",a,i)}),s}(e,(e,t)=>(s_(this.node,t,"Start"),e=>s_(this.node,e,"End"))))}unmount(){}}},pan:{Feature:class extends nD{constructor(){super(...arguments),this.removePointerDownListener=eJ}onPointerDown(e){this.session=new ic(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:il(this.node)})}createPanHandlers(){let{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:iT(e),onStart:iT(t),onMove:n,onEnd:(e,t)=>{delete this.session,r&&e2.postRender(()=>r(e,t))}}}mount(){this.removePointerDownListener=io(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends nD{constructor(e){super(e),this.removeGroupControls=eJ,this.removeListeners=eJ,this.controls=new iE(e)}mount(){let{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||eJ}update(){let{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}},ProjectionNode:sS,MeasureLayout:ik},layout:{ProjectionNode:sS,MeasureLayout:ik}},(e,t)=>t.isSVG??nt(e)?new tY(t):new t7(t,{allowProjection:e!==I.Fragment}));var sj=I;function sU(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class sq extends sj.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,n=sC(e)&&e.offsetWidth||0,r=sC(e)&&e.offsetHeight||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=n-i.width-i.left,i.bottom=r-i.height-i.top}return null}componentDidUpdate(){}render(){return this.props.children}}function sz({children:e,isPresent:t,anchorX:n,anchorY:r,root:i}){let s=(0,sj.useId)(),a=(0,sj.useRef)(null),o=(0,sj.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:l}=(0,sj.useContext)(ni),u=function(...e){return I.useCallback(function(...e){return t=>{let n=!1,r=e.map(e=>{let r=sU(e,t);return n||"function"!=typeof r||(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){let n=r[t];"function"==typeof n?n():sU(e[t],null)}}}}(...e),e)}(a,e.props?.ref??e?.ref);return(0,sj.useInsertionEffect)(()=>{let{width:e,height:u,top:h,left:c,right:d,bottom:f}=o.current;if(t||!a.current||!e||!u)return;let p="left"===n?`left: ${c}`:`right: ${d}`,m="bottom"===r?`bottom: ${f}`:`top: ${h}`;a.current.dataset.motionPopId=s;let g=document.createElement("style");l&&(g.nonce=l);let y=i??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${u}px !important;
            ${p}px !important;
            ${m}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[t]),(0,T.jsx)(sq,{isPresent:t,childRef:a,sizeRef:o,children:sj.cloneElement(e,{ref:u})})}let s$=({children:e,initial:t,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:s,mode:a,anchorX:o,anchorY:l,root:u})=>{let h=nm(sG),c=(0,I.useId)(),d=!0,f=(0,I.useMemo)(()=>(d=!1,{id:c,initial:t,isPresent:n,custom:i,onExitComplete:e=>{for(let t of(h.set(e,!0),h.values()))if(!t)return;r&&r()},register:e=>(h.set(e,!1),()=>h.delete(e))}),[n,h,r]);return s&&d&&(f={...f}),(0,I.useMemo)(()=>{h.forEach((e,t)=>h.set(t,!1))},[n]),I.useEffect(()=>{n||h.size||!r||r()},[n]),"popLayout"===a&&(e=(0,T.jsx)(sz,{isPresent:n,anchorX:o,anchorY:l,root:u,children:e})),(0,T.jsx)(np.Provider,{value:f,children:e})};function sG(){return new Map}let sK=e=>e.key||"";function sH(e){let t=[];return I.Children.forEach(e,e=>{(0,I.isValidElement)(e)&&t.push(e)}),t}let sW=({children:e,custom:t,initial:n=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:s="sync",propagate:a=!1,anchorX:o="left",anchorY:l="top",root:u})=>{let[h,c]=iC(a),d=(0,I.useMemo)(()=>sH(e),[e]),f=a&&!h?[]:d.map(sK),p=(0,I.useRef)(!0),m=(0,I.useRef)(d),g=nm(()=>new Map),y=(0,I.useRef)(new Set),[v,w]=(0,I.useState)(d),[b,x]=(0,I.useState)(d);nC(()=>{p.current=!1,m.current=d;for(let e=0;e<b.length;e++){let t=sK(b[e]);f.includes(t)?(g.delete(t),y.current.delete(t)):!0!==g.get(t)&&g.set(t,!1)}},[b,f.length,f.join("-")]);let E=[];if(d!==v){let e=[...d];for(let t=0;t<b.length;t++){let n=b[t],r=sK(n);f.includes(r)||(e.splice(t,0,n),E.push(n))}return"wait"===s&&E.length&&(e=E),x(sH(e)),w(d),null}let{forceRender:S}=(0,I.useContext)(nn);return(0,T.jsx)(T.Fragment,{children:b.map(e=>{let v=sK(e),w=(!a||!!h)&&(d===b||f.includes(v));return(0,T.jsx)(s$,{isPresent:w,initial:(!p.current||!!n)&&void 0,custom:t,presenceAffectsLayout:i,mode:s,root:u,onExitComplete:w?void 0:()=>{if(y.current.has(v)||(y.current.add(v),!g.has(v)))return;g.set(v,!0);let e=!0;g.forEach(t=>{t||(e=!1)}),e&&(S?.(),x(m.current),a&&c?.(),r&&r())},anchorX:o,anchorY:l,children:e},v)})})};function sQ({location:e,sheetVisible:t,onClose:n,onSubmit:r}){let[i,s]=(0,I.useState)(""),a=async t=>{if(t.preventDefault(),!i.trim())return;let a=window.Telegram?.WebApp?.initDataUnsafe?.user;r&&await r({description:i.trim(),location:e,userId:a?.id?.toString()??"anonymous",created_at:new Date().toISOString(),expires_at:new Date(Date.now()+36e5).toISOString(),userPhoto:a?.photo_url}),s(""),n()};(0,I.useEffect)(()=>{document.body.style.overflow=t?"hidden":"",document.body.style.touchAction=t?"none":""},[t]);let o=""!==i.trim();return(0,T.jsx)(sW,{children:t&&(0,T.jsx)(sB.div,{className:"fixed inset-0 z-50 bg-black/30",onClick:e=>e.target===e.currentTarget&&n(),initial:{opacity:1},animate:{opacity:1},exit:{opacity:1},transition:{duration:.2},style:{zIndex:999},children:(0,T.jsx)(sB.div,{onClick:e=>e.stopPropagation(),className:"fixed bottom-0 left-0 w-full bg-white rounded-t-[24px] px-6 pt-3 pb-6 max-h-[80vh] overflow-y-auto",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{duration:.2},children:(0,T.jsxs)("form",{onSubmit:a,className:"space-y-2",children:[(0,T.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,T.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Pin"}),(0,T.jsxs)("div",{className:"text-right text-xs text-gray-500",children:[i.length,"/60"]})]}),(0,T.jsx)("textarea",{value:i,onChange:e=>s(e.target.value),placeholder:"Оставь мысль, статус или сообщение",rows:3,maxLength:60,className:"w-full px-4 py-3 border bg-white border-gray-300 rounded-[24px] text-black resize-none caret-black focus:outline-none focus:ring-2 focus:ring-pin-primary"}),(0,T.jsx)("button",{type:"submit",disabled:!o,className:`w-full h-16 mt-[10px] rounded-full transition-colors border ${o?"bg-black text-white border-black":"bg-transparent text-black border-black"}`,children:"Создать"})]})})})})}let sY=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},sX=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},sJ={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(sY(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):sX(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new sZ;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class sZ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let s0=function(e){let t=sY(e);return sJ.encodeByteArray(t,!0)},s1=function(e){return s0(e).replace(/\./g,"")},s2=function(e){try{return sJ.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function s3(){return"u">typeof self?self:"u">typeof window?window:e.g}let s5=()=>{try{return s3().__FIREBASE_DEFAULTS__||(()=>{if(void 0===eA.default||void 0===eA.default.env)return;let e=eA.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&s2(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},s6=()=>s5()?.config;class s4{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function s8(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function s9(e){return(await fetch(e,{credentials:"include"})).ok}let s7={},ae=!1;function at(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function an(){let t=s5()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function ar(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function ai(){return!an()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function as(){return!an()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function aa(){try{return"object"==typeof indexedDB}catch(e){return!1}}class ao extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ao.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,al.prototype.create)}}class al{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(au,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ao(s,l,i)}}let au=/\{\$([^}]+)}/g;function ah(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(ac(n)&&ac(s)){if(!ah(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function ac(e){return null!==e&&"object"==typeof e}function ad(e){return e&&e._delegate?e._delegate:e}class af{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ap="[DEFAULT]";class am{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new s4;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ap})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ap){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ap){return this.instances.has(e)}getOptions(e=ap){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===ap?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ap){return this.component?this.component.multipleInstances?e:ap:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ag{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new am(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ay=[];(l=u||(u={}))[l.DEBUG=0]="DEBUG",l[l.VERBOSE=1]="VERBOSE",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.SILENT=5]="SILENT";let av={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},aw=u.INFO,ab={[u.DEBUG]:"log",[u.VERBOSE]:"log",[u.INFO]:"info",[u.WARN]:"warn",[u.ERROR]:"error"},ax=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ab[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class aE{constructor(e){this.name=e,this._logLevel=aw,this._logHandler=ax,this._userLogHandler=null,ay.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in u))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?av[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,u.DEBUG,...e),this._logHandler(this,u.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,u.VERBOSE,...e),this._logHandler(this,u.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,u.INFO,...e),this._logHandler(this,u.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,u.WARN,...e),this._logHandler(this,u.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,u.ERROR,...e),this._logHandler(this,u.ERROR,...e)}}let aS=new WeakMap,aT=new WeakMap,aI=new WeakMap,a_=new WeakMap,aC=new WeakMap,aA={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return aT.get(e);if("objectStoreNames"===t)return e.objectStoreNames||aI.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return aD(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function aD(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(aD(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&aS.set(t,e)}).catch(()=>{}),aC.set(t,e),t}if(a_.has(e))return a_.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ak(this),t),aD(aS.get(this))}:function(...t){return aD(e.apply(ak(this),t))}:function(t,...n){let r=e.call(ak(this),t,...n);return aI.set(r,t.sort?t.sort():[t]),aD(r)};return e instanceof IDBTransaction&&function(e){if(aT.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});aT.set(e,t)}(e),(n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,aA):e}(e);return t!==e&&(a_.set(e,t),aC.set(t,e)),t}let ak=e=>aC.get(e),aP=["get","getKey","getAll","getAllKeys","count"],aM=["put","add","delete","clear"],aN=new Map;function aR(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(aN.get(t))return aN.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=aM.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||aP.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return aN.set(t,s),s}aA={...a=aA,get:(e,t,n)=>aR(e,t)||a.get(e,t,n),has:(e,t)=>!!aR(e,t)||a.has(e,t)};class aO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let aL="@firebase/app",aV="0.14.7",aF=new aE("@firebase/app"),aB="[DEFAULT]",aj={[aL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},aU=new Map,aq=new Map,az=new Map;function a$(e,t){try{e.container.addComponent(t)}catch(n){aF.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function aG(e,t){e.container.addOrOverwriteComponent(t)}function aK(e){let t=e.name;if(az.has(t))return aF.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(az.set(t,e),aU.values()))a$(n,e);for(let t of aq.values())a$(t,e);return!0}function aH(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function aW(e,t,n=aB){aH(e,t).clearInstance(n)}function aQ(e){return void 0!==e.options}function aY(e){return!aQ(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function aX(e){return null!=e&&void 0!==e.settings}function aJ(){az.clear()}let aZ=new al("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class a0{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new af("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw aZ.create("app-deleted",{appName:this._name})}}function a1(e,t){let n=s2(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class a2 extends a0{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&a1(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&a1(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,a7(aL,aV,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){a9(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw aZ.create("server-app-deleted")}}let a3="12.8.0";function a5(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:aB,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw aZ.create("bad-app-name",{appName:String(i)});if(n||(n=s6()),!n)throw aZ.create("no-options");let s=aU.get(i);if(s)if(ah(n,s.options)&&ah(r,s.config))return s;else throw aZ.create("duplicate-app",{appName:i});let a=new ag(i);for(let e of az.values())a.addComponent(e);let o=new a0(n,r,a);return aU.set(i,o),o}function a6(e,t={}){let n;if(("u">typeof window||ar())&&!ar())throw aZ.create("invalid-server-app-environment");let r=t||{};if(e&&(aQ(e)?n=e.options:aY(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=s6()),!n)throw aZ.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw aZ.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=aq.get(s);if(a)return a.incRefCount(r.releaseOnDeref),a;let o=new ag(s);for(let e of az.values())o.addComponent(e);let l=new a2(n,r,s,o);return aq.set(s,l),l}function a4(e=aB){let t=aU.get(e);if(!t&&e===aB&&s6())return a5();if(!t)throw aZ.create("no-app",{appName:e});return t}function a8(){return Array.from(aU.values())}async function a9(e){let t=!1,n=e.name;aU.has(n)?(t=!0,aU.delete(n)):aq.has(n)&&0>=e.decRefCount()&&(aq.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function a7(e,t,n){let r=aj[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),aF.warn(e.join(" "));return}aK(new af(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function oe(e,t){if(null!==e&&"function"!=typeof e)throw aZ.create("invalid-log-argument");for(let n of ay){let r=null;t&&t.level&&(r=av[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:u[n].toLowerCase(),message:s,args:i,type:t.name})}}}function ot(e){ay.forEach(t=>{t.setLogLevel(e)})}let on="firebase-heartbeat-store",or=null;function oi(){return or||(or=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=aD(a);return r&&a.addEventListener("upgradeneeded",e=>{r(aD(a.result),e.oldVersion,e.newVersion,aD(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(on)}catch(e){console.warn(e)}}}).catch(e=>{throw aZ.create("idb-open",{originalErrorMessage:e.message})})),or}async function os(e){try{let t=(await oi()).transaction(on),n=await t.objectStore(on).get(oo(e));return await t.done,n}catch(e){if(e instanceof ao)aF.warn(e.message);else{let t=aZ.create("idb-get",{originalErrorMessage:e?.message});aF.warn(t.message)}}}async function oa(e,t){try{let n=(await oi()).transaction(on,"readwrite"),r=n.objectStore(on);await r.put(t,oo(e)),await n.done}catch(e){if(e instanceof ao)aF.warn(e.message);else{let t=aZ.create("idb-set",{originalErrorMessage:e?.message});aF.warn(t.message)}}}function oo(e){return`${e.name}!${e.options.appId}`}class ol{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oh(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ou();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){aF.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=ou(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),oc(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),oc(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s1(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return aF.warn(e),""}}}function ou(){return new Date().toISOString().substring(0,10)}class oh{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!aa()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await os(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return oa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return oa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function oc(e){return s1(JSON.stringify({version:2,heartbeats:e})).length}aK(new af("platform-logger",e=>new aO(e),"PRIVATE")),aK(new af("heartbeat",e=>new ol(e),"PRIVATE")),a7(aL,aV,""),a7(aL,aV,"esm2020"),a7("fire-js",""),e.s(["SDK_VERSION",()=>a3,"_DEFAULT_ENTRY_NAME",()=>aB,"_addComponent",()=>a$,"_addOrOverwriteComponent",()=>aG,"_apps",()=>aU,"_clearComponents",()=>aJ,"_components",()=>az,"_getProvider",()=>aH,"_isFirebaseApp",()=>aQ,"_isFirebaseServerApp",()=>aX,"_isFirebaseServerAppSettings",()=>aY,"_registerComponent",()=>aK,"_removeServiceInstance",()=>aW,"_serverApps",()=>aq,"deleteApp",()=>a9,"getApp",()=>a4,"getApps",()=>a8,"initializeApp",()=>a5,"initializeServerApp",()=>a6,"onLog",()=>oe,"registerVersion",()=>a7,"setLogLevel",()=>ot],30033),a7("firebase","12.8.0","app"),e.i(30033);var od=e.i(78113),of="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,op={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^n&(i^s))+r[0]+0xd76aa478|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return g(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var u=o(0),d=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(u,u);if(m(e))return t=b(g(e),t),new w(g(t.g),g(t.h));if(m(t))return t=b(e,g(t)),new w(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=x(n),r=x(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=E(r,1),n=E(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=u;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=l(n)).j(t);m(a)||a.l(e)>0;)n-=r,a=(s=l(n)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function x(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function E(e,t){let n=t>>5;t%=32;let r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=l(Math.pow(e,6));var n=this;let r="";for(;;){let i=b(n,t).g,s=(((n=y(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return u;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=s*o,v(n,2*r+2*t),n[2*r+2*t+1]+=i*o,v(n,2*r+2*t+1),n[2*r+2*t+1]+=s*a,v(n,2*r+2*t+1),n[2*r+2*t+2]+=i*a,v(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},s.B=function(e){return b(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,c=op.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return g(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=l(Math.pow(n,8)),i=u;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),i=i.j(s).add(l(a))):i=(i=i.j(r)).add(l(a))}return i},h=op.Integer=i}).apply(void 0!==of?of:"u">typeof self?self:"u">typeof window?window:{});var om="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,og={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof om&&om];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){return(u=l).apply(null,arguments)}function h(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var b="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function x(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let I,_=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},A=()=>{let e=Promise.resolve(void 0);I=()=>{e.then(D)}};function D(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}S.j(t),S.h<100&&(S.h++,t.next=S.g,S.g=t)}_=!1}function k(){this.u=this.u,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}k.prototype.u=!1,k.prototype.dispose=function(){this.u||(this.u=!0,this.N())},k.prototype[Symbol.dispose]=function(){this.dispose()},k.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function N(e){return/^[\s\xa0]*$/.test(e)}function R(e,t){P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(R,P),R.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&R.Z.h.call(this)},R.prototype.h=function(){R.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var O="closure_listenable_"+(1e6*Math.random()|0),L=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++L,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function j(e){let t={};for(let n in e)t[n]=e[n];return t}let U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<U.length;t++)n=U[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function G(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}z.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=G(e,t,r,i);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new V(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=J(e);if(l||(e[K]=l=new z(e)),(n=l.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return X.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)M||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[O])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=J(t))?($(n,e),0==n.h&&(n.src=null,t[K]=null)):F(e)}}}function Y(e){return e in H?H[e]:H[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new R(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Q(e),e=n.call(r,t)}return e}function J(e){return(e=e[K])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){k.call(this),this.i=new z(this),this.M=this,this.G=null}function en(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var a=t;q(t=new P(s,e),a)}if(a=!0,i)for(r=i.length-1;r>=0;r--)a=er(n=t.g=i[r],s,!0,t)&&a;if(a=er(n=t.g=e,s,!0,t)&&a,a=er(n,s,!1,t)&&a,i)for(r=0;r<i.length;r++)a=er(n=t.g=i[r],s,!1,t)&&a}function er(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==n){let t=a.listener,n=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}c(et,k),et.prototype[O]=!0,et.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=o(i)?!!i.capture:!!i,r=ee(r),t&&t[O])?(t=t.i,(a=String(n).toString())in t.g&&(r=G(n=t.g[a],r,i,s))>-1&&(F(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[a],t.h--))):t&&(t=J(t))&&(n=t.g[n.toString()],t=-1,n&&(t=G(n,r,i,s)),(r=t>-1?n[t]:null)&&Q(r))}(this,e,t,n,r)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)F(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},et.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ei extends k{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){k.call(this),this.h=e,this.g={}}c(es,k);var ea=[];function eo(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){P.call(this,"d")}function em(){P.call(this,"c")}c(ep,P),c(em,P);var eg={},ey=null;function ev(){return ey=ey||new et}function ew(e){P.call(this,eg.Ia,e)}function eb(e){let t=ev();en(t,new ew(t))}function ex(e,t){P.call(this,eg.STAT_EVENT,e),this.stat=t}function eE(e){let t=ev();en(t,new ex(t,e))}function eS(e,t){P.call(this,eg.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eI(){this.g=!0}function e_(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eg.Ia="serverreachability",c(ew,P),eg.STAT_EVENT="statevent",c(ex,P),eg.Ja="timingevent",c(eS,P),eI.prototype.ua=function(){this.g=!1},eI.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eD(){}function ek(e){return encodeURIComponent(String(e))}function eP(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eM}function eM(){this.i=null,this.g="",this.h=!1}c(eD,ec),eD.prototype.g=function(){return new XMLHttpRequest},e=new eD;var eN={},eR={};function eO(e,t,n){e.M=1,e.A=e6(e0(t)),e.u=n,e.R=!0,eL(e,null)}function eL(e,t){e.F=Date.now(),eF(e),e.B=e0(e.A);var n,r,i,s,a,l,h=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),tu(h.i,"t",c),e.C=0,h=e.j.L,e.h=new eM,e.g=tQ(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(u(e.Y,e,e.g),e.P)),t=e.V,h=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ee(r),t&&t[O]?t.K(n,r,o(i)?!!i.capture:!!i,s):W(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ee(r),t&&t[O]?t.J(n,r,o(i)?!!i.capture:!!i,s):W(t,n,r,!1,i,s)}(h,d[e],c||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),n=e.i,r=e.v,i=e.B,s=e.l,a=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var o=t[n].split("=");if(o.length>1){let t=o[0];o=o[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eV(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eF(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(u(e.aa,e),t)}function ej(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eU(e){0==e.j.I||e.K||t$(e.j,e)}function eq(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eW(n.h,e))){if(!e.L&&eW(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tz(n),tN(n);else break e;tj(n),eE(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eT(u(n.Va,n),6e3));1>=eH(n.h)&&n.ta&&(n.ta=void 0)}else tK(n,11)}else if((e.L||n.g==e)&&tz(n),!N(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=n.K))if(n.K=l,o=o[1],2==n.I)if("c"==o[0]){n.M=o[1],n.ba=o[2];let t=o[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=o[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(r.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e5(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tW(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var a=r.O;a&&(e.H=a),e.D&&(ej(e),eF(e)),r.g=e}else tB(r);n.i.length>0&&tO(n)}else"stop"!=o[0]&&"close"!=o[0]||tK(n,7);else 3==n.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tK(n,7):tM(n):"noop"!=o[0]&&n.l&&n.l.qa(o),n.A=0)}}eb(4)}catch(e){}}eP.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tA(e)?t.j():this.Y(e)},eP.prototype.Y=function(e){try{if(e==this.g)e:{let f=tA(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tD(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?eb(3):eb(2)),ej(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eV(e))return e.g.la();let t=tD(e.g);if(""===t)return"";let n="",r=t.length,i=4==tA(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eq(e),eU(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,o=this.l,l=this.S,r.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(u)){var c=u;break t}}c=null}if(e=c)e_(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eE(12),eq(this),eU(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eR:isNaN(n=Number(t.substring(n,r)))?eN:(r+=1)+n>t.length?eR:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eR){4==f&&(this.m=4,eE(14),e=!1),e_(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eN){this.m=4,eE(15),e_(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else e_(this.i,this.l,t,null),ez(this,t);if(eV(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=n.length||this.h.h||(this.m=1,eE(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tU(d),d.P=!0,eE(11))}}else e_(this.i,this.l,n,"[Invalid Chunked Response]"),eq(this),eU(this)}else e_(this.i,this.l,n,null),ez(this,n);4==f&&eq(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eF(this)))}else(function(e){let t={};e=(e.g&&tA(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(N(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eE(12)):(this.m=0,eE(13)),eq(this),eU(this)}}}catch(e){}finally{}},eP.prototype.cancel=function(){this.K=!0,eq(this)},eP.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eE(17)),eq(this),this.m=2,eU(this)):eB(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return x(e.i)}eG.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e3(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(ta(this,t),tu(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e5(e,t,n){e.i.set(t,n)}function e6(e){return e5(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e9),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e9(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e7,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e7,!0),"@"),e.push(ek(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e3(t,th(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e7=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)to(e,t)&&(n=n.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tu(e,t,n){ta(e,t),n.length>0&&(e.i=null,e.g.set(tc(e,t),x(n)),e.h+=n.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tf(){this.g=new eh}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tg(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tw(e){let t="";return B(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tb(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tw(n),"string"==typeof e?null!=n&&ek(n):e5(e,t,n))}function tx(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=ek(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+ek(n[t])),e.push(r)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tm(this.i,this.h)},c(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tg(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tg(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tx,et);var tE=/^https?$/i,tS=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tI(e),tC(e)}function tI(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function t_(e){if(e.h&&void 0!==s){if(e.v&&4==tA(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tA(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eJ)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),n=!tE.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var i=tA(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tI(e)}}finally{tC(e)}}}}function tC(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tA(e){return e.g?e.g.readyState:0}function tD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tk(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tP(e){this.za=0,this.i=[],this.j=new eI,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tk("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tk("baseRetryDelayMs",5e3,e),this.Za=tk("retryDelaySeedMs",1e4,e),this.Ta=tk("forwardChannelMaxRetries",2,e),this.va=tk("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tM(e){if(tR(e),3==e.I){var t=e.V++,n=e0(e.J);if(e5(n,"SID",e.M),e5(n,"RID",t),e5(n,"TYPE","terminate"),tV(e,n),(t=new eP(e,e.j,t)).M=2,t.A=e6(e0(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.A,n=!0),n||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eF(t)}tH(e)}function tN(e){e.g&&(tU(e),e.g.cancel(),e.g=null)}function tR(e){tN(e),e.v&&(a.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tO(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;I||A(),_||(I(),_=!0),C.add(t,e),e.D=0}}function tL(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e5(r,"SID",e.M),e5(r,"RID",n),e5(r,"AID",e.K),tV(e,r),e.u&&e.o&&tb(r,e.u,e.o),n=new eP(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tF(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,n),eO(n,r,t)}function tV(e,t){e.H&&B(e.H,function(e,n){e5(t,n,e)}),e.l&&B({},function(e,n){e5(t,n,e)})}function tF(e,t,n){n=Math.min(e.i.length,n);let r=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<n;u++){var s=i[u].g;let n=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=n instanceof Map?n:Object.entries(n);for(let[t,n]of a){let r=n;o(n)&&(r=el(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,n),a}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;I||A(),_||(I(),_=!0),C.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(u(e.Da,e),tG(e,e.A)),e.A++,!0)}function tU(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tq(e){e.g=new eP(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e5(t,"RID","rpc"),e5(t,"SID",e.M),e5(t,"AID",e.K),e5(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e5(t,"TO",e.ia),e5(t,"TYPE","xmlhttp"),tV(e,t),e.u&&e.o&&tb(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e6(e0(t)),n.u=null,n.R=!0,eL(n,e)}function tz(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tz(e),tU(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(i=ev(),new eS(i,r)),tO(e)}else tB(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(u(e.Ea,e,n),tG(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tK(e,5);break;case 4:tK(e,10);break;case 3:tK(e,6);break;default:tK(e,2)}}}function tG(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tK(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var n,r=u(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e6(i),l?function(e,t){let n=new eI;if(a.Image){let r=new Image;r.onload=h(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=h(td,n,"TestLoadImage: error",!1,t,r),r.onabort=h(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=h(td,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eI,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,r):td(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,r)}))}else eE(2);e.I=0,e.l&&e.l.pa(t),tH(e),tR(e)}function tH(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(E(e.ja,t),E(e.ja,e.i),e.h.i.length=0,x(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,n){var r=n instanceof eZ?e0(n):new eZ(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e5(r,n,t),e5(r,"VER",e.ka),tV(e,r),r}function tQ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tX(){}function tJ(e,t){et.call(this),this.g=new tP(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!N(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){em.call(this),this.status=1}function t1(e){this.g=e}(t=tx.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(u(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tS,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tC(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tC(this,!0)),tx.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?t_(this):this.Xa())},t.Xa=function(){t_(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tA(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tP.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){eE(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tW(this,null,this.W),tO(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eP(this,this.j,e),s=this.o;if(this.U&&(s?q(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tF(this,i,t),e5(n=e0(this.J),"RID",e),e5(n,"CVER",22),this.G&&e5(n,"X-HTTP-Session-Id",this.G),tV(this,n),s&&(this.R?t="headers="+ek(tw(s))+"&"+t:this.u&&tb(n,this.u,s)),eQ(this.h,i),this.Ra&&e5(n,"TYPE","init"),this.S?(e5(n,"$req",t),e5(n,"SID","null"),i.U=!0,eO(i,n,null)):eO(i,n,t),this.I=2}}else 3==this.I&&(e?tL(this,e):0==this.i.length||eK(this.h)||tL(this))},t.Da=function(){if(this.v=null,tq(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eE(10),tN(this),tq(this))},t.Va=function(){null!=this.C&&(this.C=null,tN(this),tj(this),eE(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eE(2)):(this.j.info("Failed to ping google.com"),eE(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tX.prototype.g=function(e,t){return new tJ(e,t)},c(tJ,et),tJ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tJ.prototype.close=function(){tM(this.g)},tJ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tO(t)},tJ.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,tJ.Z.N.call(this)},c(tZ,ep),c(t0,em),c(t1,tY),t1.prototype.ra=function(){en(this.g,"a")},t1.prototype.qa=function(e){en(this.g,new tZ(e))},t1.prototype.pa=function(e){en(this.g,new t0)},t1.prototype.oa=function(){en(this.g,"b")},tX.prototype.createWebChannel=tX.prototype.g,tJ.prototype.send=tJ.prototype.o,tJ.prototype.open=tJ.prototype.m,tJ.prototype.close=tJ.prototype.close,w=og.createWebChannelTransport=function(){return new tX},v=og.getStatEventTarget=function(){return ev()},y=og.Event=eg,g=og.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,m=og.ErrorCode=eC,eA.COMPLETE="complete",p=og.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,f=og.WebChannel=ed,og.FetchXmlHttpFactory=tp,tx.prototype.listenOnce=tx.prototype.K,tx.prototype.getLastError=tx.prototype.Ha,tx.prototype.getLastErrorCode=tx.prototype.ya,tx.prototype.getStatus=tx.prototype.ca,tx.prototype.getResponseJson=tx.prototype.La,tx.prototype.getResponseText=tx.prototype.la,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Fa,d=og.XhrIo=tx}).apply(void 0!==om?om:"u">typeof self?self:"u">typeof window?window:{});class oy{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}oy.UNAUTHENTICATED=new oy(null),oy.GOOGLE_CREDENTIALS=new oy("google-credentials-uid"),oy.FIRST_PARTY=new oy("first-party-uid"),oy.MOCK_USER=new oy("mock-user");let ov="12.8.0",ow=new aE("@firebase/firestore");function ob(){return ow.logLevel}function ox(e,...t){if(ow.logLevel<=u.DEBUG){let n=t.map(oT);ow.debug(`Firestore (${ov}): ${e}`,...n)}}function oE(e,...t){if(ow.logLevel<=u.ERROR){let n=t.map(oT);ow.error(`Firestore (${ov}): ${e}`,...n)}}function oS(e,...t){if(ow.logLevel<=u.WARN){let n=t.map(oT);ow.warn(`Firestore (${ov}): ${e}`,...n)}}function oT(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function oI(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,o_(e,r,n)}function o_(e,t,n){let r=`FIRESTORE (${ov}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw oE(r),Error(r)}function oC(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||o_(t,i,r)}let oA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oD extends ao{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ok{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class oP{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(oy.UNAUTHENTICATED))}shutdown(){}}class oN{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class oR{constructor(e){this.t=e,this.currentUser=oy.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){oC(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new ok;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ok,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{ox("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(ox("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ok)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ox("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(oC("string"==typeof t.accessToken,31837,{l:t}),new oP(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return oC(null===e||"string"==typeof e,2055,{h:e}),new oy(e)}}class oO{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=oy.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class oL{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new oO(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(oy.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oV{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oF{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,aX(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){oC(void 0===this.o,3512);let n=e=>{null!=e.error&&ox("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,ox("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{ox("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):ox("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new oV(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(oC("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new oV(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class oB{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function oj(e,t){return e<t?-1:+(e>t)}function oU(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return oq(n)===oq(i)?oj(n,i):oq(n)?1:-1}return oj(e.length,t.length)}function oq(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function oz(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let o$="__name__";class oG{constructor(e,t,n){void 0===t?t=0:t>e.length&&oI(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&oI(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===oG.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof oG?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=oG.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return oj(e.length,t.length)}static compareSegments(e,t){let n=oG.isNumericId(e),r=oG.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?oG.extractNumericId(e).compare(oG.extractNumericId(t)):oU(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return h.fromString(e.substring(4,e.length-2))}}class oK extends oG{construct(e,t,n){return new oK(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new oD(oA.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new oK(t)}static emptyPath(){return new oK([])}}let oH=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class oW extends oG{construct(e,t,n){return new oW(e,t,n)}static isValidIdentifier(e){return oH.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oW.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===o$}static keyField(){return new oW([o$])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new oD(oA.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new oD(oA.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new oD(oA.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new oD(oA.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new oW(t)}static emptyPath(){return new oW([])}}class oQ{constructor(e){this.path=e}static fromPath(e){return new oQ(oK.fromString(e))}static fromName(e){return new oQ(oK.fromString(e).popFirst(5))}static empty(){return new oQ(oK.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oK.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oK.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new oQ(new oK(e.slice()))}}function oY(e,t,n){if(!n)throw new oD(oA.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function oX(e){if(!oQ.isDocumentKey(e))throw new oD(oA.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function oJ(e){if(oQ.isDocumentKey(e))throw new oD(oA.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function oZ(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function o0(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":oI(12329,{type:typeof e})}function o1(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new oD(oA.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=o0(e);throw new oD(oA.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function o2(e,t){if(t<=0)throw new oD(oA.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function o3(e,t){let n={typeString:e};return t&&(n.value=t),n}function o5(e,t){let n;if(!oZ(e))throw new oD(oA.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new oD(oA.INVALID_ARGUMENT,n);return!0}class o6{static now(){return o6.fromMillis(Date.now())}static fromDate(e){return o6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new o6(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new oD(oA.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new oD(oA.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?oj(this.nanoseconds,e.nanoseconds):oj(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:o6._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(o5(e,o6._jsonSchema))return new o6(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}o6._jsonSchemaVersion="firestore/timestamp/1.0",o6._jsonSchema={type:o3("string",o6._jsonSchemaVersion),seconds:o3("number"),nanoseconds:o3("number")};class o4{static fromTimestamp(e){return new o4(e)}static min(){return new o4(new o6(0,0))}static max(){return new o4(new o6(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class o8{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function o9(e){return e.fields.find(e=>2===e.kind)}function o7(e){return e.fields.filter(e=>2!==e.kind)}function le(e,t){let n=oj(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=oW.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:oj(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return oj(e.fields.length,t.fields.length)}o8.UNKNOWN_ID=-1;class lt{constructor(e,t){this.fieldPath=e,this.kind=t}}class ln{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ln(0,ls.min())}}function lr(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ls(o4.fromTimestamp(1e9===r?new o6(n+1,0):new o6(n,r)),oQ.empty(),t)}function li(e){return new ls(e.readTime,e.key,-1)}class ls{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ls(o4.min(),oQ.empty(),-1)}static max(){return new ls(o4.max(),oQ.empty(),-1)}}function la(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=oQ.comparator(e.documentKey,t.documentKey))?n:oj(e.largestBatchId,t.largestBatchId)}let lo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ll{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function lu(e){if(e.code!==oA.FAILED_PRECONDITION||e.message!==lo)throw e;ox("LocalStore","Unexpectedly lost primary lease")}class lh{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&oI(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new lh((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof lh?t:lh.resolve(t)}catch(e){return lh.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):lh.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):lh.reject(t)}static resolve(e){return new lh((t,n)=>{t(e)})}static reject(e){return new lh((t,n)=>{n(e)})}static waitFor(e){return new lh((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=lh.resolve(!1);for(let n of e)t=t.next(e=>e?lh.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new lh((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new lh((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let lc="SimpleDb";class ld{static open(e,t,n,r){try{return new ld(t,e.transaction(r,n))}catch(e){throw new lg(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ok,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new lg(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=lx(t.target.error);this.S.reject(new lg(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ox(lc,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new lv(this.transaction.objectStore(e))}}class lf{static delete(e){return ox(lc,"Removing database:",e),lw(s3().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!aa())return!1;if(lf.F())return!0;let e=at(),t=lf.M(e),n=lp(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){return void 0!==eA.default&&"YES"===eA.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===lf.M(at())&&oE("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ox(lc,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new lg(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new oD(oA.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new oD(oA.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new lg(e,r))},r.onupgradeneeded=e=>{ox(lc,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{ox(lc,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=ld.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),lh.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(ox(lc,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function lp(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class lm{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return lw(this.U.delete())}}class lg extends oD{constructor(e,t){super(oA.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ly(e){return"IndexedDbTransactionError"===e.name}class lv{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ox(lc,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(ox(lc,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),lw(n)}add(e){return ox(lc,"ADD",this.store.name,e,e),lw(this.store.add(e))}get(e){return lw(this.store.get(e)).next(t=>(void 0===t&&(t=null),ox(lc,"GET",this.store.name,e,t),t))}delete(e){return ox(lc,"DELETE",this.store.name,e),lw(this.store.delete(e))}count(){return ox(lc,"COUNT",this.store.name),lw(this.store.count())}H(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new lh((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new lh((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){ox(lc,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.J(r,t)}te(e){let t=this.cursor({});return new lh((n,r)=>{t.onerror=e=>{r(lx(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){let n=[];return new lh((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new lm(i),a=t(i.primaryKey,i.value,s);if(a instanceof lh){let e=a.catch(e=>(s.done(),lh.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>lh.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function lw(e){return new lh((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(lx(e.target.error))}})}let lb=!1;function lx(e){let t=lf.M(at());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new oD("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lb||(lb=!0,setTimeout(()=>{throw e},0)),e}}return e}let lE="IndexBackfiller";class lS{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){ox(lE,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();ox(lE,`Documents written: ${e}`)}catch(e){ly(e)?ox(lE,"Ignoring IndexedDB error during index backfill: ",e):await lu(e)}await this.re(6e4)})}}class lT{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let n=new Set,r=t,i=!0;return lh.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return ox(lE,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(ox(lE,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=li(t);la(r,n)>0&&(n=r)}),new ls(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class lI{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function l_(e){return null==e}function lC(e){return 0===e&&1/e==-1/0}function lA(e){return"number"==typeof e&&Number.isInteger(e)&&!lC(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function lD(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}lI.ce=-1;function lk(e){let t=e.length;if(oC(t>=2,64408,{path:e}),2===t)return oC("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),oK.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&oI(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:oI(61167,{path:e})}s=t+2}return new oK(r)}let lP="remoteDocuments",lM="owner",lN="owner",lR="mutationQueues",lO="mutations",lL="batchId",lV="userMutationsIndex",lF=["userId","batchId"],lB={},lj="documentMutations",lU="remoteDocumentsV14",lq=["prefixPath","collectionGroup","readTime","documentId"],lz="documentKeyIndex",l$=["prefixPath","collectionGroup","documentId"],lG="collectionGroupIndex",lK=["collectionGroup","readTime","prefixPath","documentId"],lH="remoteDocumentGlobal",lW="remoteDocumentGlobalKey",lQ="targets",lY="queryTargetsIndex",lX=["canonicalId","targetId"],lJ="targetDocuments",lZ=["targetId","path"],l0="documentTargetsIndex",l1=["path","targetId"],l2="targetGlobalKey",l3="targetGlobal",l5="collectionParents",l6=["collectionId","parent"],l4="clientMetadata",l8="bundles",l9="namedQueries",l7="indexConfiguration",ue="collectionGroupIndex",ut="indexState",un=["indexId","uid"],ur="sequenceNumberIndex",ui=["uid","sequenceNumber"],us="indexEntries",ua=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],uo="documentKeyIndex",ul=["indexId","uid","orderedDocumentKey"],uu="documentOverlays",uh=["userId","collectionPath","documentId"],uc="collectionPathOverlayIndex",ud=["userId","collectionPath","largestBatchId"],uf="collectionGroupOverlayIndex",up=["userId","collectionGroup","largestBatchId"],um="globals",ug=[lR,lO,lj,lP,lQ,lM,l3,lJ,l4,lH,l5,l8,l9],uy=[...ug,uu],uv=[lR,lO,lj,lU,lQ,lM,l3,lJ,l4,lH,l5,l8,l9,uu],uw=[...uv,l7,ut,us],ub=[...uw,um];class ux extends ll{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function uE(e,t){return lf.O(e.le,t)}function uS(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function uT(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function uI(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class u_{constructor(e,t){this.comparator=e,this.root=t||uA.EMPTY}insert(e,t){return new u_(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,uA.BLACK,null,null))}remove(e){return new u_(this.comparator,this.root.remove(e,this.comparator).copy(null,null,uA.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uC(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uC(this.root,e,this.comparator,!1)}getReverseIterator(){return new uC(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uC(this.root,e,this.comparator,!0)}}class uC{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class uA{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:uA.RED,this.left=null!=r?r:uA.EMPTY,this.right=null!=i?i:uA.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new uA(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return uA.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return uA.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,uA.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,uA.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw oI(43730,{key:this.key,value:this.value});if(this.right.isRed())throw oI(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw oI(27949);return e+ +!this.isRed()}}uA.EMPTY=null,uA.RED=!0,uA.BLACK=!1,uA.EMPTY=new class{constructor(){this.size=0}get key(){throw oI(57766)}get value(){throw oI(16141)}get color(){throw oI(16727)}get left(){throw oI(29726)}get right(){throw oI(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new uA(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class uD{constructor(e){this.comparator=e,this.data=new u_(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uk(this.data.getIterator())}getIteratorFrom(e){return new uk(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof uD)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new uD(this.comparator);return t.data=e,t}}class uk{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function uP(e){return e.hasNext()?e.getNext():void 0}class uM{constructor(e){this.fields=e,e.sort(oW.comparator)}static empty(){return new uM([])}unionWith(e){let t=new uD(oW.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new uM(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return oz(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class uN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class uR{constructor(e){this.binaryString=e}static fromBase64String(e){return new uR(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new uN("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new uR(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return oj(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}uR.EMPTY_BYTE_STRING=new uR("");let uO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function uL(e){if(oC(!!e,39018),"string"==typeof e){let t=0,n=uO.exec(e);if(oC(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:uV(e.seconds),nanos:uV(e.nanos)}}function uV(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function uF(e){return"string"==typeof e?uR.fromBase64String(e):uR.fromUint8Array(e)}let uB="server_timestamp",uj="__type__",uU="__previous_value__",uq="__local_write_time__";function uz(e){return(e?.mapValue?.fields||{})[uj]?.stringValue===uB}function u$(e){let t=e.mapValue.fields[uU];return uz(t)?u$(t):t}function uG(e){let t=uL(e.mapValue.fields[uq].timestampValue);return new o6(t.seconds,t.nanos)}class uK{constructor(e,t,n,r,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let uH="(default)";class uW{constructor(e,t){this.projectId=e,this.database=t||uH}static empty(){return new uW("","")}get isDefaultDatabase(){return this.database===uH}isEqual(e){return e instanceof uW&&e.projectId===this.projectId&&e.database===this.database}}let uQ="__type__",uY="__max__",uX={mapValue:{fields:{__type__:{stringValue:uY}}}},uJ="__vector__",uZ="value",u0={nullValue:"NULL_VALUE"};function u1(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?uz(e)?4:ha(e)?0x1fffffffffffff:hi(e)?10:11:oI(28295,{value:e})}function u2(e,t){if(e===t)return!0;let n=u1(e);if(n!==u1(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return uG(e).isEqual(uG(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=uL(e.timestampValue),i=uL(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return uF(e.bytesValue).isEqual(uF(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return uV(e.geoPointValue.latitude)===uV(t.geoPointValue.latitude)&&uV(e.geoPointValue.longitude)===uV(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return uV(e.integerValue)===uV(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=uV(e.doubleValue),r=uV(t.doubleValue);return n===r?lC(n)===lC(r):isNaN(n)&&isNaN(r)}return!1;case 9:return oz(e.arrayValue.values||[],t.arrayValue.values||[],u2);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(uS(s)!==uS(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!u2(s[e],a[e])))return!1;return!0;default:return oI(52216,{left:e})}}function u3(e,t){return void 0!==(e.values||[]).find(e=>u2(e,t))}function u5(e,t){var n,r,i,s,a,o;if(e===t)return 0;let l=u1(e),u=u1(t);if(l!==u)return oj(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return oj(e.booleanValue,t.booleanValue);case 2:let h,c;return h=uV(e.integerValue||e.doubleValue),h<(c=uV(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return u6(e.timestampValue,t.timestampValue);case 4:return u6(uG(e),uG(t));case 5:return oU(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=uF(n),f=uF(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=oj(n[e],r[e]);if(0!==t)return t}return oj(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=oj(uV(i.latitude),uV(s.latitude)))?p:oj(uV(i.longitude),uV(s.longitude));case 9:return u4(e.arrayValue,t.arrayValue);case 10:let m,g,y,v,w;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},y=m[uZ]?.arrayValue,v=g[uZ]?.arrayValue,0!==(w=oj(y?.values?.length||0,v?.values?.length||0))?w:u4(y,v);case 11:return function(e,t){if(e===uX.mapValue&&t===uX.mapValue)return 0;if(e===uX.mapValue)return 1;if(t===uX.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=oU(r[e],s[e]);if(0!==t)return t;let a=u5(n[r[e]],i[s[e]]);if(0!==a)return a}return oj(r.length,s.length)}(e.mapValue,t.mapValue);default:throw oI(23264,{he:l})}}function u6(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return oj(e,t);let n=uL(e),r=uL(t),i=oj(n.seconds,r.seconds);return 0!==i?i:oj(n.nanos,r.nanos)}function u4(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=u5(n[e],r[e]);if(t)return t}return oj(n.length,r.length)}function u8(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=uL(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?uF(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,oQ.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=u8(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${u8(e.fields[i])}`;return n+"}"}(e.mapValue):oI(61005,{value:e})}function u9(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function u7(e){return!!e&&"integerValue"in e}function he(e){return!!e&&"arrayValue"in e}function ht(e){return!!e&&"nullValue"in e}function hn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function hr(e){return!!e&&"mapValue"in e}function hi(e){return(e?.mapValue?.fields||{})[uQ]?.stringValue===uJ}function hs(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return uT(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=hs(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=hs(e.arrayValue.values[n]);return t}return{...e}}function ha(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===uY}let ho={mapValue:{fields:{[uQ]:{stringValue:uJ},[uZ]:{arrayValue:{}}}}};function hl(e,t){let n=u5(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function hu(e,t){let n=u5(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class hh{constructor(e){this.value=e}static empty(){return new hh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!hr(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hs(t)}setAll(e){let t=oW.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=hs(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());hr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return u2(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];hr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(uT(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new hh(hs(this.value))}}class hc{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new hc(e,0,o4.min(),o4.min(),o4.min(),hh.empty(),0)}static newFoundDocument(e,t,n,r){return new hc(e,1,t,o4.min(),n,r,0)}static newNoDocument(e,t){return new hc(e,2,t,o4.min(),o4.min(),hh.empty(),0)}static newUnknownDocument(e,t){return new hc(e,3,t,o4.min(),o4.min(),hh.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(o4.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=o4.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof hc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class hd{constructor(e,t){this.position=e,this.inclusive=t}}function hf(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?oQ.comparator(oQ.fromName(a.referenceValue),n.key):u5(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function hp(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!u2(e.position[n],t.position[n]))return!1;return!0}class hm{constructor(e,t="asc"){this.field=e,this.dir=t}}class hg{}class hy extends hg{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hT(e,t,n):"array-contains"===t?new hA(e,n):"in"===t?new hD(e,n):"not-in"===t?new hk(e,n):"array-contains-any"===t?new hP(e,n):new hy(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new hI(e,n):new h_(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(u5(t,this.value)):null!==t&&u1(this.value)===u1(t)&&this.matchesComparison(u5(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return oI(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hv extends hg{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new hv(e,t)}matches(e){return hw(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function hw(e){return"and"===e.op}function hb(e){return"or"===e.op}function hx(e){return hE(e)&&hw(e)}function hE(e){for(let t of e.filters)if(t instanceof hv)return!1;return!0}function hS(e,t){let n=e.filters.concat(t);return hv.create(n,e.op)}class hT extends hy{constructor(e,t,n){super(e,t,n),this.key=oQ.fromName(n.referenceValue)}matches(e){let t=oQ.comparator(e.key,this.key);return this.matchesComparison(t)}}class hI extends hy{constructor(e,t){super(e,"in",t),this.keys=hC("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class h_ extends hy{constructor(e,t){super(e,"not-in",t),this.keys=hC("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function hC(e,t){return(t.arrayValue?.values||[]).map(e=>oQ.fromName(e.referenceValue))}class hA extends hy{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return he(t)&&u3(t.arrayValue,this.value)}}class hD extends hy{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&u3(this.value.arrayValue,t)}}class hk extends hy{constructor(e,t){super(e,"not-in",t)}matches(e){if(u3(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!u3(this.value.arrayValue,t)}}class hP extends hy{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!he(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>u3(this.value.arrayValue,e))}}class hM{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function hN(e,t=null,n=[],r=[],i=null,s=null,a=null){return new hM(e,t,n,r,i,s,a)}function hR(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof hy)return t.field.canonicalString()+t.op.toString()+u8(t.value);if(hx(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),l_(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>u8(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>u8(e)).join(",")),e.Te=t}return e.Te}function hO(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof hy?n instanceof hy&&t.op===n.op&&t.field.isEqual(n.field)&&u2(t.value,n.value):t instanceof hv?n instanceof hv&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void oI(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!hp(e.startAt,t.startAt)&&hp(e.endAt,t.endAt)}function hL(e){return oQ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function hV(e,t){return e.filters.filter(e=>e instanceof hy&&e.field.isEqual(t))}function hF(e,t,n){let r=u0,i=!0;for(let n of hV(e,t)){let e=u0,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?u0:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?u9(uW.empty(),oQ.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?hi(s)?ho:{mapValue:{}}:oI(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=u0}0>hl({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>hl({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function hB(e,t,n){let r=uX,i=!0;for(let n of hV(e,t)){let e=uX,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?u9(uW.empty(),oQ.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?ho:"mapValue"in s?hi(s)?{mapValue:{}}:uX:oI(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=uX}hu({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];hu({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class hj{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function hU(e){return new hj(e)}function hq(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function hz(e){return null!==e.collectionGroup}function h$(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new uD(oW.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new hm(t,r))}),n.has(oW.keyField().canonicalString())||e.Ie.push(new hm(oW.keyField(),r))}return e.Ie}function hG(e){return e.Ee||(e.Ee=hK(e,h$(e))),e.Ee}function hK(e,t){if("F"===e.limitType)return hN(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new hm(e.field,t)});let n=e.endAt?new hd(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new hd(e.startAt.position,e.startAt.inclusive):null;return hN(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function hH(e,t){let n=e.filters.concat([t]);return new hj(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function hW(e,t,n){return new hj(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function hQ(e,t){return hO(hG(e),hG(t))&&e.limitType===t.limitType}function hY(e){return`${hR(hG(e))}|lt:${e.limitType}`}function hX(e){var t;let n;return`Query(target=${n=(t=hG(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof hy?`${t.field.canonicalString()} ${t.op} ${u8(t.value)}`:t instanceof hv?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),l_(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>u8(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>u8(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function hJ(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):oQ.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of h$(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=hf(i,h$(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=hf(s,h$(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function hZ(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function h0(e){return(t,n)=>{let r=!1;for(let i of h$(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?oQ.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?u5(i,s):oI(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return oI(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class h1{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){uT(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return uI(this.inner)}size(){return this.innerSize}}let h2=new u_(oQ.comparator),h3=new u_(oQ.comparator);function h5(...e){let t=h3;for(let n of e)t=t.insert(n.key,n);return t}function h6(e){let t=h3;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function h4(){return new h1(e=>e.toString(),(e,t)=>e.isEqual(t))}let h8=new u_(oQ.comparator),h9=new uD(oQ.comparator);function h7(...e){let t=h9;for(let n of e)t=t.add(n);return t}let ce=new uD(oj);function ct(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lC(t)?"-0":t}}function cn(e){return{integerValue:""+e}}class cr{constructor(){this._=void 0}}function ci(e,t){return e instanceof ch?u7(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class cs extends cr{}class ca extends cr{constructor(e){super(),this.elements=e}}function co(e,t){let n=cd(t);for(let t of e.elements)n.some(e=>u2(e,t))||n.push(t);return{arrayValue:{values:n}}}class cl extends cr{constructor(e){super(),this.elements=e}}function cu(e,t){let n=cd(t);for(let t of e.elements)n=n.filter(e=>!u2(e,t));return{arrayValue:{values:n}}}class ch extends cr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function cc(e){return uV(e.integerValue||e.doubleValue)}function cd(e){return he(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class cf{constructor(e,t){this.field=e,this.transform=t}}class cp{constructor(e,t){this.version=e,this.transformResults=t}}class cm{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new cm}static exists(e){return new cm(void 0,e)}static updateTime(e){return new cm(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cg(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class cy{}function cv(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new c_(e.key,cm.none()):new cx(e.key,e.data,cm.none());{let n=e.data,r=hh.empty(),i=new uD(oW.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new cE(e.key,r,new uM(i.toArray()),cm.none())}}function cw(e,t,n,r){return e instanceof cx?function(e,t,n,r){if(!cg(e.precondition,t))return n;let i=e.value.clone(),s=cI(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof cE?function(e,t,n,r){if(!cg(e.precondition,t))return n;let i=cI(e.fieldTransforms,r,t),s=t.data;return(s.setAll(cS(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):cg(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function cb(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&oz(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof ca&&r instanceof ca||n instanceof cl&&r instanceof cl?oz(n.elements,r.elements,u2):n instanceof ch&&r instanceof ch?u2(n.Ae,r.Ae):n instanceof cs&&r instanceof cs)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class cx extends cy{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class cE extends cy{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cS(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function cT(e,t,n){let r=new Map;oC(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof ca?co(o,l):o instanceof cl?cu(o,l):i))}return r}function cI(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof cs?(r=t,i={fields:{[uj]:{stringValue:uB},[uq]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&uz(r)&&(r=u$(r)),r&&(i.fields[uU]=r),{mapValue:i}):e instanceof ca?co(e,t):e instanceof cl?cu(e,t):(a=cc(s=ci(e,t))+cc(e.Ae),u7(s)&&u7(e.Ae)?cn(a):ct(e.serializer,a))}(e,s,t))}return r}class c_ extends cy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cC extends cy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class cA{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof cx?(r=e.value.clone(),i=cT(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof cE?function(e,t,n){if(!cg(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=cT(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(cS(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=cw(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=cw(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=h4();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=cv(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(o4.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),h7())}isEqual(e){return this.batchId===e.batchId&&oz(this.mutations,e.mutations,(e,t)=>cb(e,t))&&oz(this.baseMutations,e.baseMutations,(e,t)=>cb(e,t))}}class cD{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){oC(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=h8,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new cD(e,t,n,r)}}class ck{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class cP{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class cM{constructor(e,t){this.count=e,this.unchangedNames=t}}function cN(e){switch(e){case oA.OK:return oI(64938);case oA.CANCELLED:case oA.UNKNOWN:case oA.DEADLINE_EXCEEDED:case oA.RESOURCE_EXHAUSTED:case oA.INTERNAL:case oA.UNAVAILABLE:case oA.UNAUTHENTICATED:return!1;case oA.INVALID_ARGUMENT:case oA.NOT_FOUND:case oA.ALREADY_EXISTS:case oA.PERMISSION_DENIED:case oA.FAILED_PRECONDITION:case oA.ABORTED:case oA.OUT_OF_RANGE:case oA.UNIMPLEMENTED:case oA.DATA_LOSS:return!0;default:return oI(15467,{code:e})}}function cR(e){if(void 0===e)return oE("GRPC error has no .code"),oA.UNKNOWN;switch(e){case b.OK:return oA.OK;case b.CANCELLED:return oA.CANCELLED;case b.UNKNOWN:return oA.UNKNOWN;case b.DEADLINE_EXCEEDED:return oA.DEADLINE_EXCEEDED;case b.RESOURCE_EXHAUSTED:return oA.RESOURCE_EXHAUSTED;case b.INTERNAL:return oA.INTERNAL;case b.UNAVAILABLE:return oA.UNAVAILABLE;case b.UNAUTHENTICATED:return oA.UNAUTHENTICATED;case b.INVALID_ARGUMENT:return oA.INVALID_ARGUMENT;case b.NOT_FOUND:return oA.NOT_FOUND;case b.ALREADY_EXISTS:return oA.ALREADY_EXISTS;case b.PERMISSION_DENIED:return oA.PERMISSION_DENIED;case b.FAILED_PRECONDITION:return oA.FAILED_PRECONDITION;case b.ABORTED:return oA.ABORTED;case b.OUT_OF_RANGE:return oA.OUT_OF_RANGE;case b.UNIMPLEMENTED:return oA.UNIMPLEMENTED;case b.DATA_LOSS:return oA.DATA_LOSS;default:return oI(39323,{code:e})}}(x=b||(b={}))[x.OK=0]="OK",x[x.CANCELLED=1]="CANCELLED",x[x.UNKNOWN=2]="UNKNOWN",x[x.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",x[x.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",x[x.NOT_FOUND=5]="NOT_FOUND",x[x.ALREADY_EXISTS=6]="ALREADY_EXISTS",x[x.PERMISSION_DENIED=7]="PERMISSION_DENIED",x[x.UNAUTHENTICATED=16]="UNAUTHENTICATED",x[x.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",x[x.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",x[x.ABORTED=10]="ABORTED",x[x.OUT_OF_RANGE=11]="OUT_OF_RANGE",x[x.UNIMPLEMENTED=12]="UNIMPLEMENTED",x[x.INTERNAL=13]="INTERNAL",x[x.UNAVAILABLE=14]="UNAVAILABLE",x[x.DATA_LOSS=15]="DATA_LOSS";let cO=null;function cL(){return new TextEncoder}let cV=new h([0xffffffff,0xffffffff],0);function cF(e){let t=cL().encode(e),n=new c;return n.update(t),new Uint8Array(n.digest())}function cB(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new h([n,r],0),new h([i,s],0)]}class cj{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new cU(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new cU(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new cU(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=h.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(h.fromNumber(n)));return 1===r.compare(cV)&&(r=new h([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=cB(cF(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new cj(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=cB(cF(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class cU extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cq{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,cz.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new cq(o4.min(),r,new u_(oj),h2,h7())}}class cz{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new cz(n,t,h7(),h7(),h7())}}class c${constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class cG{constructor(e,t){this.targetId=e,this.Ce=t}}class cK{constructor(e,t,n=uR.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class cH{constructor(){this.ve=0,this.Fe=cY(),this.Me=uR.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=h7(),t=h7(),n=h7();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:oI(38017,{changeType:i})}}),new cz(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=cY()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,oC(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class cW{constructor(e){this.Ge=e,this.ze=new Map,this.je=h2,this.He=cQ(),this.Je=cQ(),this.Ze=new u_(oj)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:oI(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let a=r.target;if(hL(a))if(0===n){let e=new oQ(a.path);this.et(t,e,hc.newNoDocument(e,o4.min()))}else oC(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){var i,s;let n,a,o=this.ut(e),l=o?this.ct(o,e,r):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),cO?.lt((i=e.Ce,s=this.Ge.ht(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(n.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),n))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=uF(i).toUint8Array()}catch(e){if(e instanceof uN)return oS("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new cj(t,s,a)}catch(e){return oS(e instanceof cU?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&hL(i.target)){let t=new oQ(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,hc.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}});let n=h7();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new cq(e,t,this.Ze,this.je,n);return this.je=h2,this.He=cQ(),this.Je=cQ(),this.Ze=new u_(oj),r}Ye(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new cH,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new uD(oj),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new uD(oj),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||ox("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new cH),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function cQ(){return new u_(oQ.comparator)}function cY(){return new u_(oQ.comparator)}let cX={asc:"ASCENDING",desc:"DESCENDING"},cJ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cZ={and:"AND",or:"OR"};class c0{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function c1(e,t){return e.useProto3Json||l_(t)?t:{value:t}}function c2(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function c3(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function c5(e){let t;return oC(!!e,49232),o4.fromTimestamp(new o6((t=uL(e)).seconds,t.nanos))}function c6(e,t){return c4(e,t).canonicalString()}function c4(e,t){let n=new oK(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function c8(e){let t=oK.fromString(e);return oC(dp(t),10190,{key:t.toString()}),t}function c9(e,t){return c6(e.databaseId,t.path)}function c7(e,t){let n=c8(t);if(n.get(1)!==e.databaseId.projectId)throw new oD(oA.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new oD(oA.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new oQ(dr(n))}function de(e,t){return c6(e.databaseId,t)}function dt(e){let t=c8(e);return 4===t.length?oK.emptyPath():dr(t)}function dn(e){return new oK(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function dr(e){return oC(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function di(e,t,n){return{name:c9(e,t),fields:n.value.mapValue.fields}}function ds(e,t,n){let r=c7(e,t.name),i=c5(t.updateTime),s=t.createTime?c5(t.createTime):o4.min(),a=new hh({mapValue:{fields:t.fields}}),o=hc.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function da(e,t){var n,r;let i;if(t instanceof cx)i={update:di(e,t.key,t.value)};else if(t instanceof c_)i={delete:c9(e,t.key)};else if(t instanceof cE){let n;i={update:di(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof cC))return oI(16599,{dt:t.type});i={verify:c9(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof cs)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ca)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof cl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ch)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw oI(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:c2(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:oI(27497)),i}function dl(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?cm.updateTime(c5(n.updateTime)):void 0!==n.exists?cm.exists(n.exists):cm.none():cm.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(oC("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new cs):"appendMissingElements"in t?n=new ca(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new cl(t.removeAllFromArray.values||[]):"increment"in t?n=new ch(e,t.increment):oI(16584,{proto:t}),new cf(oW.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=c7(e,t.update.name),s=new hh({mapValue:{fields:t.update.fields}});return t.updateMask?new cE(n,s,new uM((t.updateMask.fieldPaths||[]).map(e=>oW.fromServerFormat(e))),r,i):new cx(n,s,r,i)}return t.delete?new c_(c7(e,t.delete),r):t.verify?new cC(c7(e,t.verify),r):oI(1463,{proto:t})}function du(e,t){return{documents:[de(e,t.path)]}}function dh(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=de(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof hy?function(e){if("=="===e.op){if(hn(e.value))return{unaryFilter:{field:dd(e.field),op:"IS_NAN"}};if(ht(e.value))return{unaryFilter:{field:dd(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(hn(e.value))return{unaryFilter:{field:dd(e.field),op:"IS_NOT_NAN"}};if(ht(e.value))return{unaryFilter:{field:dd(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dd(e.field),op:cJ[e.op],value:e.value}}}(t):t instanceof hv?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:cZ[n.op],filters:r}}:oI(54877,{filter:t})}(hv.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:dd(e.field),direction:cX[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=c1(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}function dc(e){var t,n,r;let i,s,a,o,l=dt(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){oC(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=df(e.unaryFilter.field);return hy.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=df(e.unaryFilter.field);return hy.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=df(e.unaryFilter.field);return hy.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=df(e.unaryFilter.field);return hy.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return oI(61313);default:return oI(60726)}}(t):void 0!==t.fieldFilter?hy.create(df(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return oI(58110);default:return oI(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?hv.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return oI(1026)}}(t.compositeFilter.op)):oI(30097,{filter:t})}(u.where))instanceof hv&&hx(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new hm(df(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=l_(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(n=u.startAt).before,m=new hd(n.values||[],a));let g=null;return u.endAt&&(o=!(r=u.endAt).before,g=new hd(r.values||[],o)),new hj(l,c,f,d,p,"F",m,g)}function dd(e){return{fieldPath:e.canonicalString()}}function df(e){return oW.fromServerFormat(e.fieldPath)}function dp(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function dm(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class dg{constructor(e,t,n,r,i=o4.min(),s=o4.min(),a=uR.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new dg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dy{constructor(e){this.yt=e}}function dv(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:dw(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:c9(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:c2(i,t.version.toTimestamp()),createTime:c2(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:db(t.version)};else{if(!t.isUnknownDocument())return oI(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:db(t.version)}}return r}function dw(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function db(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function dx(e){let t=new o6(e.seconds,e.nanoseconds);return o4.fromTimestamp(t)}function dE(e,t){let n=(t.baseMutations||[]).map(t=>dl(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>dl(e.yt,t)),i=o6.fromMillis(t.localWriteTimeMs);return new cA(t.batchId,i,n,r)}function dS(e){var t;let n,r=dx(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?dx(e.lastLimboFreeSnapshotVersion):o4.min();return new dg(void 0!==e.query.documents?(oC(1===(n=(t=e.query).documents.length),1966,{count:n}),hG(hU(dt(t.documents[0])))):hG(dc(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,uR.fromBase64String(e.resumeToken))}function dT(e,t){let n,r=db(t.snapshotVersion),i=db(t.lastLimboFreeSnapshotVersion);n=hL(t.target)?du(e.yt,t.target):dh(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:hR(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function dI(e){let t=dc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?hW(t,t.limit,"L"):t}function d_(e,t){return new ck(t.largestBatchId,dl(e.yt,t.overlayMutation))}function dC(e,t){let n=t.path.lastSegment();return[e,lD(t.path.popLast()),n]}function dA(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:db(r.readTime),documentKey:lD(r.documentKey.path),largestBatchId:r.largestBatchId}}class dD{getBundleMetadata(e,t){return uE(e,l8).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:dx(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return uE(e,l8).put({bundleId:t.id,createTime:db(c5(t.createTime)),version:t.version})}getNamedQuery(e,t){return uE(e,l9).get(t).next(e=>{if(e)return{name:e.name,query:dI(e.bundledQuery),readTime:dx(e.readTime)}})}saveNamedQuery(e,t){return uE(e,l9).put({name:t.name,readTime:db(c5(t.readTime)),bundledQuery:t.bundledQuery})}}class dk{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new dk(e,t.uid||"")}getOverlay(e,t){return uE(e,uu).get(dC(this.userId,t)).next(e=>e?d_(this.serializer,e):null)}getOverlays(e,t){let n=h4();return lh.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new ck(t,i);r.push(this.bt(e,s))}),lh.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(lD(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(uE(e,uu).X(uc,r))}),lh.waitFor(i)}getOverlaysForCollection(e,t,n){let r=h4(),i=lD(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return uE(e,uu).H(uc,s).next(e=>{for(let t of e){let e=d_(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=h4(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return uE(e,uu).ee({index:uf,range:a},(e,t,n)=>{let a=d_(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}bt(e,t){return uE(e,uu).put(function(e,t,n){let[r,i,s]=dC(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:da(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}class dP{St(e){return uE(e,um)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?uR.fromUint8Array(t):uR.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class dM{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(uV(e.integerValue));else if("doubleValue"in e){let n=uV(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),lC(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=uL(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(uF(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?ha(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):hi(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):oI(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[uZ].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(uV(r)),this.Ot(uZ,t),this.Ct(n[uZ],t)}qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),oQ.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function dN(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}dM.Wt=new dM;class dR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ht(n.value),n=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),n=dN(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),n=dN(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class dO{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class dL{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class dV{constructor(){this.cn=new dR,this.ascending=new dO(this.cn),this.descending=new dL(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class dF{constructor(e,t,n,r){this.hn=e,this.Pn=t,this.Tn=n,this.In=r}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.In,0),t!==e?n.set([0],this.In.length):++n[n.length-1],new dF(this.hn,this.Pn,this.Tn,n)}Rn(e,t,n){return{indexId:this.hn,uid:e,arrayValue:dU(this.Tn),directionalValue:dU(this.In),orderedDocumentKey:dU(t),documentKey:n.path.toArray()}}An(e,t,n){let r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function dB(e,t){let n=e.hn-t.hn;return 0!==n||0!==(n=dj(e.Tn,t.Tn))||0!==(n=dj(e.In,t.In))?n:oQ.comparator(e.Pn,t.Pn)}function dj(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function dU(e){return as()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function dq(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class dz{constructor(e){for(const t of(this.Vn=new uD((e,t)=>oW.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(oC(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=o9(e);if(void 0!==t&&!this.pn(t))return!1;let n=o7(e),r=new Set,i=0,s=0;for(;i<n.length&&this.pn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new uD(oW.comparator),t=[];for(let n of this.mn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new lt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new lt(n.field,0))}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new lt(n.field,+("asc"!==n.dir))));return new o8(o8.UNKNOWN_ID,this.collectionId,t,ln.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function d$(e){return e instanceof hy}function dG(e){return e instanceof hv&&hx(e)}function dK(e){return d$(e)||dG(e)||function(e){if(e instanceof hv&&hb(e)){for(let t of e.getFilters())if(!d$(t)&&!dG(t))return!1;return!0}return!1}(e)}function dH(e,t){return oC(e instanceof hy||e instanceof hv,38388),oC(t instanceof hy||t instanceof hv,25473),dQ(e instanceof hy?t instanceof hy?hv.create([e,t],"and"):dW(e,t):t instanceof hy?dW(t,e):function(e,t){if(oC(e.filters.length>0&&t.filters.length>0,48005),hw(e)&&hw(t))return hS(e,t.getFilters());let n=hb(e)?e:t,r=hb(e)?t:e,i=n.filters.map(e=>dH(e,r));return hv.create(i,"or")}(e,t))}function dW(e,t){if(hw(t))return hS(t,e.getFilters());{let n=t.filters.map(t=>dH(e,t));return hv.create(n,"or")}}function dQ(e){if(oC(e instanceof hy||e instanceof hv,11850),e instanceof hy)return e;let t=e.getFilters();if(1===t.length)return dQ(t[0]);if(hE(e))return e;let n=t.map(e=>dQ(e)),r=[];return n.forEach(t=>{t instanceof hy?r.push(t):t instanceof hv&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:hv.create(r,e.op)}class dY{constructor(){this.Sn=new dX}addToCollectionParentIndex(e,t){return this.Sn.add(t),lh.resolve()}getCollectionParents(e,t){return lh.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return lh.resolve()}deleteFieldIndex(e,t){return lh.resolve()}deleteAllFieldIndexes(e){return lh.resolve()}createTargetIndexes(e,t){return lh.resolve()}getDocumentsMatchingTarget(e,t){return lh.resolve(null)}getIndexType(e,t){return lh.resolve(0)}getFieldIndexes(e,t){return lh.resolve([])}getNextCollectionGroupToUpdate(e){return lh.resolve(null)}getMinOffset(e,t){return lh.resolve(ls.min())}getMinOffsetFromCollectionGroup(e,t){return lh.resolve(ls.min())}updateCollectionGroup(e,t,n){return lh.resolve()}updateIndexEntries(e,t){return lh.resolve()}}class dX{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new uD(oK.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new uD(oK.comparator)).toArray()}}let dJ="IndexedDbIndexManager",dZ=new Uint8Array(0);class d0{constructor(e,t){this.databaseId=t,this.Dn=new dX,this.Cn=new h1(e=>hR(e),(e,t)=>hO(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:n,parent:lD(r)};return uE(e,l5).put(i)}return lh.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return uE(e,l5).H(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(lk(r.parent))}return n})}addFieldIndex(e,t){let n=uE(e,l7),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=uE(e,ut);return i.next(e=>{n.put(dA(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=uE(e,l7),r=uE(e,ut),i=uE(e,us);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=uE(e,l7),n=uE(e,us),r=uE(e,ut);return t.X().next(()=>n.X()).next(()=>r.X())}createTargetIndexes(e,t){return lh.forEach(this.vn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new dz(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=uE(e,us),r=!0,i=new Map;return lh.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=h7(),r=[];return lh.forEach(i,(i,s)=>{ox(dJ,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${hR(t)}`);let a=function(e,t){let n=o9(t);if(void 0===n)return null;for(let t of hV(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of o7(t))for(let t of hV(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of o7(t)){let t=0===i.kind?hF(e,i.fieldPath,e.startAt):hB(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new hd(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of o7(t)){let t=0===i.kind?hB(e,i.fieldPath,e.endAt):hF(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new hd(n,r)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return lh.forEach(f,i=>n.Z(i,t.limit).next(t=>{t.forEach(t=>{let n=oQ.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return lh.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(oC(t instanceof hy||t instanceof hv,34018),t instanceof hy)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=hv.create(n,t.op);return dK(r=dQ(r))?r:(oC(r instanceof hv,64498),oC(hw(r),40251),oC(r.filters.length>1,57927),r.filters.reduce((e,t)=>dH(e,t)))}(function e(t){if(oC(t instanceof hy||t instanceof hv,20012),t instanceof hy){if(t instanceof hD){let e=t.value.arrayValue?.values?.map(e=>hy.create(t.field,"==",e))||[];return hv.create(e,"or")}return t}let n=t.filters.map(t=>e(t));return hv.create(n,t.op)}(e));return oC(dK(t),7391),d$(t)||dG(t)?[t]:t.getFilters()})(hv.create(e.filters,"and")).map(t=>hN(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):dZ,c=this.Bn(e,o,n[h%l],r),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,n,r){let i=new dF(e,oQ.empty(),t,n);return r?i:i.En()}Ln(e,t,n,r){let i=new dF(e,oQ.empty(),t,n);return r?i.En():i}Fn(e,t){let n=new dz(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.gn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.vn(t);return lh.forEach(r,t=>this.Fn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new uD(oW.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}kn(e,t){let n=new dV;for(let r of o7(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.ln(r.kind);dM.Wt.Dt(e,i)}return n.un()}Nn(e){let t=new dV;return dM.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let n,r=new dV;return dM.Wt.Dt(u9(this.databaseId,t),r.ln(0===(n=o7(e)).length?0:n[n.length-1].kind)),r.un()}xn(e,t,n){if(null===n)return[];let r=[];r.push(new dV);let i=0;for(let s of o7(e)){let e=n[i++];for(let n of r)if(this.qn(t,s.fieldPath)&&he(e))r=this.Un(r,s,e);else{let t=n.ln(s.kind);dM.Wt.Dt(e,t)}}return this.$n(r)}Mn(e,t,n){return this.xn(e,t,n.position)}$n(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Un(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new dV;r.seed(n.un()),dM.Wt.Dt(e,r.ln(t.kind)),i.push(r)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof hy&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=uE(e,l7),r=uE(e,ut);return(t?n.H(ue,IDBKeyRange.bound(t,t)):n.H()).next(e=>{let t=[];return lh.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new ln(n.sequenceNumber,new ls(dx(n.readTime),new oQ(lk(n.documentKey)),n.largestBatchId)):ln.empty(),i=e.fields.map(([e,t])=>new lt(oW.fromServerFormat(e),t)),new o8(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:oj(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=uE(e,l7),i=uE(e,ut);return this.Wn(e).next(e=>r.H(ue,IDBKeyRange.bound(t,t)).next(t=>lh.forEach(t,t=>i.put(dA(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return lh.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?lh.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),lh.forEach(i,n=>this.Qn(e,t,n).next(t=>{let i=this.Gn(r,n);return t.isEqual(i)?lh.resolve():this.zn(e,r,n,t,i)}))))})}jn(e,t,n,r){return uE(e,us).put(r.Rn(this.uid,this.Kn(n,t.key),t.key))}Hn(e,t,n,r){return uE(e,us).delete(r.An(this.uid,this.Kn(n,t.key),t.key))}Qn(e,t,n){let r=uE(e,us),i=new uD(dB);return r.ee({index:uo,range:IDBKeyRange.only([n.indexId,this.uid,dU(this.Kn(n,t))])},(e,r)=>{i=i.add(new dF(n.indexId,t,dq(r.arrayValue),dq(r.directionalValue)))}).next(()=>i)}Gn(e,t){let n=new uD(dB),r=this.kn(t,e);if(null==r)return n;let i=o9(t);if(null!=i){let s=e.data.field(i.fieldPath);if(he(s))for(let i of s.arrayValue.values||[])n=n.add(new dF(t.indexId,e.key,this.Nn(i),r))}else n=n.add(new dF(t.indexId,e.key,dZ,r));return n}zn(e,t,n,r,i){ox(dJ,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=uP(s),l=uP(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=uP(a)):t?(i(o),o=uP(s)):(o=uP(s),l=uP(a))}}(r,i,dB,r=>{s.push(this.jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),lh.waitFor(s)}Wn(e){let t=1;return uE(e,ut).ee({index:ur,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>dB(e,t)).filter((e,t,n)=>!t||0!==dB(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=dB(i,e),s=dB(i,t);if(0===n)r[0]=e.En();else if(n>0&&s<0)r.push(i),r.push(i.En());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Jn(r[e],r[e+1]))return[];let t=r[e].An(this.uid,dZ,oQ.empty()),n=r[e+1].An(this.uid,dZ,oQ.empty());i.push(IDBKeyRange.bound(t,n))}return i}Jn(e,t){return dB(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(d1)}getMinOffset(e,t){return lh.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||oI(44426))).next(d1)}}function d1(e){oC(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>la(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ls(t.readTime,t.documentKey,n)}let d2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class d3{static withCacheSize(e){return new d3(e,d3.DEFAULT_COLLECTION_PERCENTILE,d3.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function d5(e,t,n){let r=e.store(lO),i=e.store(lj),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.ee({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{oC(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,lD(h),c]);s.push(i.delete(r)),u.push(e.key)}return lh.waitFor(s).next(()=>u)}function d6(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw oI(14731);t=e.noDocument}return JSON.stringify(t).length}d3.DEFAULT_COLLECTION_PERCENTILE=10,d3.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,d3.DEFAULT=new d3(0x2800000,d3.DEFAULT_COLLECTION_PERCENTILE,d3.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),d3.DISABLED=new d3(-1,0,0);class d4{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static wt(e,t,n,r){return oC(""!==e.uid,64387),new d4(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return d9(e).ee({index:lV,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=uE(e,lj),s=d9(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;oC("number"==typeof a,49019);let f=new cA(a,t,n,r),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>da(o.yt,e)),d=f.mutations.map(e=>da(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],g=new uD((e,t)=>oj(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,lD(h),a]);g=g.add(e.key.path.popLast()),m.push(s.put(p)),m.push(i.put(t,lB))}return g.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),lh.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return d9(e).get(t).next(e=>e?(oC(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),dE(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?lh.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return d9(e).ee({index:lV,range:r},(e,t,r)=>{t.userId===this.userId&&(oC(t.batchId>=n,47524,{Yn:n}),i=dE(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return d9(e).ee({index:lV,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return d9(e).H(lV,t).next(e=>e.map(e=>dE(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,lD(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return uE(e,lj).ee({range:r},(n,r,s)=>{let[a,o,l]=n,u=lk(o);if(a===this.userId&&t.path.isEqual(u))return d9(e).get(l).next(e=>{if(!e)throw oI(61480,{er:n,batchId:l});oC(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(dE(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new uD(oj),r=[];return t.forEach(t=>{let i=[this.userId,lD(t.path)],s=IDBKeyRange.lowerBound(i),a=uE(e,lj).ee({range:s},(e,r,i)=>{let[s,a,o]=e,l=lk(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),lh.waitFor(r).next(()=>this.tr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,lD(n)],s=IDBKeyRange.lowerBound(i),a=new uD(oj);return uE(e,lj).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=lk(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(d9(e).get(t).next(e=>{if(null===e)throw oI(35274,{batchId:t});oC(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(dE(this.serializer,e))}))}),lh.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return d5(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),lh.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return lh.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return uE(e,lj).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=lk(e[1]);r.push(t)}else n.done()}).next(()=>{oC(0===r.length,56720,{rr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return d8(e,this.userId,t)}ir(e){return uE(e,lR).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function d8(e,t,n){let r=[t,lD(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return uE(e,lj).ee({range:s,Y:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function d9(e){return uE(e,lO)}class d7{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new d7(0)}static ar(){return new d7(-1)}}class fe{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let n=new d7(t.highestTargetId);return t.highestTargetId=n.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>o4.fromTimestamp(new o6(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.ur(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.cr(e,r)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(n=>(n.targetCount+=1,this.hr(t,n),this.cr(e,n))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>uE(e,lQ).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(oC(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return uE(e,lQ).ee((s,a)=>{let o=dS(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>lh.waitFor(i)).next(()=>r)}forEachTarget(e,t){return uE(e,lQ).ee((e,n)=>{t(dS(n))})}ur(e){return uE(e,l3).get(l2).next(e=>(oC(null!==e,2888),e))}cr(e,t){return uE(e,l3).put(l2,t)}lr(e,t){return uE(e,lQ).put(dT(this.serializer,t))}hr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let n=hR(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return uE(e,lQ).ee({range:r,index:lY},(e,n,r)=>{let s=dS(n);hO(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=ft(e);return t.forEach(t=>{let s=lD(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),lh.waitFor(r)}removeMatchingKeys(e,t,n){let r=ft(e);return lh.forEach(t,t=>{let i=lD(t.path);return lh.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=ft(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ft(e),i=h7();return r.ee({range:n,Y:!0},(e,t,n)=>{let r=new oQ(lk(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=lD(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return ft(e).ee({index:l0,Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}At(e,t){return uE(e,lQ).get(t).next(e=>e?dS(e):null)}}function ft(e){return uE(e,lJ)}let fn="LruGarbageCollector";function fr([e,t],[n,r]){let i=oj(e,n);return 0===i?oj(t,r):i}class fi{constructor(e){this.Pr=e,this.buffer=new uD(fr),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>fr(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fs{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){ox(fn,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ly(e)?ox(fn,"Ignoring IndexedDB error during garbage collection: ",e):await lu(e)}await this.Ar(3e5)})}}class fa{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return lh.resolve(lI.ce);let n=new fi(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ox("LruGarbageCollector","Garbage collection skipped; disabled"),lh.resolve(d2)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ox("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),d2):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,i,s,a,o,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ox("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),ob()<=u.DEBUG&&ox("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-h}ms`),lh.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class fo{constructor(e,t){this.db=e,this.garbageCollector=new fa(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,n)=>t(n))}addReference(e,t,n){return fl(e,n)}removeReference(e,t,n){return fl(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return fl(e,t)}wr(e,t){let n;return n=!1,uE(e,lR).te(r=>d8(e,r,t).next(e=>(e&&(n=!0),lh.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,o4.min()),ft(e).delete([0,lD(s.path)])))});r.push(t)}}).next(()=>lh.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return fl(e,t)}yr(e,t){let n=ft(e),r,i=lI.ce;return n.ee({index:l0},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==lI.ce&&t(new oQ(lk(r)),i),i=a,r=s):i=lI.ce}).next(()=>{i!==lI.ce&&t(new oQ(lk(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function fl(e,t){var n;return ft(e).put((n=e.currentSequenceNumber,{targetId:0,path:lD(t.path),sequenceNumber:n}))}class fu{constructor(){this.changes=new h1(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,hc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?lh.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fh{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return uE(e,lU).put(n)}removeEntry(e,t,n){let r;return uE(e,lU).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],dw(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=hc.newInvalidDocument(t);return uE(e,lU).ee({index:lz,range:IDBKeyRange.only(fd(t))},(e,r)=>{n=this.Sr(t,r)}).next(()=>n)}Dr(e,t){let n={size:0,document:hc.newInvalidDocument(t)};return uE(e,lU).ee({index:lz,range:IDBKeyRange.only(fd(t))},(e,r)=>{n={document:this.Sr(t,r),size:d6(r)}}).next(()=>n)}getEntries(e,t){let n=h2;return this.Cr(e,t,(e,t)=>{let r=this.Sr(e,t);n=n.insert(e,r)}).next(()=>n)}vr(e,t){let n=h2,r=new u_(oQ.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);n=n.insert(e,i),r=r.insert(e,d6(t))}).next(()=>({documents:n,Fr:r}))}Cr(e,t,n){if(t.isEmpty())return lh.resolve();let r=new uD(fp);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(fd(r.first()),fd(r.last())),s=r.getIterator(),a=s.getNext();return uE(e,lU).ee({index:lz,range:i},(e,t,r)=>{let i=oQ.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>fp(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(fd(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),dw(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return uE(e,lU).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let n=h2;for(let i of e){let e=this.Sr(oQ.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(hJ(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=h2,s=ff(t,n),a=ff(t,ls.max());return uE(e,lU).ee({index:lG,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Sr(oQ.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new fc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return uE(e,lH).get(lW).next(e=>(oC(!!e,20021),e))}br(e,t){return uE(e,lH).put(lW,t)}Sr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=ds(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=oQ.fromSegments(t.noDocument.path),n=dx(t.noDocument.readTime);r=hc.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return oI(56709);{let e=oQ.fromSegments(t.unknownDocument.path),n=dx(t.unknownDocument.version);r=hc.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new o6((n=t.readTime)[0],n[1]),o4.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(o4.min())))return e}return hc.newInvalidDocument(e)}}class fc extends fu{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new h1(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new uD((e,t)=>oj(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=dv(this.Mr.serializer,s);r=r.add(i.path.popLast());let l=d6(o);n+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=dv(this.Mr.serializer,s.convertToNoDocument(o4.min()));t.push(this.Mr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Mr.updateMetadata(e,n)),lh.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,n)=>{this.Or.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function fd(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ff(e,t){let n=t.documentKey.path.toArray();return[e,dw(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function fp(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=oj(n[e],r[e]))return i;return(i=oj(n.length,r.length))||(i=oj(n[n.length-2],r[r.length-2]))||oj(n[n.length-1],r[r.length-1])}class fm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class fg{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&cw(n.mutation,e,uM.empty(),o6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,h7()).next(()=>t))}getLocalViewOfDocuments(e,t,n=h7()){let r=h4();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=h5();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=h4();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,h7()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=h2,s=h4(),a=h4();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof cE)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),cw(a.mutation,t,a.mutation.getFieldMask(),o6.now())):s.set(t.key,uM.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new fm(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let n=h4(),r=new u_((e,t)=>e-t),i=h7();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||uM.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||h7()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=h4();l.forEach(e=>{if(!i.has(e)){let r=cv(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return lh.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return oQ.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):hz(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):lh.resolve(h4()),a=-1,o=i;return s.next(t=>lh.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?lh.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,h7())).next(e=>({batchId:a,changes:h6(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new oQ(t)).next(e=>{let t=h5();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=h5();return this.indexManager.getCollectionParents(e,i).next(a=>lh.forEach(a,a=>{let o=new hj(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,hc.newInvalidDocument(r)))});let n=h5();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&cw(s.mutation,r,uM.empty(),o6.now()),hJ(t,r)&&(n=n.insert(e,r))}),n})}}class fy{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return lh.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:c5(t.createTime)}),lh.resolve()}getNamedQuery(e,t){return lh.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:dI(t.bundledQuery),readTime:c5(t.readTime)}),lh.resolve()}}class fv{constructor(){this.overlays=new u_(oQ.comparator),this.Lr=new Map}getOverlay(e,t){return lh.resolve(this.overlays.get(t))}getOverlays(e,t){let n=h4();return lh.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),lh.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),lh.resolve()}getOverlaysForCollection(e,t,n){let r=h4(),i=t.length+1,s=new oQ(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return lh.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new u_((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=h4(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=h4(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return lh.resolve(a)}bt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ck(t,n));let i=this.Lr.get(t);void 0===i&&(i=h7(),this.Lr.set(t,i)),this.Lr.set(t,i.add(n.key))}}class fw{constructor(){this.sessionToken=uR.EMPTY_BYTE_STRING}getSessionToken(e){return lh.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,lh.resolve()}}class fb{constructor(){this.kr=new uD(fx.Kr),this.qr=new uD(fx.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let n=new fx(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new fx(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new oQ(new oK([])),n=new fx(t,e),r=new fx(t,e+1),i=[];return this.qr.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new oQ(new oK([])),n=new fx(t,e),r=new fx(t,e+1),i=h7();return this.qr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new fx(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class fx{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return oQ.comparator(e.key,t.key)||oj(e.Hr,t.Hr)}static Ur(e,t){return oj(e.Hr,t.Hr)||oQ.comparator(e.key,t.key)}}class fE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new uD(fx.Kr)}checkEmpty(e){return lh.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new cA(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Jr=this.Jr.add(new fx(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return lh.resolve(s)}lookupMutationBatch(e,t){return lh.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Xr(t+1),r=n<0?0:n;return lh.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return lh.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return lh.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new fx(t,0),r=new fx(t,1/0),i=[];return this.Jr.forEachInRange([n,r],e=>{let t=this.Zr(e.Hr);i.push(t)}),lh.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new uD(oj);return t.forEach(e=>{let t=new fx(e,0),r=new fx(e,1/0);this.Jr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),lh.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;oQ.isDocumentKey(i)||(i=i.child(""));let s=new fx(new oQ(i),0),a=new uD(oj);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Hr)),!0)},s),lh.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){oC(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return lh.forEach(t.mutations,r=>{let i=new fx(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){let n=new fx(t,0),r=this.Jr.firstAfterOrEqual(n);return lh.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,lh.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class fS{constructor(e){this.ti=e,this.docs=new u_(oQ.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return lh.resolve(n?n.document.mutableCopy():hc.newInvalidDocument(t))}getEntries(e,t){let n=h2;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():hc.newInvalidDocument(e))}),lh.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=h2,s=t.path,a=new oQ(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=la(li(a),n)||(r.has(a.key)||hJ(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return lh.resolve(i)}getAllFromCollectionGroup(e,t,n,r){oI(9500)}ni(e,t){return lh.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new fT(this)}getSize(e){return lh.resolve(this.size)}}class fT extends fu{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)}),lh.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class fI{constructor(e){this.persistence=e,this.ri=new h1(e=>hR(e),hO),this.lastRemoteSnapshotVersion=o4.min(),this.highestTargetId=0,this.ii=0,this.si=new fb,this.targetCount=0,this.oi=d7._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),lh.resolve()}getLastRemoteSnapshotVersion(e){return lh.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return lh.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),lh.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),lh.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new d7(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,lh.resolve()}updateTargetData(e,t){return this.lr(t),lh.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,lh.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),lh.waitFor(i).next(()=>r)}getTargetCount(e){return lh.resolve(this.targetCount)}getTargetData(e,t){let n=this.ri.get(t)||null;return lh.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),lh.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),lh.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),lh.resolve()}getMatchingKeysForTargetId(e,t){let n=this.si.jr(t);return lh.resolve(n)}containsKey(e,t){return lh.resolve(this.si.containsKey(t))}}class f_{constructor(e,t){this._i={},this.overlays={},this.ai=new lI(0),this.ui=!1,this.ui=!0,this.ci=new fw,this.referenceDelegate=e(this),this.li=new fI(this),this.indexManager=new dY,this.remoteDocumentCache=new fS(e=>this.referenceDelegate.hi(e)),this.serializer=new dy(t),this.Pi=new fy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new fE(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){ox("MemoryPersistence","Starting transaction:",e);let r=new fC(this.ai.next());return this.referenceDelegate.Ti(),n(r).next(e=>this.referenceDelegate.Ii(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return lh.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class fC extends ll{constructor(e){super(),this.currentSequenceNumber=e}}class fA{constructor(e){this.persistence=e,this.Ri=new fb,this.Ai=null}static Vi(e){return new fA(e)}get di(){if(this.Ai)return this.Ai;throw oI(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),lh.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),lh.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),lh.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return lh.forEach(this.di,n=>{let r=oQ.fromPath(n);return this.mi(e,r).next(e=>{e||t.removeEntry(r,o4.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return lh.or([()=>lh.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class fD{constructor(e,t){this.persistence=e,this.fi=new h1(e=>lD(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new fa(this,t)}static Vi(e,t){return new fD(e,t)}Ti(){}Ii(e){return lh.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return lh.forEach(this.fi,(n,r)=>this.wr(e,n,r).next(e=>e?lh.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ni(e,r=>this.wr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,o4.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),lh.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),lh.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),lh.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),lh.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(u1(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=u$(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return uF(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,uT(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw oI(13486,{value:t})}}(e.data.value)),t}wr(e,t,n){return lh.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return lh.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fk{constructor(e){this.serializer=e}k(e,t,n,r){let i=new ld("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(lM),e.createObjectStore(lR,{keyPath:"userId"}),e.createObjectStore(lO,{keyPath:lL,autoIncrement:!0}).createIndex(lV,lF,{unique:!0}),e.createObjectStore(lj),fP(e),e.createObjectStore(lP));let s=lh.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(lJ),e.deleteObjectStore(lQ),e.deleteObjectStore(l3),fP(e)),s=s.next(()=>{let e,t;return e=i.store(l3),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:o4.min().toTimestamp(),targetCount:0},e.put(l2,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(lO).H().next(t=>{e.deleteObjectStore(lO),e.createObjectStore(lO,{keyPath:lL,autoIncrement:!0}).createIndex(lV,lF,{unique:!0});let n=i.store(lO),r=t.map(e=>n.put(e));return lh.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(l4,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.gi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(lH),this.pi(i)))),n<7&&r>=7&&(s=s.next(()=>this.yi(i))),n<8&&r>=8&&(s=s.next(()=>this.wi(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(l8,{keyPath:"bundleId"}),e.createObjectStore(l9,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(uu,{keyPath:uh})).createIndex(uc,ud,{unique:!1}),t.createIndex(uf,up,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(lU,{keyPath:lq})).createIndex(lz,l$),t.createIndex(lG,lK)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(lP))),n<14&&r>=14&&(s=s.next(()=>this.Di(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(l7,{keyPath:"indexId",autoIncrement:!0}).createIndex(ue,"collectionGroup",{unique:!1}),e.createObjectStore(ut,{keyPath:un}).createIndex(ur,ui,{unique:!1}),e.createObjectStore(us,{keyPath:ua}).createIndex(uo,ul,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(ut).clear()}).next(()=>{t.objectStore(us).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(um,{keyPath:"name"})})),n<18&&r>=18&&as()&&(s=s.next(()=>{t.objectStore(ut).clear()}).next(()=>{t.objectStore(us).clear()})),s}pi(e){let t=0;return e.store(lP).ee((e,n)=>{t+=d6(n)}).next(()=>{let n={byteSize:t};return e.store(lH).put(lW,n)})}gi(e){let t=e.store(lR),n=e.store(lO);return t.H().next(t=>lh.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.H(lV,r).next(n=>lh.forEach(n,n=>{oC(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=dE(this.serializer,n);return d5(e,t.userId,r).next(()=>{})}))}))}yi(e){let t=e.store(lJ),n=e.store(lP);return e.store(l3).get(l2).next(e=>{let r=[];return n.ee((n,i)=>{let s=new oK(n),a=[0,lD(s)];r.push(t.get(a).next(n=>n?lh.resolve():t.put({targetId:0,path:lD(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>lh.waitFor(r))})}wi(e,t){e.createObjectStore(l5,{keyPath:l6});let n=t.store(l5),r=new dX,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:lD(r)})}};return t.store(lP).ee({Y:!0},(e,t)=>i(new oK(e).popLast())).next(()=>t.store(lj).ee({Y:!0},([e,t,n],r)=>i(lk(t).popLast())))}bi(e){let t=e.store(lQ);return t.ee((e,n)=>{let r=dS(n),i=dT(this.serializer,r);return t.put(i)})}Si(e,t){let n=t.store(lP),r=[];return n.ee((e,n)=>{let i=t.store(lU),s=(n.document?new oQ(oK.fromString(n.document.name).popFirst(5)):n.noDocument?oQ.fromSegments(n.noDocument.path):n.unknownDocument?oQ.fromSegments(n.unknownDocument.path):oI(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>lh.waitFor(r))}Di(e,t){let n=t.store(lO),r=new fh(this.serializer),i=new f_(fA.Vi,this.serializer.yt);return n.H().next(e=>{let n=new Map;return e.forEach(e=>{let t=n.get(e.userId)??h7();dE(this.serializer,e).keys().forEach(e=>t=t.add(e)),n.set(e.userId,t)}),lh.forEach(n,(e,n)=>{let s=new oy(n),a=dk.wt(this.serializer,s),o=i.getIndexManager(s);return new fg(r,d4.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new ux(t,lI.ce),e).next()})})}}function fP(e){e.createObjectStore(lJ,{keyPath:lZ}).createIndex(l0,l1,{unique:!0}),e.createObjectStore(lQ,{keyPath:"targetId"}).createIndex(lY,lX,{unique:!0}),e.createObjectStore(l3)}let fM="IndexedDbPersistence",fN="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class fR{constructor(e,t,n,r,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!fR.v())throw new oD(oA.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fo(this,r),this.Ki=t+"main",this.serializer=new dy(o),this.qi=new lf(this.Ki,this.xi,new fk(this.serializer)),this.ci=new dP,this.li=new fe(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new fh(this.serializer),this.Pi=new dD,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&oE(fM,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new oD(oA.FAILED_PRECONDITION,fN);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new lI(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>uE(e,l4).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(ly(e))return ox(fM,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ox(fM,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return uE(e,lM).get(lN).next(e=>lh.resolve(this.Xi(e)))}Yi(e){return uE(e,l4).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=uE(e,l4);return t.H().next(e=>{let n=this.ns(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return lh.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?lh.resolve(!0):uE(e,lM).get(lN).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new oD(oA.FAILED_PRECONDITION,fN);return!1}}return!(!this.networkEnabled||!this.inForeground)||uE(e,l4).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ox(fM,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[lM,l4],e=>{let t=new ux(e,lI.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>uE(e,l4).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return d4.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new d0(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return dk.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,n){var r;let i;ox(fM,"Starting transaction:",e);let s=18===(r=this.xi)||17===r?ub:16===r||15===r?uw:14===r||13===r?uv:12===r?uy:11===r?ug:void oI(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new ux(r,this.ai?this.ai.next():lI.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw oE(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new oD(oA.FAILED_PRECONDITION,lo);return n(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return uE(e,lM).get(lN).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new oD(oA.FAILED_PRECONDITION,fN)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return uE(e,lM).put(lN,t)}static v(){return lf.v()}Ji(e){let t=uE(e,lM);return t.get(lN).next(e=>this.Xi(e)?(ox(fM,"Releasing primary lease."),t.delete(lN)):lh.resolve())}ts(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(oE(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;ai()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return ox(fM,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return oE(fM,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){oE("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function fO(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class fL{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=h7(),r=h7();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new fL(e,t.fromCache,n,r)}}class fV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fF{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=ai()?8:lp(at())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new fV;return this.ys(e,t,n).next(r=>{if(i.result=r,this.As)return this.ws(e,t,n,r.size)})}).next(()=>i.result)}ws(e,t,n,r){return n.documentReadCount<this.Vs?(ob()<=u.DEBUG&&ox("QueryEngine","SDK will not create cache indexes for query:",hX(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),lh.resolve()):(ob()<=u.DEBUG&&ox("QueryEngine","Query:",hX(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(ob()<=u.DEBUG&&ox("QueryEngine","The SDK decides to create cache indexes for query:",hX(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hG(t))):lh.resolve())}gs(e,t){if(hq(t))return lh.resolve(null);let n=hG(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=hG(t=hW(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=h7(...r);return this.fs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.bs(t,r);return this.Ss(t,s,i,n.readTime)?this.gs(e,hW(t,null,"F")):this.Ds(e,s,t,n)}))})))}ps(e,t,n,r){return hq(t)||r.isEqual(o4.min())?lh.resolve(null):this.fs.getDocuments(e,n).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,n,r)?lh.resolve(null):(ob()<=u.DEBUG&&ox("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),hX(t)),this.Ds(e,s,t,lr(r,-1)).next(e=>e))})}bs(e,t){let n=new uD(h0(e));return t.forEach((t,r)=>{hJ(e,r)&&(n=n.add(r))}),n}Ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ys(e,t,n){return ob()<=u.DEBUG&&ox("QueryEngine","Using full collection scan to execute query:",hX(t)),this.fs.getDocumentsMatchingQuery(e,t,ls.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fB="LocalStore";class fj{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new u_(oj),this.Fs=new h1(e=>hR(e),hO),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fg(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function fU(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Os(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=h7();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function fq(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function fz(e,t,n){let r=h7(),i=h7();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=h2;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(o4.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):ox(fB,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Bs:r,Ls:i}})}function f$(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.li.getTargetData(n,t).next(i=>i?(r=i,lh.resolve(r)):e.li.allocateTargetId(n).next(i=>(r=new dg(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.li.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.vs.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.vs=e.vs.insert(n.targetId,n),e.Fs.set(t,n.targetId)),n})}async function fG(e,t,n){let r=e.vs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!ly(e))throw e;ox(fB,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(r.target)}function fK(e,t,n){let r=o4.min(),i=h7();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=hG(t),void 0!==(o=e.Fs.get(a))?lh.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,n?r:o4.min(),n?i:h7())).next(n=>(fQ(e,hZ(t),n),{documents:n,ks:i}))})}function fH(e,t){let n=e.li,r=e.vs.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function fW(e,t){let n=e.Ms.get(t)||o4.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.xs.getAllFromCollectionGroup(r,t,lr(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(fQ(e,t,n),n))}function fQ(e,t,n){let r=e.Ms.get(t)||o4.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ms.set(t,r)}async function fY(e,t,n,r){let i=h7(),s=h2;for(let e of n){let n=t.Ks(e.metadata.name);e.document&&(i=i.add(n));let r=t.qs(e);r.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(n,r)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await f$(e,hG(hU(oK.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>fz(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Bs,n.Ls)).next(()=>n.Bs)))}async function fX(e,t,n=h7()){let r=await f$(e,hG(dI(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=c5(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=r.withResumeToken(uR.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.li.addMatchingKeys(i,n,r.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let fJ="firestore_clients";function fZ(e,t){return`${fJ}_${e}_${t}`}let f0="firestore_mutations";function f1(e,t,n){let r=`${f0}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let f2="firestore_targets";function f3(e,t){return`${f2}_${e}_${t}`}let f5="SharedClientState";class f6{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new oD(r.error.code,r.error.message)),s?new f6(e,t,r.state,i):(oE(f5,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class f4{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new oD(n.error.code,n.error.message)),i?new f4(e,n.state,r):(oE(f5,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class f8{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ce;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=lA(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new f8(e,i):(oE(f5,`Failed to parse client data for instance '${e}': ${t}`),null)}}class f9{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new f9(t.clientId,t.onlineState):(oE(f5,`Failed to parse online state: ${e}`),null)}}class f7{constructor(){this.activeTargetIds=ce}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class pe{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=n,this.zs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new u_(oj),this.started=!1,this.Zs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=fZ(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new f7),this.eo=RegExp(`^${fJ}_${l}_([^_]*)$`),this.no=RegExp(`^${f0}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${f2}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(fZ(this.persistenceKey,e));if(t){let n=f8.$s(e,t);n&&(this.Js=this.Js.insert(n.clientId,n))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,n){this.co(e,t,n),this.lo(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(f3(this.persistenceKey,e));if(t){let r=f4.$s(e,t);r&&(n=r.state)}}return t&&this.ho.Qs(e),this.oo(),n}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(f3(this.persistenceKey,e))}updateQueryState(e,t,n){this.Po(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.lo(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return ox(f5,"READ",e,t),t}setItem(e,t){ox(f5,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ox(f5,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(ox(f5,"EVENT",e.key,e.newValue),e.key===this.Xs)return void oE("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=lI.ce;if(null!=e)try{let n=JSON.parse(e);oC("number"==typeof n,30636,{yo:e}),t=n}catch(e){oE(f5,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==lI.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,n){let r=new f6(this.currentUser,e,t,n),i=f1(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}lo(e){let t=f1(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,n){let r=f3(this.persistenceKey,e),i=new f4(e,t,n);this.setItem(r,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let n=this.Eo(e);return f8.$s(n,t)}Vo(e,t){let n=this.no.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return f6.$s(new oy(i),r,t)}fo(e,t){let n=Number(this.ro.exec(e)[1]);return f4.$s(n,t)}_o(e){return f9.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);ox(f5,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let n=t?this.Js.insert(e,t):this.Js.remove(e),r=this.uo(this.Js),i=this.uo(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=n})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=ce;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class pt{constructor(){this.vo=new f7,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new f7,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pn{Mo(e){}shutdown(){}}let pr="ConnectivityMonitor";class pi{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(ox(pr,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(ox(pr,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ps=null;function pa(){return null===ps?ps=0x10000000+Math.round(0x80000000*Math.random()):ps++,"0x"+ps.toString(16)}let po="RestConnection",pl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class pu{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.$o=this.databaseId.database===uH?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let s=pa(),a=this.Qo(e,t.toUriEncodedString());ox(po,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,r,i);let{host:l}=new URL(a),u=s8(l);return this.zo(e,a,o,n,u).then(t=>(ox(po,`Received RPC '${e}' ${s}: `,t),t),t=>{throw oS(po,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ov,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){let n=pl[e],r=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class ph{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let pc="WebChannelConnection",pd=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class pf extends pu{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){pf.c_||(pd(v(),y.STAT_EVENT,e=>{e.stat===g.PROXY?ox(pc,"STAT_EVENT: detected buffering proxy"):e.stat===g.NOPROXY&&ox(pc,"STAT_EVENT: detected no buffering proxy")}),pf.c_=!0)}zo(e,t,n,r,i){let s=pa();return new Promise((i,a)=>{let o=new d;o.setWithCredentials(!0),o.listenOnce(p.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case m.NO_ERROR:let t=o.getResponseJson();ox(pc,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case m.TIMEOUT:ox(pc,`RPC '${e}' ${s} timed out`),a(new oD(oA.DEADLINE_EXCEEDED,"Request time out"));break;case m.HTTP_ERROR:let n=o.getStatus();if(ox(pc,`RPC '${e}' ${s} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(oA).indexOf(e)>=0?e:oA.UNKNOWN);a(new oD(n,t.message))}else a(new oD(oA.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new oD(oA.UNAVAILABLE,"Connection failed."));break;default:oI(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{ox(pc,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);ox(pc,`RPC '${e}' ${s} sending request:`,r),o.send(t,"POST",l,n,15)})}T_(e,t,n){let r=pa(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let l=i.join("");ox(pc,`Creating RPC '${e}' stream ${r}: ${l}`,a);let u=s.createWebChannel(l,a);this.I_(u);let h=!1,c=!1,d=new ph({Ho:t=>{c?ox(pc,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(ox(pc,`Opening RPC '${e}' stream ${r} transport.`),u.open(),h=!0),ox(pc,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Jo:()=>u.close()});return pd(u,f.EventType.OPEN,()=>{c||(ox(pc,`RPC '${e}' stream ${r} transport opened.`),d.i_())}),pd(u,f.EventType.CLOSE,()=>{c||(c=!0,ox(pc,`RPC '${e}' stream ${r} transport closed`),d.o_(),this.E_(u))}),pd(u,f.EventType.ERROR,t=>{c||(c=!0,oS(pc,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),d.o_(new oD(oA.UNAVAILABLE,"The operation could not be completed")))}),pd(u,f.EventType.MESSAGE,t=>{if(!c){let n=t.data[0];oC(!!n,16349);let i=n?.error||n[0]?.error;if(i){ox(pc,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=b[e];if(void 0!==t)return cR(t)}(t),s=i.message;void 0===n&&(n=oA.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),c=!0,d.o_(new oD(n,s)),u.close()}else ox(pc,`RPC '${e}' stream ${r} received:`,n),d.__(n)}}),pf.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return w()}}function pp(){return"u">typeof window?window:null}function pm(){return"u">typeof document?document:null}function pg(e){return new c0(e,!0)}pf.c_=!1;class py{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&ox("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let pv="PersistentStream";class pw{constructor(e,t,n,r,i,s,a,o){this.Ci=e,this.b_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new py(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===oA.RESOURCE_EXHAUSTED?(oE(t.toString()),oE("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===oA.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new oD(oA.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ox(pv,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(ox(pv,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pb extends pw{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:oI(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(oC(void 0===i||"string"==typeof i,58123),uR.fromBase64String(i||"")):(oC(void 0===i||i instanceof od.Buffer||i instanceof Uint8Array,16193),uR.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new cK(s,a,o,l&&new oD(void 0===l.code?oA.UNKNOWN:cR(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=c7(e,r.document.name),s=c5(r.document.updateTime),a=r.document.createTime?c5(r.document.createTime):o4.min(),o=new hh({mapValue:{fields:r.document.fields}}),l=hc.newFoundDocument(i,s,a,o);n=new c$(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=c7(e,r.document),s=r.readTime?c5(r.readTime):o4.min(),a=hc.newNoDocument(i,s);n=new c$([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=c7(e,r.document);n=new c$([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return oI(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new cM(r,i);n=new cG(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return o4.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?o4.min():t.readTime?c5(t.readTime):o4.min()}(e);return this.listener.J_(t,n)}Z_(e){let t,n={};n.database=dn(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=hL(r)?{documents:du(e,r)}:{query:dh(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=c3(e,t.resumeToken);let r=c1(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(o4.min())>0){n.readTime=c2(e,t.snapshotVersion.toTimestamp());let r=c1(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return oI(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.K_(n)}X_(e){let t={};t.database=dn(this.serializer),t.removeTarget=e,this.K_(t)}}class px extends pw{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return oC(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,oC(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;oC(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(oC(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?c5(e.updateTime):c5(n)).isEqual(o4.min())&&(t=c5(n)),new cp(t,e.transformResults||[])})):[]),i=c5(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=dn(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>da(this.serializer,e))};this.K_(t)}}class pE{}class pS extends pE{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new oD(oA.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,c4(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===oA.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new oD(oA.UNKNOWN,e.toString())})}jo(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,c4(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===oA.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new oD(oA.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class pT{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(oE(t),this.aa=!1):ox("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let pI="RemoteStore";class p_{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{pO(this)&&(ox(pI,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await pA(e),e.Va.set("Unknown"),e.Ea.delete(4),await pC(e)}(this))})}),this.Va=new pT(n,r)}}async function pC(e){if(pO(e))for(let t of e.Ra)await t(!0)}async function pA(e){for(let t of e.Ra)await t(!1)}function pD(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),pR(e)?pN(e):pX(e).O_()&&pP(e,t))}function pk(e,t){let n=pX(e);e.Ia.delete(t),n.O_()&&pM(e,t),0===e.Ia.size&&(n.O_()?n.L_():pO(e)&&e.Va.set("Unknown"))}function pP(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(o4.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}pX(e).Z_(t)}function pM(e,t){e.da.$e(t),pX(e).X_(t)}function pN(e){e.da=new cW({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),pX(e).start(),e.Va.ua()}function pR(e){return pO(e)&&!pX(e).x_()&&e.Ia.size>0}function pO(e){return 0===e.Ea.size}async function pL(e){e.Va.set("Online")}async function pV(e){e.Ia.forEach((t,n)=>{pP(e,t)})}async function pF(e,t){e.da=void 0,pR(e)?(e.Va.ha(t),pN(e)):e.Va.set("Unknown")}async function pB(e,t,n){if(e.Va.set("Online"),t instanceof cK&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){ox(pI,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await pj(e,n)}else if(t instanceof c$?e.da.Xe(t):t instanceof cG?e.da.st(t):e.da.tt(t),!n.isEqual(o4.min()))try{let t,r=await fq(e.localStore);n.compareTo(r)>=0&&await ((t=e.da.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(uR.EMPTY_BYTE_STRING,r.snapshotVersion)),pM(e,t);let i=new dg(r.target,t,n,r.sequenceNumber);pP(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ox(pI,"Failed to raise snapshot:",t),await pj(e,t)}}async function pj(e,t,n){if(!ly(t))throw t;e.Ea.add(1),await pA(e),e.Va.set("Offline"),n||(n=()=>fq(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ox(pI,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await pC(e)})}function pU(e,t){return t().catch(n=>pj(e,n,t))}async function pq(e){var t;let n=pJ(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;pO(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=pJ(e);n.O_()&&n.Y_&&n.ea(t.mutations)}(e,t)}catch(t){await pj(e,t)}pz(e)&&p$(e)}function pz(e){return pO(e)&&!pJ(e).x_()&&e.Ta.length>0}function p$(e){pJ(e).start()}async function pG(e){pJ(e).ra()}async function pK(e){let t=pJ(e);for(let n of e.Ta)t.ea(n.mutations)}async function pH(e,t,n){let r=e.Ta.shift(),i=cD.from(r,t,n);await pU(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await pq(e)}async function pW(e,t){t&&pJ(e).Y_&&await async function(e,t){var n;if(cN(n=t.code)&&n!==oA.ABORTED){let n=e.Ta.shift();pJ(e).B_(),await pU(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await pq(e)}}(e,t),pz(e)&&p$(e)}async function pQ(e,t){e.asyncQueue.verifyOperationInProgress(),ox(pI,"RemoteStore received new credentials");let n=pO(e);e.Ea.add(3),await pA(e),n&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await pC(e)}async function pY(e,t){t?(e.Ea.delete(2),await pC(e)):t||(e.Ea.add(2),await pA(e),e.Va.set("Unknown"))}function pX(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Zo:pL.bind(null,e),Yo:pV.bind(null,e),t_:pF.bind(null,e),J_:pB.bind(null,e)},t.sa(),e.ma=new pb(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.ma.B_(),pR(e)?pN(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function pJ(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Zo:()=>Promise.resolve(),Yo:pG.bind(null,e),t_:pW.bind(null,e),ta:pK.bind(null,e),na:pH.bind(null,e)},t.sa(),e.fa=new px(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.fa.B_(),await pq(e)):(await e.fa.stop(),e.Ta.length>0&&(ox(pI,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class pZ{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ok,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new pZ(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new oD(oA.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function p0(e,t){if(oE("AsyncQueue",`${t}: ${e}`),ly(e))return new oD(oA.UNAVAILABLE,`${t}: ${e}`);throw e}class p1{static emptySet(e){return new p1(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||oQ.comparator(t.key,n.key):(e,t)=>oQ.comparator(e.key,t.key),this.keyedMap=h5(),this.sortedSet=new u_(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof p1)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new p1;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class p2{constructor(){this.ga=new u_(oQ.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):oI(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class p3{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new p3(e,t,p1.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hQ(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class p5{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class p6{constructor(){this.queries=p4(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new oD(oA.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=p4(),t.forEach((t,n)=>{for(let t of n.ba)t.onError(e)})}}function p4(){return new h1(e=>hY(e),hQ)}async function p8(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.Sa()&&t.Da()&&(n=2):(i=new p5,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=p0(n,`Initialization of query '${hX(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&mt(e)}async function p9(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?r=+!t.Da():!i.Sa()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function p7(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(r)&&(n=!0);i.wa=r}}n&&mt(e)}function me(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ba)e.onError(n);e.queries.delete(t)}function mt(e){e.Ca.forEach(e=>{e.next()})}(S=E||(E={})).Ma="default",S.Cache="cache";class mn{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new p3(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=p3.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==E.Cache}}class mr{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class mi{constructor(e){this.serializer=e}Ks(e){return c7(this.serializer,e)}qs(e){return e.metadata.exists?ds(this.serializer,e.document,!1):hc.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return c5(e)}}class ms{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=ma(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let n=oK.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,n=new mi(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ks(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||h7()).add(e);t.set(n,r)}}return t}async ja(e){let t=await fY(e,new mi(this.serializer),this.Qa,this.$a.id),n=this.za(this.documents);for(let t of this.Wa)await fX(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function ma(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class mo{constructor(e){this.key=e}}class ml{constructor(e){this.key=e}}class mu{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=h7(),this.mutatedKeys=h7(),this.eu=h0(e),this.tu=new p1(this.eu)}get nu(){return this.Za}ru(e,t){let n=t?t.iu:new p2,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=hJ(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return oI(20277,{Vt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let a=t&&!r?this._u():[],o=0===this.Ya.size&&this.current&&!r?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new p3(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new p2,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=h7(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new ml(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new mo(n))}),t}cu(e){this.Za=e.ks,this.Ya=h7();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return p3.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let mh="SyncEngine";class mc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class md{constructor(e){this.key=e,this.hu=!1}}class mf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new h1(e=>hY(e),hQ),this.Iu=new Map,this.Eu=new Set,this.Ru=new u_(oQ.comparator),this.Au=new Map,this.Vu=new fb,this.du={},this.mu=new Map,this.fu=d7.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function mp(e,t,n=!0){let r,i=m$(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await mg(i,t,n,!0),r}async function mm(e,t){let n=m$(e);await mg(n,t,!0,!1)}async function mg(e,t,n,r){let i,s=await f$(e.localStore,hG(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await my(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&pD(e.remoteStore,s),i}async function my(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Ss&&(i=await fK(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return mk(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await fK(e.localStore,t,!0),a=new mu(t,s.ks),o=a.ru(s.documents),l=cz.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);mk(e,n,u.au);let h=new mc(t,n,a);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function mv(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!hQ(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await fG(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&pk(e.remoteStore,r.targetId),mA(e,r.targetId)}).catch(lu)):(mA(e,r.targetId),await fG(e.localStore,r.targetId,!0))}async function mw(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),pk(e.remoteStore,n.targetId))}async function mb(e,t,n){let r=mG(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=o6.now(),l=t.reduce((e,t)=>e.add(t.key),h7()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=h2,s=h7();return i.xs.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=ci(r.transform,e||null);null!=i&&(null===n&&(n=hh.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new cE(n.key,t,function e(t){let n=[];return uT(t.fields,(t,r)=>{let i=new oW([t]);if(hr(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new uM(n)}(t.value.mapValue),cm.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:h6(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.du[r.currentUser.toKey()])||(u=new u_(oj)),u=u.insert(s,n),r.du[r.currentUser.toKey()]=u,await mM(r,h.changes),await pq(r.remoteStore)}catch(t){let e=p0(t,"Failed to persist write");n.reject(e)}}async function mx(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.vs,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(uR.EMPTY_BYTE_STRING,o4.min()).withLastLimboFreeSnapshotVersion(o4.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.li.updateTargetData(e,h))});let o=h2,l=h7();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(fz(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!r.isEqual(o4.min())){let t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return lh.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.vs=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(oC(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?oC(r.hu,14607):t.removedDocuments.size>0&&(oC(r.hu,42227),r.hu=!1))}),await mM(e,s,t)}catch(e){await lu(e)}}function mE(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ba)e.va(t)&&(n=!0)}),n&&mt(r),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function mS(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new u_(oQ.comparator);n=n.insert(i,hc.newNoDocument(i,o4.min()));let r=h7().add(i),s=new cq(o4.min(),new Map,new u_(oj),n,r);await mx(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),mP(e)}else await fG(e.localStore,t,!1).then(()=>mA(e,t,n)).catch(lu)}async function mT(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.xs.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=lh.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);oC(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=h7();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));mC(e,r,null),m_(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await mM(e,i)}catch(e){await lu(e)}}async function mI(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(oC(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));mC(e,t,n),m_(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await mM(e,i)}catch(e){await lu(e)}}function m_(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function mC(e,t,n){let r=e.du[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.du[e.currentUser.toKey()]=r}}function mA(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||mD(e,t)})}function mD(e,t){e.Eu.delete(t.path.canonicalString());let n=e.Ru.get(t);null!==n&&(pk(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),mP(e))}function mk(e,t,n){for(let r of n)r instanceof mo?(e.Vu.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(ox(mh,"New document in limbo: "+n),e.Eu.add(r),mP(e))}(e,r)):r instanceof ml?(ox(mh,"Document no longer in limbo: "+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||mD(e,r.key)):oI(19791,{wu:r})}function mP(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new oQ(oK.fromString(t)),r=e.fu.next();e.Au.set(r,new md(n)),e.Ru=e.Ru.insert(n,r),pD(e.remoteStore,new dg(hG(hU(n.path)),r,"TargetPurposeLimboResolution",lI.ce))}}async function mM(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=fL.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>lh.forEach(t,t=>lh.forEach(t.Ts,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>lh.forEach(t.Is,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!ly(e))throw e;ox(fB,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.vs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function mN(e,t){if(!e.currentUser.isEqual(t)){ox(mh,"User change. New user:",t.toKey());let n=await fU(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new oD(oA.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await mM(e,n.Ns)}}function mR(e,t){let n=e.Au.get(t);if(n&&n.hu)return h7().add(n.key);{let n=h7(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}async function mO(e,t){let n=await fK(e.localStore,t.query,!0),r=t.view.cu(n);return e.isPrimaryClient&&mk(e,t.targetId,r.au),r}async function mL(e,t){return fW(e.localStore,t).then(t=>mM(e,t))}async function mV(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):lh.resolve(null))));null!==o?("pending"===n?await pq(e.remoteStore):"acknowledged"===n||"rejected"===n?(mC(e,t,r||null),m_(e,t),s=e.localStore,s.mutationQueue.nr(t)):oI(6720,"Unknown batchState",{bu:n}),await mM(e,o)):ox(mh,"Cannot apply mutation batch with id: "+t)}async function mF(e,t){if(m$(e),mG(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await mB(e,t.toArray());for(let t of(e.gu=!0,await pY(e.remoteStore,!0),n))pD(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],n=Promise.resolve();e.Iu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(mA(e,i),fG(e.localStore,i,!0))),pk(e.remoteStore,i)}),await n,await mB(e,t),e.Au.forEach((t,n)=>{pk(e.remoteStore,n)}),e.Vu.zr(),e.Au=new Map,e.Ru=new u_(oQ.comparator),e.gu=!1,await pY(e.remoteStore,!1)}}async function mB(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Iu.get(n);if(s&&0!==s.length)for(let n of(t=await f$(e.localStore,hG(s[0])),s)){let t=e.Tu.get(n),r=await mO(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await fH(e.localStore,n);t=await f$(e.localStore,r),await my(e,mj(r),n,!1,t.resumeToken)}r.push(t)}return e.Pu.J_(i),r}function mj(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new hj(t,n,r,i,s,"F",e.startAt,e.endAt)}function mU(e){return e.localStore.persistence.hs()}async function mq(e,t,n,r){if(e.gu)return void ox(mh,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await fW(e.localStore,hZ(i[0])),s=cq.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,uR.EMPTY_BYTE_STRING);await mM(e,r,s);break}case"rejected":await fG(e.localStore,t,!0),mA(e,t,r);break;default:oI(64155,n)}}async function mz(e,t,n){let r=m$(e);if(r.gu){for(let e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){ox(mh,"Adding an already active target "+e);continue}let t=await fH(r.localStore,e),n=await f$(r.localStore,t);await my(r,mj(t),n.targetId,!1,n.resumeToken),pD(r.remoteStore,n)}for(let e of n)r.Iu.has(e)&&await fG(r.localStore,e,!1).then(()=>{pk(r.remoteStore,e),mA(r,e)}).catch(lu)}}function m$(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=mx.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=mR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=mS.bind(null,e),e.Pu.J_=p7.bind(null,e.eventManager),e.Pu.yu=me.bind(null,e.eventManager),e}function mG(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=mT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mI.bind(null,e),e}class mK{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pg(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new fF,new fj(t,n,e.initialUser,this.serializer)}Cu(e){return new f_(fA.Vi,this.serializer)}Du(e){return new pt}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mK.provider={build:()=>new mK};class mH extends mK{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return oC(this.persistence.referenceDelegate instanceof fD,46915),new fs(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?d3.withCacheSize(this.cacheSizeBytes):d3.DEFAULT;return new f_(e=>fD.Vi(e,t),this.serializer)}}class mW extends mK{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await mG(this.xu.syncEngine),await pq(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new fF,new fj(t,n,e.initialUser,this.serializer)}Fu(e,t){return new fs(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let n=new lT(t,this.persistence);return new lS(e.asyncQueue,n)}Cu(e){let t=fO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?d3.withCacheSize(this.cacheSizeBytes):d3.DEFAULT;return new fR(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,pp(),pm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new pt}}class mQ extends mW{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof pe&&(this.sharedClientState.syncEngine={So:mV.bind(null,t),Do:mq.bind(null,t),Co:mz.bind(null,t),hs:mU.bind(null,t),bo:mL.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await mF(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=pp();if(!pe.v(t))throw new oD(oA.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=fO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new pe(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class mY{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mE(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=mN.bind(null,this.syncEngine),await pY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new p6}createDatastore(e){var t;let n=pg(e.databaseInfo.databaseId),r=new pf(e.databaseInfo);return t=e.authCredentials,new pS(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new p_(t,n,e.asyncQueue,e=>mE(this.syncEngine,e,0),pi.v()?new pi:new pn)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new mf(n,r,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){ox(pI,"RemoteStore shutting down."),e.Ea.add(5),await pA(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function mX(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}mY.provider={build:()=>new mY};class mJ{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):oE("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class mZ{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new ok,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),n=Number(t);return isNaN(n)&&this.qu(`length string (${t}) is not valid number`),new mr(JSON.parse(await this.Uu(n)),e.length+n)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class m0{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.qa)}`);this.metadata=n;do null!==(n=this.Su())&&this.elements.push(n);while(null!==n)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new mr(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new oD(oA.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class m1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new oD(oA.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>c9(e.serializer,t))},r=await e.jo("BatchGetDocuments",e.serializer.databaseId,oK.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(oC(!!t.found,43571),t.found.name,t.found.updateTime,r=c7(n,t.found.name),s=c5(t.found.updateTime),a=t.found.createTime?c5(t.found.createTime):o4.min(),o=new hh({mapValue:{fields:t.found.fields}}),hc.newFoundDocument(r,s,a,o)):"missing"in t?(oC(!!t.missing,3894),oC(!!t.readTime,22933),l=c7(n,t.missing),u=c5(t.readTime),hc.newNoDocument(l,u)):oI(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());oC(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new c_(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=oQ.fromPath(t);this.mutations.push(new cC(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>da(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,oK.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw oI(50498,{Gu:e.constructor.name});t=o4.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new oD(oA.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(o4.min())?cm.exists(!1):cm.updateTime(t):cm.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(o4.min()))throw new oD(oA.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cm.updateTime(t)}return cm.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class m2{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new py(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new m1(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!l_(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!cN(t)}return!1}}let m3="FirestoreClient";class m5{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=oy.UNAUTHENTICATED,this.clientId=oB.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{ox(m3,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ox(m3,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ok;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=p0(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function m6(e,t){e.asyncQueue.verifyOperationInProgress(),ox(m3,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await fU(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function m4(e,t){e.asyncQueue.verifyOperationInProgress();let n=await m8(e);ox(m3,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>pQ(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>pQ(t.remoteStore,n)),e._onlineComponents=t}async function m8(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ox(m3,"Using user provided OfflineComponentProvider");try{await m6(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===oA.FAILED_PRECONDITION||t.code===oA.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;oS("Error using user provided cache. Falling back to memory cache: "+t),await m6(e,new mK)}}else ox(m3,"Using default OfflineComponentProvider"),await m6(e,new mH(void 0));return e._offlineComponents}async function m9(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ox(m3,"Using user provided OnlineComponentProvider"),await m4(e,e._uninitializedComponentsProvider._online)):(ox(m3,"Using default OnlineComponentProvider"),await m4(e,new mY))),e._onlineComponents}function m7(e){return m8(e).then(e=>e.localStore)}function ge(e){return m9(e).then(e=>e.syncEngine)}function gt(e){return m9(e).then(e=>e.datastore)}async function gn(e){let t=await m9(e),n=t.eventManager;return n.onListen=mp.bind(null,t.syncEngine),n.onUnlisten=mv.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=mm.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=mw.bind(null,t.syncEngine),n}function gr(e,t,n={}){let r=new ok;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await gn(e),s=e.asyncQueue,a=new mJ({next:e=>{a.Nu(),s.enqueueAndForget(()=>p9(i,o));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new oD(oA.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new oD(oA.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),p8(i,o=new mn(hU(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),r.promise}function gi(e,t,n={}){let r=new ok;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await gn(e),s=e.asyncQueue,o=new mn(t,a=new mJ({next:e=>{a.Nu(),s.enqueueAndForget(()=>p9(i,o)),e.fromCache&&"server"===n.source?r.reject(new oD(oA.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),p8(i,o)}),r.promise}function gs(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ga=new Map,go="firestore.googleapis.com";class gl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new oD(oA.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=go,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new oD(oA.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new oD(oA.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gs(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new oD(oA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new oD(oA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new oD(oA.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new oD(oA.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new oD(oA.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new oM;switch(e.type){case"firstParty":return new oL(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new oD(oA.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=ga.get(this))&&(ox("ComponentProvider","Removing Datastore"),ga.delete(this),e.terminate()),Promise.resolve()}}class gh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gh(this.firestore,e,this._query)}}class gc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gc(this.firestore,e,this._key)}toJSON(){return{type:gc._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(o5(t,gc._jsonSchema))return new gc(e,n||null,new oQ(oK.fromString(t.referencePath)))}}gc._jsonSchemaVersion="firestore/documentReference/1.0",gc._jsonSchema={type:o3("string",gc._jsonSchemaVersion),referencePath:o3("string")};class gd extends gh{constructor(e,t,n){super(e,t,hU(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new gc(this.firestore,null,new oQ(e))}withConverter(e){return new gd(this.firestore,e,this._path)}}function gf(e,t,...n){if(e=ad(e),oY("collection","path",t),e instanceof gu){let r=oK.fromString(t,...n);return oJ(r),new gd(e,null,r)}{if(!(e instanceof gc||e instanceof gd))throw new oD(oA.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(oK.fromString(t,...n));return oJ(r),new gd(e.firestore,null,r)}}function gp(e,t){return e=ad(e),t=ad(t),e instanceof gh&&t instanceof gh&&e.firestore===t.firestore&&hQ(e._query,t._query)&&e.converter===t.converter}let gm="AsyncQueue";class gg{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new py(this,"async_queue_retry"),this._c=()=>{let e=pm();e&&ox(gm,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=pm();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=pm();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new ok;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!ly(e))throw e;ox(gm,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,oE("INTERNAL UNHANDLED ERROR: ",gy(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=pZ.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&oI(47125,{Pc:gy(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function gy(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class gv{constructor(){this._progressObserver={},this._taskCompletionResolver=new ok,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class gw extends gu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new gg,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new gg(e),this._firestoreClient=void 0,await e}}}function gb(e){if(e._terminated)throw new oD(oA.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,n=e._app?.options.appId||"",r=e._persistenceKey,i=e._app?.options.apiKey,new uK(t,n,r,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,gs(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new m5(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function gx(e,t){let n=gb(e=o1(e,gw)),r=new gv;return function(e,t,n,r){var i;let s=(i=pg(t),new mZ(function(e,t){if(e instanceof Uint8Array)return mX(e,void 0);if(e instanceof ArrayBuffer)return mX(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?cL().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=c5(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(ma(a));let o=new ms(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&n._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await mM(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return oS(mh,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await ge(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}class gE{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gE(uR.fromBase64String(e))}catch(e){throw new oD(oA.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new gE(uR.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:gE._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(o5(e,gE._jsonSchema))return gE.fromBase64String(e.bytes)}}gE._jsonSchemaVersion="firestore/bytes/1.0",gE._jsonSchema={type:o3("string",gE._jsonSchemaVersion),bytes:o3("string")};class gS{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new oD(oA.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oW(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gT{constructor(e){this._methodName=e}}class gI{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new oD(oA.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new oD(oA.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return oj(this._lat,e._lat)||oj(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:gI._jsonSchemaVersion}}static fromJSON(e){if(o5(e,gI._jsonSchema))return new gI(e.latitude,e.longitude)}}gI._jsonSchemaVersion="firestore/geoPoint/1.0",gI._jsonSchema={type:o3("string",gI._jsonSchemaVersion),latitude:o3("number"),longitude:o3("number")};class g_{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:g_._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(o5(e,g_._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new g_(e.vectorValues);throw new oD(oA.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}g_._jsonSchemaVersion="firestore/vectorValue/1.0",g_._jsonSchema={type:o3("string",g_._jsonSchemaVersion),vectorValues:o3("object")};let gC=/^__.*__$/;class gA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new cE(e,this.data,this.fieldMask,t,this.fieldTransforms):new cx(e,this.data,t,this.fieldTransforms)}}class gD{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new cE(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gk(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw oI(40011,{dataSource:e})}}class gP{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new gP({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return gK(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(gk(this.dataSource)&&gC.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class gM{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pg(e)}createContext(e,t,n,r=!1){return new gP({dataSource:e,methodName:t,targetDoc:n,path:oW.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gN(e){let t=e._freezeSettings(),n=pg(e._databaseId);return new gM(e._databaseId,!!t.ignoreUndefinedProperties,n)}function gR(e,t,n,r,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);gq("Data must be an object, but it was:",l,r);let u=gj(r,l);if(s.merge)a=new uM(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=gz(t,r,n);if(!l.contains(i))throw new oD(oA.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);gH(e,i)||e.push(i)}a=new uM(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new gA(new hh(u),a,o)}class gO extends gT{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gO}}function gL(e,t,n,r){let i=e.createContext(1,t,n);gq("Data must be an object, but it was:",i,r);let s=[],a=hh.empty();return uT(r,(e,r)=>{let o=gG(t,e,n);r=ad(r);let l=i.childContextForFieldPath(o);if(r instanceof gO)s.push(o);else{let e=gB(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new gD(a,new uM(s),i.fieldTransforms)}function gV(e,t,n,r,i,s){let a=e.createContext(1,t,n),o=[gz(t,r,n)],l=[i];if(s.length%2!=0)throw new oD(oA.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(gz(t,s[e])),l.push(s[e+1]);let u=[],h=hh.empty();for(let e=o.length-1;e>=0;--e)if(!gH(u,o[e])){let t=o[e],n=l[e];n=ad(n);let r=a.childContextForFieldPath(t);if(n instanceof gO)u.push(t);else{let e=gB(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new gD(h,new uM(u),a.fieldTransforms)}function gF(e,t,n,r=!1){return gB(n,e.createContext(r?4:3,t))}function gB(e,t){if(gU(e=ad(e)))return gq("Unsupported field value:",t,e),gj(e,t);if(e instanceof gT)return function(e,t){if(!gk(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=gB(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=ad(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,lA(r=e)?cn(r):ct(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=o6.fromDate(e);return{timestampValue:c2(t.serializer,n)}}if(e instanceof o6){let n=new o6(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:c2(t.serializer,n)}}if(e instanceof gI)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof gE)return{bytesValue:c3(t.serializer,e._byteString)};if(e instanceof gc){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:c6(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof g_)return{mapValue:{fields:{[uQ]:{stringValue:uJ},[uZ]:{arrayValue:{values:((i=e)instanceof g_?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return ct(t.serializer,e)})}}}}};if(dm(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${o0(e)}`)}(e,t)}function gj(e,t){let n={};return uI(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):uT(e,(e,r)=>{let i=gB(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function gU(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof o6||e instanceof gI||e instanceof gE||e instanceof gc||e instanceof gT||e instanceof g_||dm(e))}function gq(e,t,n){if(!gU(n)||!oZ(n)){let r=o0(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function gz(e,t,n){if((t=ad(t))instanceof gS)return t._internalPath;if("string"==typeof t)return gG(e,t);throw gK("Field path arguments must be of type string or ",e,!1,void 0,n)}let g$=RegExp("[~\\*/\\[\\]]");function gG(e,t,n){if(t.search(g$)>=0)throw gK(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new gS(...t.split("."))._internalPath}catch(r){throw gK(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function gK(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new oD(oA.INVALID_ARGUMENT,o+e+l)}function gH(e,t){return e.some(e=>e.isEqual(t))}class gW{convertValue(e,t="none"){switch(u1(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uV(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(uF(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw oI(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return uT(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new g_(e.fields?.[uZ].arrayValue?.values?.map(e=>uV(e.doubleValue)))}convertGeoPoint(e){return new gI(uV(e.latitude),uV(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=u$(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(uG(e));default:return null}}convertTimestamp(e){let t=uL(e);return new o6(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=oK.fromString(e);oC(dp(n),9688,{name:e});let r=new uW(n.get(1),n.get(3)),i=new oQ(n.popFirst(5));return r.isEqual(t)||oE(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class gQ extends gW{constructor(e){super(),this.firestore=e}convertBytes(e){return new gE(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gc(this.firestore,null,t)}}let gY="@firebase/firestore",gX="4.10.0";function gJ(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class gZ{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class g0{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new hh({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class g1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new gc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new g2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(gz("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class g2 extends g1{data(){return super.data()}}function g3(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new oD(oA.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class g5{}class g6 extends g5{}function g4(e,t,...n){let r=[];for(let i of(t instanceof g5&&r.push(t),function(e){let t=e.filter(e=>e instanceof g7).length,n=e.filter(e=>e instanceof g8).length;if(t>1||t>0&&n>0)throw new oD(oA.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class g8 extends g6{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new g8(e,t,n)}_apply(e){let t=this._parse(e);return yg(e._query,t),new gh(e.firestore,e.converter,hH(e._query,t))}_parse(e){let t=gN(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new oD(oA.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ym(a,s);let t=[];for(let n of a)t.push(yp(r,e,n));o={arrayValue:{values:t}}}else o=yp(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ym(a,s),o=gF(n,t,a,"in"===s||"not-in"===s);return hy.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function g9(e,t,n){let r=gz("where",e);return g8._create(r,t,n)}class g7 extends g5{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new g7(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:hv.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())yg(n,e),n=hH(n,e)}(e._query,t),new gh(e.firestore,e.converter,hH(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function ye(...e){return e.forEach(e=>yy("or",e)),g7._create("or",e)}function yt(...e){return e.forEach(e=>yy("and",e)),g7._create("and",e)}class yn extends g6{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yn(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new oD(oA.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new oD(oA.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new hm(t,n)}(e._query,this._field,this._direction);return new gh(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new hj(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function yr(e,t="asc"){let n=gz("orderBy",e);return yn._create(n,t)}class yi extends g6{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new yi(e,t,n)}_apply(e){return new gh(e.firestore,e.converter,hW(e._query,this._limit,this._limitType))}}function ys(e){return o2("limit",e),yi._create("limit",e,"F")}function ya(e){return o2("limitToLast",e),yi._create("limitToLast",e,"L")}class yo extends g6{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new yo(e,t,n)}_apply(e){var t;let n=yf(e,this.type,this._docOrFields,this._inclusive);return new gh(e.firestore,e.converter,(t=e._query,new hj(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function yl(...e){return yo._create("startAt",e,!0)}function yu(...e){return yo._create("startAfter",e,!1)}class yh extends g6{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new yh(e,t,n)}_apply(e){var t;let n=yf(e,this.type,this._docOrFields,this._inclusive);return new gh(e.firestore,e.converter,(t=e._query,new hj(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function yc(...e){return yh._create("endBefore",e,!1)}function yd(...e){return yh._create("endAt",e,!0)}function yf(e,t,n,r){if(n[0]=ad(n[0]),n[0]instanceof g1)return function(e,t,n,r,i){if(!r)throw new oD(oA.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of h$(e))if(n.field.isKeyField())s.push(u9(t,r.key));else{let e=r.data.field(n.field);if(uz(e))throw new oD(oA.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new oD(oA.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new hd(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=gN(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new oD(oA.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new oD(oA.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!hz(e)&&-1!==l.indexOf("/"))throw new oD(oA.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(oK.fromString(l));if(!oQ.isDocumentKey(n))throw new oD(oA.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new oQ(n);o.push(u9(t,i))}else{let e=gF(n,r,l);o.push(e)}}return new hd(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function yp(e,t,n){if("string"==typeof(n=ad(n))){if(""===n)throw new oD(oA.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hz(t)&&-1!==n.indexOf("/"))throw new oD(oA.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(oK.fromString(n));if(!oQ.isDocumentKey(r))throw new oD(oA.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return u9(e,new oQ(r))}if(n instanceof gc)return u9(e,n._key);throw new oD(oA.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${o0(n)}.`)}function ym(e,t){if(!Array.isArray(e)||0===e.length)throw new oD(oA.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function yg(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new oD(oA.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new oD(oA.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function yy(e,t){if(!(t instanceof g8||t instanceof g7))throw new oD(oA.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function yv(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class yw extends gW{constructor(e){super(),this.firestore=e}convertBytes(e){return new gE(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gc(this.firestore,null,t)}}function yb(e){return new gZ("sum",gz("sum",e))}function yx(e){return new gZ("avg",gz("average",e))}function yE(){return new gZ("count")}function yS(e,t){return e instanceof gZ&&t instanceof gZ&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function yT(e,t){return gp(e.query,t.query)&&ah(e.data(),t.data())}function yI(e){return y_(e,{count:yE()})}function y_(e,t){var n;let r,i=o1(e.firestore,gw),s=gb(i),a=function(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}(t,(e,t)=>new cP(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new ok,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await gt(s);r.resolve(async function(e,t,n){let{request:r,gt:i,parent:s}=function(e,t,n,r){let{ft:i,parent:s}=dh(e,t),a={},o=[],l=0;return n.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:dd(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:dd(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=hK(t,t.explicitOrderBy)),t.Re),n);e.connection.Ko||delete r.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,r,1)).filter(e=>!!e.result);oC(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new g0(e,new gQ(i),t))}class yC{constructor(e){this.kind="memory",this._onlineComponentProvider=mY.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new mH(void 0)}}toJSON(){return{kind:this.kind}}}class yA{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=yV(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class yD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=mK.provider}toJSON(){return{kind:this.kind}}}class yk{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new mH(e)}}toJSON(){return{kind:this.kind}}}function yP(){return new yD}function yM(e){return new yk(e?.cacheSizeBytes)}function yN(e){return new yC(e)}function yR(e){return new yA(e)}class yO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=mY.provider,this._offlineComponentProvider={build:t=>new mW(t,e?.cacheSizeBytes,this.forceOwnership)}}}class yL{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=mY.provider,this._offlineComponentProvider={build:t=>new mQ(t,e?.cacheSizeBytes)}}}function yV(e){return new yO(e?.forceOwnership)}function yF(){return new yL}let yB="NOT SUPPORTED";class yj{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yU extends g1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new yz(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(gz("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new oD(oA.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=yU._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function yq(e,t,n){if(o5(t,yU._jsonSchema)){var r;if(t.bundle===yB)throw new oD(oA.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=pg(e._databaseId),s=(r=t.bundle,new m0(r,i)),a=s.t(),o=new ms(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new oD(oA.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=ds(i,l[0].document),h=new oQ(oK.fromString(t.bundleName));return new yU(e,new yw(e),h,u,new yj(!1,!1),n||null)}}yU._jsonSchemaVersion="firestore/documentSnapshot/1.0",yU._jsonSchema={type:o3("string",yU._jsonSchemaVersion),bundleSource:o3("string","DocumentSnapshot"),bundleName:o3("string"),bundle:o3("string")};class yz extends yU{data(e={}){return super.data(e)}}class y${constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new yj(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new yz(this._firestore,this._userDataWriter,n.key,n,new yj(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new oD(oA.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new yz(e._firestore,e._userDataWriter,n.doc.key,n.doc,new yj(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new yz(e._firestore,e._userDataWriter,t.doc.key,t.doc,new yj(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return oI(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new oD(oA.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=y$._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=oB.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function yG(e,t,n){if(o5(t,y$._jsonSchema)){var r;if(t.bundle===yB)throw new oD(oA.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=pg(e._databaseId),s=(r=t.bundle,new m0(r,i)),a=s.t(),o=new ms(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new oD(oA.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=dI(o.queries[0].bundledQuery),u=o.documents,h=new p1;u.map(e=>{let t=ds(i,e.document);h=h.add(t)});let c=p3.fromInitialDocuments(l,h,h7(),!1,!1),d=new gh(e,n||null,l);return new y$(e,new yw(e),d,c)}}function yK(e,t){return e instanceof yU&&t instanceof yU?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof y$&&t instanceof y$&&e._firestore===t._firestore&&gp(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}y$._jsonSchemaVersion="firestore/querySnapshot/1.0",y$._jsonSchema={type:o3("string",y$._jsonSchemaVersion),bundleSource:o3("string","QuerySnapshot"),bundleName:o3("string"),bundle:o3("string")};let yH={maxAttempts:5};class yW{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gN(e)}set(e,t,n){this._verifyNotCommitted();let r=yQ(e,this._firestore),i=yv(r.converter,t,n),s=gR(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,cm.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=yQ(e,this._firestore);return i="string"==typeof(t=ad(t))||t instanceof gS?gV(this._dataReader,"WriteBatch.update",s._key,t,n,r):gL(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,cm.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=yQ(e,this._firestore);return this._mutations=this._mutations.concat(new c_(t._key,cm.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new oD(oA.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yQ(e,t){if((e=ad(e)).firestore!==t)throw new oD(oA.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class yY{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gN(e)}get(e){let t=yQ(e,this._firestore),n=new yw(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return oI(24041);let r=e[0];if(r.isFoundDocument())return new g1(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new g1(this._firestore,n,t._key,null,t.converter);throw oI(18433,{doc:r})})}set(e,t,n){let r=yQ(e,this._firestore),i=yv(r.converter,t,n),s=gR(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=yQ(e,this._firestore);return i="string"==typeof(t=ad(t))||t instanceof gS?gV(this._dataReader,"Transaction.update",s._key,t,n,r):gL(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=yQ(e,this._firestore);return this._transaction.delete(t._key),this}}class yX extends yY{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=yQ(e,this._firestore),n=new gQ(this._firestore);return super.get(e).then(e=>new yU(this._firestore,n,t._key,e._document,new yj(!1,!1),t.converter))}}function yJ(e,t,n){var r,i;let s;e=o1(e,gw);let a={...yH,...n};if(a.maxAttempts<1)throw new oD(oA.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=gb(e),i=n=>t(new yX(e,n)),s=new ok,r.asyncQueue.enqueueAndForget(async()=>{let e=await gt(r);new m2(r.asyncQueue,e,a,i,s).ju()}),s.promise}function yZ(e){e=o1(e,gc);let t=o1(e.firestore,gw);return gr(gb(t),e._key).then(n=>vr(t,e,n))}function y0(e){var t;let n;e=o1(e,gc);let r=o1(e.firestore,gw),i=gb(r),s=new gQ(r);return(t=e._key,n=new ok,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new oD(oA.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=p0(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await m7(i),t,n)),n.promise).then(t=>new yU(r,s,e._key,t,new yj(null!==t&&t.hasLocalMutations,!0),e.converter))}function y1(e){e=o1(e,gc);let t=o1(e.firestore,gw);return gr(gb(t),e._key,{source:"server"}).then(n=>vr(t,e,n))}function y2(e){e=o1(e,gh);let t=o1(e.firestore,gw),n=gb(t),r=new gQ(t);return g3(e._query),gi(n,e._query).then(n=>new y$(t,r,e,n))}function y3(e){var t;let n;e=o1(e,gh);let r=o1(e.firestore,gw),i=gb(r),s=new gQ(r);return(t=e._query,n=new ok,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await fK(e,t,!0),i=new mu(t,r.ks),s=i.ru(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=p0(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await m7(i),t,n)),n.promise).then(t=>new y$(r,s,e,t))}function y5(e){e=o1(e,gh);let t=o1(e.firestore,gw),n=gb(t),r=new gQ(t);return gi(n,e._query,{source:"server"}).then(n=>new y$(t,r,e,n))}function y6(e,t,n){e=o1(e,gc);let r=o1(e.firestore,gw),i=yv(e.converter,t,n),s=gN(r);return vn(r,[gR(s,"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,cm.none())])}function y4(e,t,n,...r){e=o1(e,gc);let i=o1(e.firestore,gw),s=gN(i);return vn(i,[("string"==typeof(t=ad(t))||t instanceof gS?gV(s,"updateDoc",e._key,t,n,r):gL(s,"updateDoc",e._key,t)).toMutation(e._key,cm.exists(!0))])}function y8(e){return vn(o1(e.firestore,gw),[new c_(e._key,cm.none())])}function y9(e,t){let n=o1(e.firestore,gw),r=function(e,t,...n){if(e=ad(e),1==arguments.length&&(t=oB.newId()),oY("doc","path",t),e instanceof gu){let r=oK.fromString(t,...n);return oX(r),new gc(e,null,new oQ(r))}{if(!(e instanceof gc||e instanceof gd))throw new oD(oA.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(oK.fromString(t,...n));return oX(r),new gc(e.firestore,e instanceof gd?e.converter:null,new oQ(r))}}(e),i=yv(e.converter,t);return vn(n,[gR(gN(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,cm.exists(!1))]).then(()=>r)}function y7(e,...t){var n;let r,i,s,a,o;e=ad(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||gJ(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(gJ(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof gc)i=o1(e.firestore,gw),s=hU(e._key.path),r={next:n=>{t[u]&&t[u](vr(i,e,n))},error:t[u+1],complete:t[u+2]};else{let n=o1(e,gh);i=o1(n.firestore,gw),s=n._query;let a=new gQ(i);r={next:e=>{t[u]&&t[u](new y$(i,a,n,e))},error:t[u+1],complete:t[u+2]},g3(e._query)}return n=gb(i),o=new mn(s,a=new mJ(r),h),n.asyncQueue.enqueueAndForget(async()=>p8(await gn(n),o)),()=>{a.Nu(),n.asyncQueue.enqueueAndForget(async()=>p9(await gn(n),o))}}function ve(e,t,...n){var r,i,s,a,o,l;let u=ad(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error=`snapshotJson missing required field: ${n}`;break}let r=e[n];if("string"!=typeof r){t.error=`snapshotJson field '${n}' must be a string.`;break}if(0===r.length){t.error=`snapshotJson field '${n}' cannot be an empty string.`;break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(h.error)throw new oD(oA.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof n[0]||gJ(n[d])||(c=n[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof n[d]&&gJ(n[d])){let e=n[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:n[d++],error:n[d++],complete:n[d++]};return r=c,i=a,s=n[d],t=!1,gx(u,h.bundle).then(()=>{var e,t,n;return e=u,t=h.bundleName,(n=gb(e=o1(e,gw)),n.asyncQueue.enqueue(async()=>{var e;return e=await m7(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Pi.getNamedQuery(n,t))})).then(t=>t?new gh(e,null,t.query):null)}).then(n=>{n&&!t&&(s&&n.withConverter(s),e=y7(n,r||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,r=null;if("object"==typeof n[d]&&gJ(n[d])){let e=n[d++];r={next:e.next,error:e.error,complete:e.complete}}else r={next:n[d++],error:n[d++],complete:n[d++]};return a=c,o=r,l=n[d],t=!1,gx(u,h.bundle).then(()=>{t||(e=y7(new gc(u,l||null,oQ.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new oD(oA.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function vt(e,t){let n,r=gb(e=o1(e,gw));return n=new mJ(gJ(t)?t:{next:t}),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await gn(r),void(e.Ca.add(n),n.next())}),()=>{n.Nu(),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await gn(r),void e.Ca.delete(n)})}}function vn(e,t){var n;let r;return n=gb(e),r=new ok,n.asyncQueue.enqueueAndForget(async()=>mb(await ge(n),t,r)),r.promise}function vr(e,t,n){let r=n.docs.get(t._key),i=new gQ(e);return new yU(e,i,t._key,r,new yj(n.hasPendingWrites,n.fromCache),t.converter)}function vi(e){return gb(e=o1(e,gw)),new yW(e,t=>vn(e,t))}function vs(e,t){let n=gb(e=o1(e,gw));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return oS("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new oD(oA.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=va(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=gG("setIndexConfiguration",va(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new lt(e,2)):"ASCENDING"===t.order?r.push(new lt(e,0)):"DESCENDING"===t.order&&r.push(new lt(e,1))}n.push(new o8(o8.UNKNOWN_ID,t,r,ln.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,le,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>lh.waitFor(r)))})(await m7(n),r))}function va(e,t){if("string"!=typeof e[t])throw new oD(oA.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class vo{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function vl(e){e=o1(e,gw);let t=vf.get(e);if(t)return t;let n=gb(e);if("persistent"!==n._uninitializedComponentsProvider?._offline.kind)return null;let r=new vo(e);return vf.set(e,r),r}function vu(e){vd(e,!0)}function vh(e){vd(e,!1)}function vc(e){var t;(t=gb(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await m7(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>ox("deleting all persistent cache indexes succeeded")).catch(e=>oS("deleting all persistent cache indexes failed",e))}function vd(e,t){var n;(n=gb(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await m7(n),void(e.Cs.As=t)})).then(e=>ox(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>oS(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let vf=new WeakMap;class vp{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return vm.instance.onExistenceFilterMismatch(e)}}class vm{constructor(){this.i=new Map}static get instance(){return vg||function(e){if(cO)throw Error("a TestingHooksSpi instance is already set");cO=e}(vg=new vm),vg}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.i;return n.set(t,e),()=>n.delete(t)}}let vg=null;!function(e=!0){ov=a3,aK(new af("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new gw(new oR(t.getProvider("auth-internal")),new oF(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new oD(oA.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uW(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),a7(gY,gX,void 0),a7(gY,gX,"esm2020")}(),e.s(["AggregateField",()=>gZ,"AggregateQuerySnapshot",()=>g0,"DocumentSnapshot",()=>yU,"PersistentCacheIndexManager",()=>vo,"QueryCompositeFilterConstraint",()=>g7,"QueryConstraint",()=>g6,"QueryDocumentSnapshot",()=>yz,"QueryEndAtConstraint",()=>yh,"QueryFieldFilterConstraint",()=>g8,"QueryLimitConstraint",()=>yi,"QueryOrderByConstraint",()=>yn,"QuerySnapshot",()=>y$,"QueryStartAtConstraint",()=>yo,"SnapshotMetadata",()=>yj,"Transaction",()=>yX,"WriteBatch",()=>yW,"_TestingHooks",()=>vp,"addDoc",()=>y9,"aggregateFieldEqual",()=>yS,"aggregateQuerySnapshotEqual",()=>yT,"and",()=>yt,"average",()=>yx,"count",()=>yE,"deleteAllPersistentCacheIndexes",()=>vc,"deleteDoc",()=>y8,"disablePersistentCacheIndexAutoCreation",()=>vh,"documentSnapshotFromJSON",()=>yq,"enablePersistentCacheIndexAutoCreation",()=>vu,"endAt",()=>yd,"endBefore",()=>yc,"executeWrite",()=>vn,"getAggregateFromServer",()=>y_,"getCountFromServer",()=>yI,"getDoc",()=>yZ,"getDocFromCache",()=>y0,"getDocFromServer",()=>y1,"getDocs",()=>y2,"getDocsFromCache",()=>y3,"getDocsFromServer",()=>y5,"getPersistentCacheIndexManager",()=>vl,"limit",()=>ys,"limitToLast",()=>ya,"memoryEagerGarbageCollector",()=>yP,"memoryLocalCache",()=>yN,"memoryLruGarbageCollector",()=>yM,"onSnapshot",()=>y7,"onSnapshotResume",()=>ve,"onSnapshotsInSync",()=>vt,"or",()=>ye,"orderBy",()=>yr,"persistentLocalCache",()=>yR,"persistentMultipleTabManager",()=>yF,"persistentSingleTabManager",()=>yV,"query",()=>g4,"querySnapshotFromJSON",()=>yG,"runTransaction",()=>yJ,"setDoc",()=>y6,"setIndexConfiguration",()=>vs,"snapshotEqual",()=>yK,"startAfter",()=>yu,"startAt",()=>yl,"sum",()=>yb,"updateDoc",()=>y4,"where",()=>g9,"writeBatch",()=>vi],19387),e.i(19387);let vy=function(e,t){let n=aH("object"==typeof e?e:a4(),"firestore").getImmediate({identifier:"string"==typeof e?e:uH});if(!n._initialized){let e=(e=>{let t=s5()?.emulatorHosts?.[e];if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})("firestore");e&&function(e,t,n,r={}){e=o1(e,gu);let i=s8(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;i&&(s9(`https://${o}`),function(e,t){if("u"<typeof window||"u"<typeof document||!s8(window.location.host)||s7[e]===t||s7[e]||ae)return;function n(e){return`__firebase__banner__${e}`}s7[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(s7))s7[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=n("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;ae=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),s.host!==go&&s.host!==o&&oS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:r};if(!ah(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=oy.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[s1(JSON.stringify({alg:"none",type:"JWT"})),s1(JSON.stringify(s)),""].join(".")}(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new oD(oA.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new oy(i)}e._authCredentials=new oN(new oP(t,n))}}(n,...e)}return n}(a5({apiKey:"AIzaSyD4ItdXdEeDkFit0anY7bsy4i5M3ipYWM4",authDomain:"pin-01-ce220.firebaseapp.com",projectId:"pin-01-ce220",storageBucket:eA.default.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:eA.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:eA.default.env.NEXT_PUBLIC_FIREBASE_APP_ID})),vv=(0,_.default)(()=>e.A(15801).then(e=>e.Map),{loadableGenerated:{modules:[21284]},ssr:!1});function vw(){let e=(0,I.useRef)(null),t=(0,I.useRef)(null),[n,r]=(0,I.useState)(null),[i,s]=(0,I.useState)(!1),[a,o]=(0,I.useState)(!1),[l,u]=(0,I.useState)(null),[h,c]=(0,I.useState)([]),[d,f]=(0,I.useState)([]);(0,I.useEffect)(()=>{let e=y7(g4(gf(vy,"pins"),yr("created_at","desc")),e=>{let t=new Date().toISOString();c(e.docs.map(e=>{let t=e.data();return{description:t.description,location:t.location,created_at:t.created_at,expires_at:t.expires_at,userId:t.userId,userPhoto:t.userPhoto}}).filter(e=>!e.expires_at||e.expires_at>t))});return()=>e()},[]);let p=async e=>{o(!1);try{await y9(gf(vy,"pins"),e)}catch(e){console.error("Ошибка при сохранении пина в Firestore:",e)}};return(0,I.useEffect)(()=>{if(!i||!e.current)return()=>{};let t=e.current.getMap(),n=e=>{u({lat:e.lngLat.lat,lng:e.lngLat.lng}),o(!0)};return t.on("click",n),()=>t.off("click",n)},[i]),(0,I.useEffect)(()=>{if(!i||!e.current||!n)return()=>{};let r=e.current.getMap();if(r.flyTo({center:n,zoom:5,essential:!0}),t.current)t.current.setLngLat(n);else{let e=document.createElement("div");e.style.position="relative",e.style.width="60px",e.style.height="60px",e.style.cursor="pointer",e.style.zIndex="5";let i=document.createElement("div");i.style.width="32px",i.style.height="32px",i.style.borderRadius="50%",i.style.background="rgba(0,0,0,0.2)",i.style.position="absolute",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";let s=document.createElement("div");s.style.width="24px",s.style.height="24px",s.style.borderRadius="50%",s.style.background="#000",s.style.position="absolute",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)";let a=document.createElement("div");a.innerText="Я",a.style.position="absolute",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.color="#fff",a.style.fontSize="12px",a.style.fontWeight="bold",a.style.userSelect="none",a.style.pointerEvents="none",e.appendChild(i),e.appendChild(s),e.appendChild(a),e.onclick=e=>{e.stopPropagation(),r.flyTo({center:n,zoom:12,essential:!0})},t.current=new C.default.Marker({element:e,anchor:"center"}).setLngLat(n).addTo(r)}},[i,n]),(0,I.useEffect)(()=>{if(!e.current||!i)return;let t=e.current.getMap();if(!t)return;let n=()=>{f(e=>(e.forEach(e=>e.remove()),[]));let e=t.getZoom();if(0===h.length)return;let n=new Date().toISOString(),r=h.filter(e=>!e.expires_at||e.expires_at>n),i=[];if(e<7){let e=[];r.forEach(t=>{let n=e.find(e=>.5>Math.abs(e.lat-t.location.lat)&&.5>Math.abs(e.lng-t.location.lng));n?n.count++:e.push({lat:t.location.lat,lng:t.location.lng,count:1})}),e.forEach(e=>{let n=document.createElement("div");n.style.width="32px",n.style.height="32px",n.style.borderRadius="50%",n.style.background="white",n.style.border="2px solid black",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.fontWeight="bold",n.style.color="#000",n.innerText=String(e.count);let r=new C.default.Marker({element:n,anchor:"center"}).setLngLat([e.lng,e.lat]).addTo(t);i.push(r)})}else r.forEach(e=>{let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center";let r=document.createElement("div");if(r.style.cursor="pointer",r.style.display="inline-block",r.style.background="#fff",r.style.border="2px solid #000",r.style.borderRadius="12px",r.style.padding="8px",r.style.minWidth="120px",r.style.maxWidth="200px",r.style.textAlign="center",r.style.wordWrap="break-word",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.innerHTML=e.description,r.style.color="#000",n.appendChild(r),e.userPhoto){let t=document.createElement("img");t.src=e.userPhoto,t.style.width="32px",t.style.height="32px",t.style.borderRadius="50%",t.style.marginTop="4px",n.appendChild(t)}let s=new C.default.Marker({element:n,anchor:"bottom"}).setLngLat([e.location.lng,e.location.lat]).addTo(t);i.push(s)});f(i)};return n(),t.on("zoom",n),()=>{t.off("zoom",n)}},[i,h]),(0,T.jsxs)("div",{children:[(0,T.jsx)(k,{onLocation:r}),(0,T.jsx)(M,{mapRef:e,minPitch:0,maxPitch:60}),(0,T.jsx)(D,{}),(0,T.jsx)(P,{mapRef:e}),(0,T.jsx)(vv,{ref:e,initialViewState:{latitude:n?.[1]??0,longitude:n?.[0]??0,zoom:2},mapStyle:"https://api.maptiler.com/maps/streets-v4/style.json?key=U0SQYQUL3hLC7BWkcwVL",projection:"globe",onLoad:()=>s(!0),style:{width:"100%",height:"100vh"},attributionControl:!1}),l&&(0,T.jsx)(sQ,{location:l,sheetVisible:a,onClose:()=>o(!1),onSubmit:p})]})}function vb(){return(0,I.useEffect)(()=>{if(window.Telegram?.WebApp){let e=window.Telegram.WebApp;e&&(e.ready(),e.requestFullscreen?.(),e.disableVerticalSwipes?.(),e.requestLocation?.())}},[]),null}function vx(){return(0,T.jsxs)("div",{children:[(0,T.jsx)(vb,{}),(0,T.jsx)(vw,{})]})}e.s(["default",()=>vx],48985)}]);